!function(e){function t(){return function(a){"use strict";var q={version:"1.7.99",metadataVersion:"1.0.5"},b=j(Object.prototype.hasOwnProperty),z=j(Array.prototype.slice),n=function(){try{return!!(Object.getPrototypeOf&&Object.defineProperty({},"x",{}))}catch(e){return false}}();function U(e,t){for(var r in e){if(b(e,r)){t(r,e[r])}}}function B(e,t){var r=[];for(var n in e){if(b(e,n)){var a=t?t(n,e[n]):e[n];if(a!==undefined){r.push(a)}}}return r}function s(e,t){for(var r in e){if(b(e,r)){var n=e[r];if(t(r,n)){return{key:r,value:n}}}}return null}function l(e,t){var r=i(e,t);if(r==null)return true;return!!(r.writable||r.set)}function i(e,t){if(!n)return null;if(e.hasOwnProperty(t)){return Object.getOwnPropertyDescriptor(e,t)}else{var r=Object.getPrototypeOf(e);if(r==null)return null;return i(r,t)}}function y(t,r){return function(e){return e[t]===r}}function g(t){return function(e){return e[t]}}function $(e){var t=[];for(var r in e){if(b(e,r)){t.push(e[r])}}return t}function L(t,r,e){if(!r)return t;if(e){e.forEach(function(e){t[e]=r[e]})}else{for(var n in r){if(b(r,n)){t[n]=r[n]}}}return t}function G(e,t){for(var r in t){if(e[r]===undefined){e[r]=t[r]}}return e}function o(e,t){t.defaultInstance=G(new t(e),t.defaultInstance);return e}function h(r,e,n){n=n||{};for(var t in e){var a=t.split(",");var i=e[t];a.some(function(e){if(!(e in r))return false;var t=r[e];if(typeof t=="function")return false;if(t==i)return true;if(Array.isArray(t)&&t.length===0)return true;if(typeof i==="function"){t=i(t)}else if(typeof t==="object"){if(t&&t.parentEnum){t=t.name}}if(t===undefined)return true;n[a[0]]=t;return true})}return n}function u(e,t){if(e==="entityAspect"||e==="complexAspect"||e==="entityType"||e==="complexType"||e==="constructor"||e.charAt(0)==="_"||e.charAt(0)==="$")return;return t}function J(e,t){if(e!==Object(e))return e;if(e._$visited)return undefined;t=t||u;if(e.toJSON){var r=e.toJSON();if(r!==Object(r))return r;if(r!==e)return J(r,t);e=r}e._$visited=true;var n;if(e instanceof Array){n=e.map(function(e){return J(e,t)})}else if(typeof e==="function"){n=undefined}else{n={};for(var a in e){if(a==="_$visited")continue;var i=e[a];if(t){i=t(a,i);if(i===undefined)continue}i=J(i,t);if(i===undefined)continue;n[a]=i}}delete e._$visited;return n}function p(a,e){var i={};var o=a.length;e.forEach(function(e){for(var t=0;t<o;t++){var r=a[t];if(r){var n=r[e];if(n!==undefined){i[e]=n;break}}}});return i}function Q(e){if(e==null){return[]}else if(Array.isArray(e)){return e}else{return[e]}}function H(e,n,a){a=a==null?true:a;if(e==null)return e;var i;if(Array.isArray(e)){i=[];e.forEach(function(e,t){var r=n(e,t);if(r!=null||a){i[t]=r}})}else{i=n(e)}return i}function Z(e,t){for(var r=0,n=e.length;r<n;r++){if(t(e[r])){return e[r]}}return null}function f(e,t){for(var r=0,n=e.length;r<n;r++){if(t(e[r]))return r}return-1}function d(e,t){var r=e.indexOf(t);if(r===-1)e.push(t)}function W(e,t,r){var n=S(t)?t:undefined;var a=e.length-1;var i=false;for(var o=a;o>=0;o--){if(n?n(e[o]):e[o]===t){e.splice(o,1);i=true;if(!r){return true}}}return i}function Y(e,t,r){var n=[];var a=Math.min(e.length,t.length);for(var i=0;i<a;++i){n.push(r(e[i],t[i]))}return n}function v(e,t,r){if(!e||!t)return false;if(e.length!==t.length)return false;for(var n=0;n<e.length;n++){if(Array.isArray(e[n])){if(!v(e[n],t[n]))return false}else{if(r){if(!r(e[n],t[n]))return false}else{if(e[n]!==t[n])return false}}}return true}function X(e,t){var r=e[t];if(!r){r=[];e[t]=r}return r}function e(e,t){var r=e.split(";");for(var n=0,a=r.length;n<a;n++){var i=c(r[n]);if(i)return i}if(t){throw new Error("Unable to initialize "+e+".  "+t)}}function c(e){var t=a.window;if(!t)return;var r=t[e];if(r)return r;var n=t.require;if(n){if(n.defined){return n.defined(e)?n(e):undefined}else{try{return n(e)}catch(e){return}}}}function ee(e,t,r,n){var a=e[t];if(r===a){return n()}e[t]=r;try{return n()}finally{if(a===undefined){delete e[t]}else{e[t]=a}}}function te(e,t,r){var n;try{n=e();return r()}catch(e){if(typeof n==="object"){n.error=e}throw e}finally{t(n)}}function m(a){return function(){var e=z(arguments),t="",r=e.length,n=null;while(r--){n=e[r];t+=n===Object(n)?JSON.stringify(n):n;a.memoize||(a.memoize={})}return t in a.memoize?a.memoize[t]:a.memoize[t]=a.apply(this,e)}}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16)})}function F(e){if(typeof e!=="string")throw new Error("Invalid ISO8601 duration '"+e+"'");var t=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e);if(!t)throw new Error("Invalid ISO8601 duration '"+e+"'");var r=[2,3,4,6,7,8];var n=[31104e3,2592e3,86400,3600,60,1];var a=0;for(var i=0;i<6;i++){var o=t[r[i]];o=o?+o.replace(/[A-Za-z]+/g,""):0;a+=o*n[i]}return a}function _(){}function w(e){return e}function t(e){if(e===null){return"null"}if(e===undefined){return"undefined"}return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function M(e){return t(e)==="date"&&!isNaN(e.getTime())}function k(e){var t=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/;return typeof e==="string"&&t.test(e)}function S(e){return t(e)==="function"}function N(e){return typeof e==="string"}function O(e){return typeof e==="object"}function D(e){return typeof e==="string"&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(e)}function I(e){return typeof e==="string"&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(e)}function re(e){if(e===null||e===undefined){return true}for(var t in e){if(b(e,t)){return false}}return true}function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}function E(e){if(e==null)return false;if(e!=Object(e))return true;return M(e)}function A(e,t){if(!e)return false;if(t==""||t==null)return true;return e.indexOf(t,0)===0}function C(e,t){if(!e)return false;if(t==""||t==null)return true;return e.indexOf(t,e.length-t.length)!==-1}function V(e){var r=arguments;var t=RegExp("%([1-"+(arguments.length-1)+"])","g");return e.replace(t,function(e,t){return r[t]})}var T=/([A-Z](?=[A-Z][a-z])|[^A-Z](?=[A-Z])|[a-zA-Z](?=[^a-zA-Z]))/g;function P(e){e=e.replace(T,"$1 ");e=e.charAt(0).toUpperCase()+e.slice(1);return e}function j(e){var t=Function.call;return function(){return t.apply(e,arguments)}}if(!Object.create){Object.create=function(e){var t=function(){};t.prototype=e;return new t}}var R={};R.__isES5Supported=n,R.objectForEach=U,R.extend=L,R.propEq=y,R.pluck=g,R.arrayEquals=v,R.arrayFirst=Z,R.arrayIndexOf=f,R.arrayRemoveItem=W,R.arrayZip=Y,R.requireLib=e,R.using=ee,R.memoize=m,R.getUuid=x,R.durationToSeconds=F,R.isDate=M,R.isGuid=D,R.isDuration=I,R.isFunction=S,R.isEmpty=re,R.isNumeric=r,R.stringStartsWith=A,R.stringEndsWith=C,R.formatString=V,R.titleCase=P,R.getPropertyDescriptor=i,R.toJSONSafe=J,R.toJSONSafeReplacer=u,(R.parent=q).core=R;var K=function(){var e=function(e,t){this.v=e;this.name=t;this._contexts=[null]};var t=e.prototype;t.isObject=function(){return this.isTypeOf("object")};t.isBoolean=function(){return this.isTypeOf("boolean")};t.isString=function(){return this.isTypeOf("string")};t.isNonEmptyString=function(){return y(this,{fn:r,msg:"must be a nonEmpty string"})};function r(e,t){if(t==null)return false;return typeof t==="string"&&t.length>0}t.isNumber=function(){return this.isTypeOf("number")};t.isFunction=function(){return this.isTypeOf("function")};t.isTypeOf=function(e){return y(this,{fn:n,typeName:e,msg:"must be a '"+e+"'"})};function n(e,t){if(t==null)return false;if(typeof t===e.typeName)return true;return false}t.isInstanceOf=function(e,t){t=t||e.prototype._$typeName;return y(this,{fn:a,type:e,typeName:t,msg:"must be an instance of '"+t+"'"})};function a(e,t){if(t==null)return false;return t instanceof e.type}t.hasProperty=function(e){return y(this,{fn:i,propertyName:e,msg:"must have a '"+e+"' property"})};function i(e,t){if(t==null)return false;return t[e.propertyName]!==undefined}t.isEnumOf=function(e){return y(this,{fn:o,enumType:e,msg:"must be an instance of the '"+e.name+"' enumeration"})};function o(e,t){if(t==null)return false;return e.enumType.contains(t)}t.isRequired=function(e){return y(this,{fn:s,allowNull:e,msg:"is required"})};function s(e,t){if(e.allowNull){return t!==undefined}else{return t!=null}}t.isOptional=function(){var e={fn:u,prevContext:null,msg:p};return y(this,e)};function u(e,t){if(t==null)return true;var r=e.prevContext;if(r){return r.fn(r,t)}else{return true}}function p(e,t){var r=e.prevContext;var n=r?" or it "+l(r,t):"";return"is optional"+n}t.isNonEmptyArray=function(){return this.isArray(true)};t.isArray=function(e){var t={fn:c,mustNotBeEmpty:e,prevContext:null,msg:f};return y(this,t)};function c(e,t){if(!Array.isArray(t)){return false}if(e.mustNotBeEmpty){if(t.length===0)return false}var r=e.prevContext;if(!r)return true;return t.every(function(e){return r.fn(r,e)})}function f(e,t){var r=e.mustNotBeEmpty?"a nonEmpty array":"an array";var n=e.prevContext;var a=n?" where each element "+l(n,t):"";return" must be "+r+a}function l(e,t){var r=e.msg;if(typeof r==="function"){r=r(e,t)}return r}t.or=function(){this._contexts.push(null);this._context=null;return this};t.check=function(e){var t=d(this);if(t===undefined)return;if(!t){throw new Error(this.getMessage())}if(this.v!==undefined){return this.v}else{return e}};t._addContext=function(e){return y(this,e)};function y(e,t){if(e._context){var r=e._context;while(r.prevContext!=null){r=r.prevContext}if(r.prevContext===null){r.prevContext=t;return e}else if(t.prevContext==null){t.prevContext=e._context}else{throw new Error("Illegal construction - use 'or' to combine checks")}}return h(e,t)}function h(e,t){e._contexts[e._contexts.length-1]=t;e._context=t;return e}function d(t){var e=t._contexts;if(e[e.length-1]==null){e.pop()}if(e.length===0){return undefined}return e.some(function(e){return e.fn(e,t.v)})}t.getMessage=function(){var t=this;var e=this._contexts.map(function(e){return l(e,t.v)}).join(", or it ");return V(this.MESSAGE_PREFIX,this.name)+" "+e};t.withDefault=function(e){this.defaultValue=e;return this};t.whereParam=function(e){return this.parent.whereParam(e)};t.applyAll=function(t,r){var e=t._$typeName;var n=e&&this.parent.config._$typeName===e;var a=L({},this.parent.config);this.parent.params.forEach(function(e){if(!n)delete a[e.name];try{e.check()}catch(e){v(t,e.message)}!r&&e._applyOne(t)});if(!n){for(var i in a){if(a[i]!==undefined){v(t,V("Unknown property: '%1'.",i))}}}};function v(e,t){throw new Error(V("Error configuring an instance of '%1'. %2",e&&e._$typeName||"object",t))}t._applyOne=function(e){if(this.v!==undefined){e[this.name]=this.v}else{if(this.defaultValue!==undefined){e[this.name]=this.defaultValue}}};t.MESSAGE_PREFIX="The '%1' parameter ";return e}(),ne=function(e,t){return new K(e,t)},ae=function(){var e=function(e){if(typeof e!=="object"){throw new Error("Configuration parameter should be an object, instead it is a: "+typeof e)}this.config=e;this.params=[]};var t=e.prototype;t.whereParam=function(e){var t=new K(this.config[e],e);t.parent=this;this.params.push(t);return t};return e}(),ie=function(e){return new ae(e)};R.Param=K,R.assertParam=ne,R.assertConfig=ie;var oe=function(){var e=function e(t,r){this.name=t;var n=new a(r);n.parentEnum=this;this._symbolPrototype=n;if(r){Object.keys(r).forEach(function(e){n[e]=r[e]})}};var t=e.prototype;e.isSymbol=function(e){return e instanceof a};t.fromName=function(e){return this[e]};t.addSymbol=function(t){var r=Object.create(this._symbolPrototype);if(t){Object.keys(t).forEach(function(e){r[e]=t[e]})}setTimeout(function(){r.getName()},0);return r};t.resolveSymbols=function(){this.getSymbols().forEach(function(e){return e.getName()})};t.getSymbols=function(){return this.getNames().map(function(e){return this[e]},this)};t.getNames=function(){var e=[];for(var t in this){if(this.hasOwnProperty(t)){if(t!=="name"&&t.substr(0,1)!=="_"&&!S(this[t])){e.push(t)}}}return e};t.contains=function(e){if(!(e instanceof a)){return false}return this[e.getName()]===e};function a(){}a.prototype.getName=function(){if(!this.name){var t=this;this.name=Z(this.parentEnum.getNames(),function(e){return t.parentEnum[e]===t})}return this.name};a.prototype.toString=function(){return this.getName()};a.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}};return e}();R.Enum=oe;var se=function(){var a={};var r=1;var i=function e(t,r,n){ne(t,"eventName").isNonEmptyString().check();ne(r,"publisher").isObject().check();this.name=t;a[t]=true;this.publisher=r;if(n){this._defaultErrorCallback=n}};var e=i.prototype;e.publish=function(e,t,r){if(!i._isEnabled(this.name,this.publisher))return false;if(t===true){setTimeout(n,0,this,e,r)}else{n(this,e,r)}return true};function n(t,r,n){var e=t._subscribers;if(!e)return true;e.forEach(function(e){try{e.callback(r)}catch(e){e.context="unable to publish on topic: "+t.name;if(n){n(e)}else if(t._defaultErrorCallback){t._defaultErrorCallback(e)}else{o(e)}}})}e.publishAsync=function(e,t){this.publish(e,true,t)};e.subscribe=function(e){if(!this._subscribers){this._subscribers=[]}var t=r;this._subscribers.push({unsubKey:t,callback:e});++r;return t};e.unsubscribe=function(t){if(!this._subscribers)return false;var e=this._subscribers;var r=f(e,function(e){return e.unsubKey===t});if(r!==-1){e.splice(r,1);if(e.length===0){this._subscribers=null}return true}else{return false}};e.clear=function(){this._subscribers=null};i.bubbleEvent=function(e,t){e._getEventParent=t};i.enable=function(e,t,r){ne(e,"eventName").isNonEmptyString().check();ne(t,"obj").isObject().check();ne(r,"isEnabled").isBoolean().isOptional().or().isFunction().check();if(!t._$eventMap){t._$eventMap={}}t._$eventMap[e]=r};i.isEnabled=function(e,t){ne(e,"eventName").isNonEmptyString().check();ne(t,"obj").isObject().check();if(t._getEventParent===undefined){throw new Error("This object does not support event enabling/disabling")}return i._isEnabled(e,t)};i._isEnabled=function(e,t){var r=null;var n=t._$eventMap;if(n){r=n[e]}if(r!=null){if(typeof r==="function"){return r(t)}else{return!!r}}else{var a=t._getEventParent&&t._getEventParent();if(a){return i._isEnabled(e,a)}else{return true}}};function o(e){}return i}();R.Event=se;var ue=function(){var a={};a.functionRegistry={};a.typeRegistry={};a.objectRegistry={};a.interfaceInitialized=new se("interfaceInitialized",a);var e=function(e){this.name=e;this.defaultInstance=null;this._implMap={}};e.prototype.registerCtor=function(e,t){this._implMap[e.toLowerCase()]={ctor:t,defaultInstance:null}};e.prototype.getImpl=function(e){return this._implMap[e.toLowerCase()]};e.prototype.getFirstImpl=function(){var e=s(this._implMap,function(){return true});return e?e.value:null};a.interfaceRegistry={ajax:new e("ajax"),modelLibrary:new e("modelLibrary"),dataService:new e("dataService"),uriBuilder:new e("uriBuilder")};a.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance){throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.")}return this.defaultInstance};a.setProperties=function(e){ie(e).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(e);if(e.remoteAccessImplementation){a.initializeAdapterInstance("dataService",e.remoteAccessImplementation)}if(e.trackingImplementation){a.initializeAdapterInstance("modelLibrary",e.trackingImplementation)}if(e.ajaxImplementation){a.initializeAdapterInstance("ajax",e.ajaxImplementation)}};a.registerAdapter=function(e,t){ne(e,"interfaceName").isNonEmptyString().check();ne(t,"adapterCtor").isFunction().check();var r=new t;var n=r.name;if(!n){throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.")}var a=o(e);a.registerCtor(n,t)};a.getAdapter=function(e,t){var r=o(e);if(t){var n=r.getImpl(t);return n?n.ctor:null}else{return r.defaultInstance?r.defaultInstance._$impl.ctor:null}};a.initializeAdapterInstances=function(e){ie(e).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().whereParam("uriBuilder").isOptional().applyAll(this,false);return B(e,a.initializeAdapterInstance)};a.initializeAdapterInstance=function(e,t,r){r=r===undefined?true:r;ne(e,"interfaceName").isNonEmptyString().check();ne(t,"adapterName").isNonEmptyString().check();ne(r,"isDefault").isBoolean().check();var n=o(e);var a=n.getImpl(t);if(!a){throw new Error("Unregistered adapter.  Interface: "+e+" AdapterName: "+t)}return i(n,a,r)};a.getAdapterInstance=function(e,t){var r=o(e);var n;var a=t==null||t=="";if(a){if(r.defaultInstance)return r.defaultInstance;n=r.getFirstImpl()}else{n=r.getImpl(t)}if(!n)return null;if(n.defaultInstance){return n.defaultInstance}else{return i(r,n,a)}};a.registerFunction=function(e,t){ne(e,"fn").isFunction().check();ne(t,"fnName").isString().check();e.prototype._$fnName=t;a.functionRegistry[t]=e};a.getRegisteredFunction=function(e){return a.functionRegistry[e]};a._storeObject=function(e,t,r){var n=(typeof t==="string"?t:t.prototype._$typeName)+"."+r;a.objectRegistry[n]=e};a._fetchObject=function(e,t){if(!t)return undefined;var r=(typeof e==="string"?e:e.prototype._$typeName)+"."+t;var n=a.objectRegistry[r];if(!n){throw new Error("Unable to locate a registered object by the name: "+r)}return n};a.registerType=function(e,t){ne(e,"ctor").isFunction().check();ne(t,"typeName").isString().check();e.prototype._$typeName=t;a.typeRegistry[t]=e};a.stringifyPad="";function i(e,t,r){var n=t.defaultInstance;if(!n){n=new t.ctor;t.defaultInstance=n;n._$impl=t}n.initialize();if(r){e.defaultInstance=n}a.interfaceInitialized.publish({interfaceName:e.name,instance:n,isDefault:true});if(n.checkForRecomposition){a.interfaceInitialized.subscribe(function(e){n.checkForRecomposition(e)})}return n}function o(e){var r=e.toLowerCase();var t=s(a.interfaceRegistry||{},function(e,t){return e.toLowerCase()===r});if(!t){throw new Error("Unknown interface name: "+e)}return t.value}return a}(),pe=ue.interfaceRegistry.modelLibrary;R.config=ue,q.config=ue;var ce=function(){var e={};e.push=function(){if(this._inProgress){return-1}var e=this._getGoodAdds(z(arguments));if(!e.length){return this.length}this._beforeChange();var t=Array.prototype.push.apply(this,e);n(this,e);return t};e._push=function(){if(this._inProgress){return-1}var e=z(arguments);this._beforeChange();var t=Array.prototype.push.apply(this,e);n(this,e);return t};e.unshift=function(){var e=this._getGoodAdds(z(arguments));if(!e.length){return this.length}this._beforeChange();var t=Array.prototype.unshift.apply(this,e);n(this,z(e));return t};e.pop=function(){this._beforeChange();var e=Array.prototype.pop.apply(this);a(this,[e]);return e};e.shift=function(){this._beforeChange();var e=Array.prototype.shift.apply(this);a(this,[e]);return e};e.splice=function(){var e=this._getGoodAdds(z(arguments,2));var t=z(arguments,0,2).concat(e);this._beforeChange();var r=Array.prototype.splice.apply(this,t);a(this,r);if(e.length){n(this,e)}return r};e.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()};e._getEventParent=function(){return this.getEntityAspect()};e._getPendingPubs=function(){var e=this.getEntityAspect().entityManager;return e&&e._pendingPubs};e._beforeChange=function(){};function t(e){var t=e.getEntityAspect();if(t.entityState.isUnchanged()){t.setModified()}if(t.entityState.isModified()&&!e._origValues){e._origValues=e.slice(0)}}function n(e,t){e._processAdds(t);r(e,"arrayChanged",{array:e,added:t})}function a(e,t){e._processRemoves(t);r(e,"arrayChanged",{array:e,removed:t})}function r(e,t,r){var n=e._getPendingPubs();if(n){if(!e._pendingArgs){e._pendingArgs=r;n.push(function(){e[t].publish(e._pendingArgs);e._pendingArgs=null})}else{i(e._pendingArgs,r)}}else{e[t].publish(r)}}function i(e,t){for(var r in t){if(r!=="array"&&e.hasOwnProperty(r)){var n=t[r];var a=e[r];if(a){if(!Array.isArray(a)){throw new Error("Cannot combine non array args")}Array.prototype.push.apply(a,n)}else{e[r]=n}}}}function o(e,t,r){e.parent=t;e.parentProperty=r}return{mixin:e,publish:r,updateEntityState:t,initializeParent:o}}(),fe=function(){var t=-32768;var r=32767;var n=-2147483648;var a=2147483647;var i=0;var o=255;var s={displayName:function(e){if(e.property){return e.property.resolveProperty("displayName")||e.propertyName||e.property.name}else{return"Value"}}};var u=function e(t,r,n){this._baseContext=n||{};this._baseContext.name=t;n=L(Object.create(s),this._baseContext);n.messageTemplate=n.messageTemplate||u.messageTemplates[t];this.name=t;this.valFn=r;this.context=n};var e=u.prototype;e._$typeName="Validator";e.validate=function(e,t){var r;if(t){r=L(Object.create(this.context),t)}else{r=this.context}this.currentContext=r;try{if(this.valFn(e,r)){return null}else{r.value=e;return new le(this,r,this.getMessage())}}catch(e){return new le(this,r,"Exception occured while executing this validator: "+this.name)}};e.getMessage=function(){try{var e=this.currentContext;var t=e.message;if(t){if(typeof t==="function"){return t(e)}else{return t}}else if(e.messageTemplate){return f(e.messageTemplate,e)}else{return"invalid value: "+(this.name||"{unnamed validator}")}}catch(e){return"Unable to format error message"+e.toString()}};e.toJSON=function(){return this._baseContext};u.fromJSON=function(e){if(Array.isArray(e)){return e.map(function(e){return u.fromJSON(e)})}var t="Validator."+e.name;var r=ue.getRegisteredFunction(t);if(!r){throw new Error("Unable to locate a validator named:"+e.name)}return r(e)};u.register=function(e){ue.registerFunction(function(){return e},"Validator."+e.name)};u.registerFactory=function(e,t){ue.registerFunction(e,"Validator."+t)};u.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"};u.required=function(e){var t=function(e,t){if(typeof e==="string"){if(t&&t.allowEmptyStrings)return true;return e.length>0}else{return e!=null}};return new u("required",t,e)};u.maxLength=function(e){var t=function(e,t){if(e==null)return true;if(typeof e!=="string")return false;return e.length<=t.maxLength};return new u("maxLength",t,e)};u.stringLength=function(e){var t=function(e,t){if(e==null)return true;if(typeof e!=="string")return false;if(t.minLength!=null&&e.length<t.minLength)return false;if(t.maxLength!=null&&e.length>t.maxLength)return false;return true};return new u("stringLength",t,e)};u.string=function(){var e=function(e){if(e==null)return true;return typeof e==="string"};return new u("string",e)};u.guid=function(){var e=function(e){if(e==null)return true;return D(e)};return new u("guid",e)};u.duration=function(){var e=function(e){if(e==null)return true;return I(e)};return new u("duration",e)};u.number=u.double=u.single=function(e){var t=function(e,t){if(e==null)return true;if(typeof e==="string"&&t&&t.allowString){e=parseFloat(e,10)}return typeof e==="number"&&!isNaN(e)};return new u("number",t,e)};u.integer=u.int64=function(e){var t=function(e,t){if(e==null)return true;if(typeof e==="string"&&t&&t.allowString){e=parseInt(e,10)}return typeof e==="number"&&!isNaN(e)&&Math.floor(e)===e};return new u("integer",t,e)};u.int32=function(e){return l("int32",n,a,e)()};u.int16=function(e){return l("int16",t,r,e)()};u.byte=function(e){return l("byte",i,o,e)()};u.bool=function(){var e=function(e){if(e==null)return true;return e===true||e===false};return new u("bool",e)};u.none=function(){var e=function(e){return true};return new u("none",e)};u.date=function(){var e=function(e){if(e==null)return true;if(typeof e==="string"){try{return!isNaN(Date.parse(e))}catch(e){return false}}else{return M(e)}};return new u("date",e)};u.creditCard=function(e){function t(e){if(e==null||e==="")return true;if(typeof e!=="string")return false;e=e.replace(/(\-|\s)/g,"");if(!e||/\D/.test(e))return false;return p(e)}return new u("creditCard",t,e)};function p(e,t,r,n,a){for(n=+e[t=e.length-1],a=0;t--;)r=+e[t],n+=++a%2?2*r%10+(r>4):r;return!(n%10)}u.regularExpression=function(e){function t(e,t){if(e==null||e==="")return true;if(typeof e!=="string")return false;try{var r=new RegExp(t.expression)}catch(e){throw new Error("Missing or invalid expression parameter to regExp validator")}return r.test(e)}return new u("regularExpression",t,e)};u.emailAddress=function(e){var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;return c("emailAddress",t,null,e)};u.phone=function(e){var t=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return c("phone",t,null,e)};u.url=function(e){var t=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return c("url",t,null,e)};u.makeRegExpValidator=c;function c(e,t,r,n){if(r){u.messageTemplates[e]=r}var a=typeof t==="string"?new RegExp(t):t;var i=function(e){if(e==null||e==="")return true;if(typeof e!=="string")return false;return a.test(e)};return new u(e,i,n)}U(u,function(e,t){if(typeof t!=="function"){return}if(e==="fromJSON"||e==="register"||e==="registerFactory"||e==="makeRegExpValidator"){return}ue.registerFunction(t,"Validator."+e)});function f(e,n,a){if(!n)return e;return e.replace(/%([^%]+)%/g,function(e,t){var r;if(a){r=n.hasOwnProperty(t)?n[t]:""}else{r=n[t]}if(r!=null){if(S(r)){return r(n)}else{return r}}else{return""}})}function l(t,r,n,a){a=a||{};if(r!==undefined){a.min=r}if(n!==undefined){a.max=n}var e=a.messageTemplate||u.messageTemplates[t];if(!e){u.messageTemplates[t]=V("'%displayName%' must be an integer between the values of %1 and %2",r,n)}return function(){var e=function(e,t){if(e==null)return true;if(typeof e==="string"&&t&&t.allowString){e=parseInt(e,0)}if(typeof e==="number"&&!isNaN(e)&&Math.floor(e)===e){if(r!=null&&e<r){return false}if(n!=null&&e>n){return false}return true}else{return false}};return new u(t,e,a)}}return u}(),le=function(){var e=function e(t,r,n,a){ne(t,"validator").isOptional().isInstanceOf(fe).check();ne(n,"errorMessage").isNonEmptyString().check();ne(a,"key").isOptional().isNonEmptyString().check();this.validator=t;r=r||{};this.context=r;this.errorMessage=n;this.property=r.property;this.propertyName=r.propertyName||r.property&&r.property.name;if(a){this.key=a}else{this.key=e.getKey(t||n,this.propertyName)}this.isServerError=false};e.getKey=function(e,t){return(e.name||e)+(t?":"+t:"")};return e}();q.Validator=fe,q.ValidationError=le;var ye=function(){var e=function e(t){r(this,t)};var t=e.prototype;t._$typeName="ValidationOptions";t.using=function(e){if(!e)return this;var t=new ye(this);r(t,e);return t};t.setAsDefault=function(){return o(this,e)};e.defaultInstance=new e({validateOnAttach:true,validateOnSave:true,validateOnQuery:false,validateOnPropertyChange:true});function r(e,t){if(t){ie(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(e)}return e}return e}();q.ValidationOptions=ye,q.makeComplexArray=function(){var n={};n._getGoodAdds=function(e){return t(this,e)};n._beforeChange=function(){ce.updateEntityState(this)};n._processAdds=function(e){r(this,e)};n._processRemoves=function(e){a(this,e)};n._rejectChanges=function(){if(!this._origValues)return;var t=this;this.forEach(function(e){i(e,t)});this.length=0;this._origValues.forEach(function(e){t.push(e)})};n._acceptChanges=function(){this._origValues=null};function t(t,e){return e.filter(function(e){return e.parent!==t.parent})}function r(t,e){e.forEach(function(e){if(e.parent!=null){throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner")}o(e,t)})}function a(t,e){e.forEach(function(e){i(e,t)})}function i(e,t){var r=e.complexAspect;if(r.parent!==t.parent)return null;r.parent=null;r.parentProperty=null;return r}function o(e,t){var r=e.complexAspect;if(r.parent===t.parent)return null;r.parent=t.parent;r.parentProperty=t.parentProperty;return r}function e(e,t,r){ce.initializeParent(e,t,r);e.arrayChanged=new se("arrayChanged",e);L(e,ce.mixin);return L(e,n)}return e}();var he=function(){var e={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}};var t=new oe("EntityAction",e);t.Attach=t.addSymbol({isAttach:true});t.AttachOnQuery=t.addSymbol({isAttach:true});t.AttachOnImport=t.addSymbol({isAttach:true});t.Detach=t.addSymbol({isDetach:true});t.MergeOnQuery=t.addSymbol({isModification:true});t.MergeOnImport=t.addSymbol({isModification:true});t.MergeOnSave=t.addSymbol({isModification:true});t.PropertyChange=t.addSymbol({isModification:true});t.EntityStateChange=t.addSymbol();t.AcceptChanges=t.addSymbol();t.RejectChanges=t.addSymbol({isModification:true});t.Clear=t.addSymbol({isDetach:true});t.resolveSymbols();return t}();q.EntityAction=he;var de=function(){var e=function e(t){if(t===null){var r=e._nullInstance;if(r)return r;e._nullInstance=this}else if(t===undefined){throw new Error("The EntityAspect ctor requires an entity as its only argument.")}else if(t.entityAspect){return t.entityAspect}if(!(this instanceof e)){return new e(t)}this.entity=t;this.entityGroup=null;this.entityManager=null;this.entityState=ge.Detached;this.isBeingSaved=false;this.originalValues={};this.hasValidationErrors=false;this._validationErrors={};this.validationErrorsChanged=new se("validationErrorsChanged",this);this.propertyChanged=new se("propertyChanged",this);if(t!=null){t.entityAspect=this;var n=t.entityType||t._$entityType;if(!n){var a=t.prototype._$typeName;if(!a){throw new Error("This entity is not registered as a valid EntityType")}else{throw new Error("Metadata for this entityType has not yet been resolved: "+a)}}var i=n.getEntityCtor();pe.getDefaultInstance().startTracking(t,i.prototype)}};var t=e.prototype;se.bubbleEvent(t,function(){return this.entityManager});t.getKey=function(e){e=ne(e,"forceRefresh").isBoolean().isOptional().check(false);if(e||!this._entityKey){var t=this.entity.entityType;var r=t.keyProperties;var n=r.map(function(e){return this.entity.getProperty(e.name)},this);this._entityKey=new me(t,n)}return this._entityKey};t.acceptChanges=function(){this._checkOperation("acceptChanges");var e=this.entityManager;if(this.entityState.isDeleted()){e.detachEntity(this.entity)}else{this.setUnchanged()}e.entityChanged.publish({entityAction:he.AcceptChanges,entity:this.entity})};t.rejectChanges=function(){this._checkOperation("rejectChanges");var e=this.entity;var t=this.entityManager;ee(t,"isRejectingChanges",true,function(){i(e)});if(this.entityState.isAdded()){t.detachEntity(e);t._notifyStateChange(e,false)}else{if(this.entityState.isDeleted()){this.entityManager._linkRelatedEntities(e)}this.setUnchanged();this.propertyChanged.publish({entity:e,propertyName:null});this.entityManager.entityChanged.publish({entityAction:he.RejectChanges,entity:e})}};function i(r){var e=r.entityAspect||r.complexAspect;var t=r.entityType||r.complexType;var n=e.originalValues;for(var a in n){r.setProperty(a,n[a])}t.complexProperties.forEach(function(e){var t=r.getProperty(e.name);if(e.isScalar){i(t)}else{t._rejectChanges();t.forEach(i)}})}t.getPropertyPath=function(e){return e};t.setAdded=function(){return this.setEntityState(ge.Added)};t.setUnchanged=function(){return this.setEntityState(ge.Unchanged)};t.setModified=function(){return this.setEntityState(ge.Modified)};t.setDeleted=function(){return this.setEntityState(ge.Deleted)};t.setDetached=function(){return this.setEntityState(ge.Detached)};t.setEntityState=function(e){if(this.entityState===e)return false;this._checkOperation("setEntityState");if(this.entityState.isDetached()){throw new Error("You cannot set the 'entityState' of an entity when it is detached - except by first attaching it to an EntityManager")}var t=this.entity;var r=this.entityManager;var n=true;if(e===ge.Unchanged){o(t);delete this.hasTempKey;n=false}else if(e===ge.Added){o(t)}else if(e===ge.Deleted){if(this.entityState.isAdded()){this.setEntityState(ge.Detached);return true}else{this.entityState=ge.Deleted;s(t,ge.Deleted)}}else if(e===ge.Modified){}else if(e===ge.Detached){var a=this.entityGroup;if(!a)return false;a.detachEntity(t);this.entityState=e;s(t,ge.Detached);this._detach();r.entityChanged.publish({entityAction:he.Detach,entity:t});n=false}this.entityState=e;r._notifyStateChange(t,n);return true};function o(r){var e=r.entityAspect||r.complexAspect;e.originalValues={};var t=r.entityType||r.complexType;t.complexProperties.forEach(function(e){var t=r.getProperty(e.name);if(e.isScalar){o(t)}else{t._acceptChanges();t.forEach(o)}})}t.loadNavigationProperty=function(e,t,r){var n=this.entity;var a=n.entityType._checkNavProperty(e);var i=Le.fromEntityNavigation(n,a);var o=n.entityAspect.entityManager.executeQuery(i);var s=this;return o.then(function(e){s._markAsLoaded(a.name);if(t)t(e);return Ae.resolve(e)},function(e){if(r)r(e);return Ae.reject(e)})};t.markNavigationPropertyAsLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);this._markAsLoaded(t.name)};t.isNavigationPropertyLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);if(t.isScalar&&this.entity.getProperty(t.name)!=null){return true}return this._loadedNps&&this._loadedNps.indexOf(t.name)>=0};t._markAsLoaded=function(e){this._loadedNps=this._loadedNps||[];d(this._loadedNps,e)};t.validateEntity=function(){var t=true;this._processValidationOpAndPublish(function(e){t=u(e.entity)});return t};function u(n,e){var a=true;var t=n.entityType||n.complexType;var i=n.entityAspect||n.complexAspect;var o=n.entityAspect||n.complexAspect.getEntityAspect();var s={entity:o.entity};if(e!==undefined){s.index=e}t.getProperties().forEach(function(e){var t=n.getProperty(e.name);var r=e.getAllValidators();if(r.length>0){s.property=e;s.propertyName=i.getPropertyPath(e.name);a=o._validateProperty(t,s)&&a}if(e.isComplexProperty){if(e.isScalar){a=u(t)&&a}else{a=t.reduce(function(e,t,r){return u(t,r)&&e},a)}}});t.getAllValidators().forEach(function(e){a=p(o,e,n)&&a});return a}t.validateProperty=function(e,t){var r=this.getPropertyValue(e);if(r&&r.complexAspect){return u(r)}t=t||{};t.entity=this.entity;if(typeof e==="string"){t.property=this.entity.entityType.getProperty(e,true);t.propertyName=e}else{t.property=e;t.propertyName=e.name}return this._validateProperty(r,t)};t.getValidationErrors=function(e){ne(e,"property").isOptional().isEntityProperty().or().isString().check();var t=$(this._validationErrors);if(e){var r=typeof e==="string"?e:e.name;t=t.filter(function(e){return e.property&&(e.property.name===r||r.indexOf(".")!=-1&&e.propertyName==r)})}return t};t.addValidationError=function(t){ne(t,"validationError").isInstanceOf(le).check();this._processValidationOpAndPublish(function(e){e._addValidationError(t)})};t.removeValidationError=function(e){ne(e,"validationErrorOrKey").isString().or().isInstanceOf(le).or().isInstanceOf(fe).check();var t=typeof e==="string"?e:e.key;this._processValidationOpAndPublish(function(e){e._removeValidationError(t)})};t.clearValidationErrors=function(){this._processValidationOpAndPublish(function(r){U(r._validationErrors,function(e,t){if(t){delete r._validationErrors[e];r._pendingValidationResult.removed.push(t)}});r.hasValidationErrors=!re(r._validationErrors)})};t.getParentKey=function(e){var t=e.foreignKeyNames;if(t.length===0)return null;var r=this;var n=t.map(function(e){return r.entity.getProperty(e)});return new me(e.entityType,n)};t.getPropertyValue=function(e){ne(e,"property").isString().or().isEntityProperty().check();var t;if(typeof e==="string"){var r=e.trim().split(".");var n=r.shift();t=this.entity;t=t.getProperty(n);while(r.length>0){n=r.shift();t=t.getProperty(n)}}else{if(!(e.parentType instanceof Fe)){throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; "+"Pass a 'property path' string as the 'property' parameter instead ")}t=this.entity.getProperty(e.name)}return t};t._checkOperation=function(e){if(this.isBeingSaved){throw new Error("Cannot perform a '"+e+"' on an entity that is in the process of being saved")}return this};t._detach=function(){this.entityGroup=null;this.entityManager=null;this.entityState=ge.Detached;this.originalValues={};this._validationErrors={};this.hasValidationErrors=false;this.validationErrorsChanged.clear();this.propertyChanged.clear()};t._validateProperty=function(r,n){var a=true;this._processValidationOpAndPublish(function(t){n.property.getAllValidators().forEach(function(e){a=p(t,e,r,n)&&a})});return a};t._processValidationOpAndPublish=function(e){if(this._pendingValidationResult){e(this)}else{try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]};e(this);if(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0){this.validationErrorsChanged.publish(this._pendingValidationResult);this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult)}}finally{this._pendingValidationResult=undefined}}};t._addValidationError=function(e){this._validationErrors[e.key]=e;this.hasValidationErrors=true;this._pendingValidationResult.added.push(e)};t._removeValidationError=function(e){var t=this._validationErrors[e];if(t){delete this._validationErrors[e];this.hasValidationErrors=!re(this._validationErrors);this._pendingValidationResult.removed.push(t)}};function s(e,t){var r=t.isDeleted();if(r){n(e)}else{ee(e.entityAspect.entityManager,"isLoading",true,function(){n(e)})}}function n(a){a.entityType.navigationProperties.forEach(function(e){var t=e.getInverse();var r=a.getProperty(e.name);if(e.isScalar){if(r){if(t){if(t.isScalar){r.setProperty(t.name,null)}else{var n=r.getProperty(t.name);if(n.length){W(n,a)}}}a.setProperty(e.name,null)}}else{if(t){r.slice(0).forEach(function(e){if(t.isScalar){e.setProperty(t.name,null)}else{}})}r.length=0}})}function p(e,t,r,n){var a=t.validate(r,n);if(a){e._addValidationError(a);return false}else{var i=le.getKey(t,n?n.propertyName:null);e._removeValidationError(i);return true}}return e}(),ve=function(){var e=function e(t,r,n){if(!t){throw new Error("The  ComplexAspect ctor requires an entity as its only argument.")}if(t.complexAspect){return t.complexAspect}if(!(this instanceof e)){return new e(t,r,n)}this.complexObject=t;t.complexAspect=this;this.originalValues={};if(r!=null){this.parent=r;this.parentProperty=n}var a=t.complexType;if(!a){var i=t.prototype._$typeName;if(!i){throw new Error("This entity is not registered as a valid ComplexType")}else{throw new Error("Metadata for this complexType has not yet been resolved: "+i)}}var o=a.getCtor();pe.getDefaultInstance().startTracking(t,o.prototype)};var t=e.prototype;t.getEntityAspect=function(){var e=this.parent;if(!e)return new de(null);var t=e.entityAspect;while(e&&!t){e=e.complexAspect&&e.complexAspect.parent;t=e&&e.entityAspect}return t||new de(null)};t.getPropertyPath=function(e){var t=this.parent;if(!t)return null;var r=t.complexAspect||t.entityAspect;return r.getPropertyPath(this.parentProperty.name+"."+e)};return e}();q.EntityAspect=de,q.ComplexAspect=ve;var me=function(){var t=":::";var e=function e(t,r){ne(t,"entityType").isInstanceOf(Fe).check();var n=t.getSelfAndSubtypes();if(n.length>1){this._subtypes=n.filter(function(e){return e.isAbstract===false})}if(!Array.isArray(r)){r=z(arguments,1)}this.entityType=t;t.keyProperties.forEach(function(e,t){if(e.dataType===_e.Guid){r[t]=r[t]&&r[t].toLowerCase()}});this.values=r;this._keyInGroup=a(r)};e._$typeName="EntityKey";var r=e.prototype;r.toJSON=function(){return{entityType:this.entityType.name,values:this.values}};e.fromJSON=function(e,t){var r=t._getEntityType(e.entityType,true);return new me(r,e.values)};r.equals=function(e){if(!(e instanceof me))return false;return this.entityType===e.entityType&&v(this.values,e.values)};r.toString=function(e){return(e||this.entityType).name+"-"+this._keyInGroup};e.equals=function(e,t){if(!(e instanceof me))return false;return e.equals(t)};r._isEmpty=function(){return this.values.join("").length===0};e.createKeyString=a;function a(e){return e.join(t)}return e}();q.EntityKey=me;var ge=function(){var e={isUnchanged:function(){return this===t.Unchanged},isAdded:function(){return this===t.Added},isModified:function(){return this===t.Modified},isDeleted:function(){return this===t.Deleted},isDetached:function(){return this===t.Detached},isUnchangedOrModified:function(){return this===t.Unchanged||this===t.Modified},isAddedModifiedOrDeleted:function(){return this===t.Added||this===t.Modified||this===t.Deleted}};var t=new oe("EntityState",e);t.Unchanged=t.addSymbol();t.Added=t.addSymbol();t.Modified=t.addSymbol();t.Deleted=t.addSymbol();t.Detached=t.addSymbol();t.resolveSymbols();return t}();function we(e,t,r){if(t===undefined)t=null;var n=r();var a=e.dataType;if(a&&a.parse){if(Array.isArray(t)&&!e.isScalar){t=t.map(function(e){return a.parse(e,typeof e)})}else{t=a.parse(t,typeof t)}}if(t===n||a&&a.normalize&&t&&n&&a.normalize(t)===a.normalize(n)){return}var i;var o=this.entityAspect;if(o){i=e.name}else{var s=this.complexAspect;if(s){o=s.getEntityAspect();i=s.getPropertyPath(e.name)}else{r(t);return}}var u=o._inProcess=o._inProcess||[];if(u.indexOf(e)>=0)return;u.push(e);try{var p={parent:this,property:e,newValue:t,oldValue:n,propertyName:i,entityAspect:o};if(e.isComplexProperty){Ee(p,r)}else if(e.isDataProperty){Se(p,r)}else{Te(p,r)}Pe(p)}finally{u.pop()}}function Se(e,t){var i=e.parent;var r=e.property;var n=e.entityAspect;var a=e.oldValue;var o=e.newValue;var s=n.entityManager;var u=i.entityType;if(!r.isScalar){throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.")}if(n.entityState.isUnchangedOrModified()){var p=r.name;var c=i.entityAspect||i.complexAspect;if(c.originalValues[p]===undefined){c.originalValues[p]=a!==undefined?a:r.defaultValue}}if(r.isPartOfKey&&s&&!s.isLoading){var f=u.keyProperties;var l=f.map(function(e){if(e===r){return o}else{return i.getProperty(e.name)}});var y=new me(u,l);if(s.findEntityByKey(y)){throw new Error("An entity with this key is already in the cache: "+y.toString())}var h=i.entityAspect.getKey();var d=s._findEntityGroup(u);d._replaceKey(h,y)}var v=r.relatedNavigationProperty;if(v&&s){if(o!=null){var m=new me(v.entityType,[o]);var g=s.findEntityByKey(m);if(g){i.setProperty(v.name,g)}else{s._unattachedChildrenMap.addChild(m,v,i);i.setProperty(v.name,null)}}else{i.setProperty(v.name,null)}}else if(r.inverseNavigationProperty&&s&&!s._inKeyFixup){var w=r.inverseNavigationProperty;if(a!=null){m=new me(w.parentType,[a]);g=s.findEntityByKey(m);if(g){if(w.isScalar){g.setProperty(w.name,null)}else{var S=g.getProperty(w.name);S.splice(S.indexOf(i),1)}}}if(o!=null){m=new me(w.parentType,[o]);g=s.findEntityByKey(m);if(g){if(w.isScalar){g.setProperty(w.name,i)}else{g.getProperty(w.name).push(i)}}else{s._unattachedChildrenMap.addChild(m,w,i)}}}t(o);be(e);if(r.isPartOfKey){var E=u.keyProperties.indexOf(r);u.navigationProperties.forEach(function(e){var t=e.getInverse();var r=t?t.foreignKeyNames:e.invForeignKeyNames;if(r.length===0)return;var n=i.getProperty(e.name);if(!n)return;var a=r[E];if(e.isScalar){n.setProperty(a,o)}else{n.forEach(function(e){e.setProperty(a,o)})}});if(s){var T=u.inverseForeignKeyProperties;var P=u.baseEntityType;while(P){T=T.concat(P.inverseForeignKeyProperties);P=P.baseEntityType}T.forEach(function(e){if(e.relatedNavigationProperty.inverse==null){s._updateFkVal(e,a,o)}})}n.getKey(true)}}function Ee(e,t){var r=e.property;var n=e.oldValue;var a=e.newValue;var i=r.dataType;if(r.isScalar){if(!a){throw new Error(V("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",r.name,r.dataType.name))}if(!n){var o=i.getCtor();n=new o;t(n)}i.dataProperties.forEach(function(e){var t=e.name;var r=a.getProperty(t);n.setProperty(t,r)})}else{throw new Error(V("You cannot set the non-scalar complex property: '%1' on the type: '%2'."+"Instead get the property and use array functions like 'push' or 'splice' to change its contents.",r.name,r.parentType.name))}}function Te(e,t){var a=e.parent;var i=e.property;var r=e.entityAspect;var n=e.oldValue;var o=e.newValue;if(!i.isScalar){throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.")}var s=r.entityManager;var u=i.getInverse();if(o!=null){var p=o.entityAspect;if(s){if(p.entityState.isDetached()){if(!s.isLoading){s.attachEntity(o,ge.Added)}}else{if(p.entityManager!==s){throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}}}else{if(p&&p.entityManager){s=p.entityManager;if(!s.isLoading){s.attachEntity(r.entity,ge.Added)}}}}if(u){if(u.isScalar){if(n!=null){n.setProperty(u.name,null)}if(o!=null){o.setProperty(u.name,a)}}else{if(n!=null){var c=n.getProperty(u.name);var f=c.indexOf(a);if(f!==-1){c.splice(f,1)}}if(o!=null){var l=o.getProperty(u.name);l.push(a)}}}else if(i.invForeignKeyNames&&s&&!s._inKeyFixup){var y=i.invForeignKeyNames;if(o!=null){var h=a.entityAspect.getKey().values;y.forEach(function(e,t){o.setProperty(e,h[t])})}else{if(n!=null){y.forEach(function(e){var t=n.entityType.getProperty(e);if(!t.isPartOfKey){n.setProperty(e,null)}})}}}t(o);be(e);if(i.relatedDataProperties){var d=r.entityState;if(o==null&&(d.isDetached()||n.entityAspect.entityState.isDetached()))return;if(d.isDeleted())return;var v=i.entityType.keyProperties;v.forEach(function(e,t){var r=i.relatedDataProperties[t];if(o||!r.isPartOfKey){var n=o?o.getProperty(e.name):r.defaultValue;a.setProperty(r.name,n)}})}}function Pe(e){var t=e.entityAspect;var r=t.entityManager;var n=t.entity;var a={entity:n,parent:e.parent,property:e.property,propertyName:e.propertyName,oldValue:e.oldValue,newValue:e.newValue};if(r){if(!r.isLoading&&!r.isRejectingChanges){t.propertyChanged.publish(a);r.entityChanged.publish({entityAction:he.PropertyChange,entity:n,args:a})}}else{t.propertyChanged.publish(a)}}function be(e){var t=e.entityAspect;var r=t.entityManager;if(r==null||r.isLoading)return;var n=e.property;if(t.entityState.isUnchanged()&&!n.isUnmapped){t.setModified()}if(r.validationOptions.validateOnPropertyChange){t._validateProperty(e.newValue,{entity:t.entity,property:n,propertyName:e.propertyName,oldValue:e.oldValue})}}q.EntityState=ge,q.makePrimitiveArray=function(){var n={};n._getGoodAdds=function(e){return e};n._beforeChange=function(){var e=this.getEntityAspect();if(e.entityState.isUnchanged()){e.setModified()}if(e.entityState.isModified()&&!this._origValues){this._origValues=this.slice(0)}};n._processAdds=function(e){};n._processRemoves=function(e){};n._rejectChanges=function(){if(!this._origValues)return;this.length=0;Array.prototype.push.apply(this,this._origValues)};n._acceptChanges=function(){this._origValues=null};function e(e,t,r){ce.initializeParent(e,t,r);e.arrayChanged=new se("arrayChanged",e);L(e,ce.mixin);return L(e,n)}return e}(),q.makeRelationArray=function(){var n={};n.load=function(e,t){var r=this.parentEntity;var n=Le.fromEntityNavigation(this.parentEntity,this.navigationProperty);var a=r.entityAspect.entityManager;return a.executeQuery(n,e,t)};n._getEventParent=function(){return this.parentEntity.entityAspect};n._getPendingPubs=function(){var e=this.parentEntity.entityAspect.entityManager;return e&&e._pendingPubs};n._getGoodAdds=function(e){return t(this,e)};n._processAdds=function(e){r(this,e)};n._processRemoves=function(e){a(this,e)};function t(t,e){var r=i(t,e);if(!r.length){return r}var n=t.parentEntity;var a=n.entityAspect.entityManager;if(a&&!a.isLoading){r.forEach(function(e){if(e.entityAspect.entityState.isDetached()){t._inProgress=true;try{a.attachEntity(e,ge.Added)}finally{t._inProgress=false}}})}return r}function r(e,t){var a=e.parentEntity;var i=e.navigationProperty;var o=e._addsInProcess;var s=i.getInverse();var r=o.length;try{t.forEach(function(r){o.push(r);if(s){r.setProperty(s.name,a)}else{var n=a.entityType.keyProperties;i.invForeignKeyNames.forEach(function(e,t){r.setProperty(e,a.getProperty(n[t].name))})}})}finally{o.splice(r,t.length)}}function a(e,t){var r=e.navigationProperty.getInverse();if(r){t.forEach(function(e){e.setProperty(r.name,null)})}}function i(r,e){var o=r.parentEntity;var t=r.navigationProperty;var n=t.getInverse();var a;if(n){a=e.filter(function(e){if(r._addsInProcess.indexOf(e)>=0){return false}var t=e.getProperty(n.name);return t!==o})}else{var s=t.invForeignKeyNames;if(t.baseProperty&&!s.length)s=t.baseProperty.invForeignKeyNames;var u=o.entityType.keyProperties;a=e.filter(function(i){if(r._addsInProcess.indexOf(i)>=0){return false}return s.some(function(e,t){var r=u[t].name;var n=o.getProperty(r);var a=i.getProperty(e);return n!==a})})}return a}function e(e,t,r){e.parentEntity=t;e.navigationProperty=r;e.arrayChanged=new se("arrayChanged",e);e._addsInProcess=[];L(e,ce.mixin);return L(e,n)}return e}();var _e=function(){var e={};var t;var r=function(){t={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1}};r();var n=function(){return t.stringPrefix+a().toString()};var a=function(){var e=t.nextNumber;t.nextNumber+=t.nextNumberIncrement;return e};var i=function(){return x()};var o=function(){return new Date};var s=function(e){var t=new Date;var r=new Date;while(t.getTime()===r.getTime()){r=new Date}return r};var u=function(e,t){return e==null?e:e.toString()};var p=function(e,t){if(t==="string"){return e.trim().toLowerCase()}return e};var c=function(e,t){if(t==="string"){var r=e.trim();if(r==="")return null;var n=parseInt(r,10);return isNaN(n)?e:n}else if(t==="number"){return Math.round(e)}return e};var f=function(e,t){if(t==="string"){var r=e.trim();if(r==="")return null;var n=parseFloat(r);return isNaN(n)?e:n}return e};var l=function(e,t){var r;if(t==="string"){var n=e.trim();if(n==="")return null;r=new Date(Date.parse(n));return M(r)?r:e}else if(t==="number"){r=new Date(e);return M(r)?r:e}return e};var y=function(e,t){if(t==="string"){var r=e.trim().toLowerCase();if(r==="false"||r===""){return false}else if(r==="true"){return true}else{return e}}return e};var h=function(e){return e==null?null:"'"+e.replace(/'/g,"''")+"'"};var d=function(e){return e==null?null:typeof e==="string"?parseInt(e,10):e};var v=function(t){return function(e){if(e==null)return null;if(typeof e==="string"){e=parseFloat(e)}return e+t}};var m=function(t){if(t==null)return null;try{return"datetime'"+t.toISOString()+"'"}catch(e){b("'%1' is not a valid dateTime",t)}};var g=function(t){if(t==null)return null;try{return"datetimeoffset'"+t.toISOString()+"'"}catch(e){b("'%1' is not a valid dateTime",t)}};var w=function(e){if(e==null)return null;if(!I(e)){b("'%1' is not a valid ISO 8601 duration",e)}return"time'"+e+"'"};var S=function(e){if(e==null)return null;if(!D(e)){b("'%1' is not a valid guid",e)}return"guid'"+e+"'"};var E=function(e){if(e==null)return null;if(typeof e==="string"){return e.trim().toLowerCase()==="true"}else{return!!e}};var T=function(e){if(e==null)return e;return"binary'"+e+"'"};var P=function(e){return e};function b(e,t){e=V(e,t);throw new Error(e)}var _=function(e){if(!M(e)){e=O.parseDateFromServer(e)}return e};var N=function(e){if(e&&e.$value!==undefined){e=e.$value}return e};var O=new oe("DataType",e);O.String=O.addSymbol({defaultValue:"",parse:u,fmtOData:h,getNext:n});O.Int64=O.addSymbol({defaultValue:0,isNumeric:true,isInteger:true,quoteJsonOData:true,parse:c,fmtOData:v("L"),getNext:a});O.Int32=O.addSymbol({defaultValue:0,isNumeric:true,isInteger:true,parse:c,fmtOData:d,getNext:a});O.Int16=O.addSymbol({defaultValue:0,isNumeric:true,isInteger:true,parse:c,fmtOData:d,getNext:a});O.Byte=O.addSymbol({defaultValue:0,isNumeric:true,isInteger:true,parse:c,fmtOData:d});O.Decimal=O.addSymbol({defaultValue:0,isNumeric:true,quoteJsonOData:true,isFloat:true,parse:f,fmtOData:v("m"),getNext:a});O.Double=O.addSymbol({defaultValue:0,isNumeric:true,isFloat:true,parse:f,fmtOData:v("d"),getNext:a});O.Single=O.addSymbol({defaultValue:0,isNumeric:true,isFloat:true,parse:f,fmtOData:v("f"),getNext:a});O.DateTime=O.addSymbol({defaultValue:new Date(1900,0,1),isDate:true,parse:l,parseRawValue:_,normalize:function(e){return e&&e.getTime&&e.getTime()},fmtOData:m,getNext:o,getConcurrencyValue:s});O.DateTimeOffset=O.addSymbol({defaultValue:new Date(1900,0,1),isDate:true,parse:l,parseRawValue:_,normalize:function(e){return e&&e.getTime&&e.getTime()},fmtOData:g,getNext:o,getConcurrencyValue:s});O.Time=O.addSymbol({defaultValue:"PT0S",fmtOData:w,parseRawValue:O.parseTimeFromServer});O.Boolean=O.addSymbol({defaultValue:false,parse:y,fmtOData:E});O.Guid=O.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",parse:p,fmtOData:S,getNext:i,parseRawValue:function(e){return e.toLowerCase()},getConcurrencyValue:x});O.Binary=O.addSymbol({defaultValue:null,fmtOData:T,parseRawValue:N});O.Undefined=O.addSymbol({defaultValue:undefined,fmtOData:P});O.resolveSymbols();O.getComparableFn=function(e){if(e&&e.normalize){return e.normalize}else if(e===O.Time){return function(e){return e&&F(e)}}else{return function(e){return e}}};O.fromEdmDataType=function(e){var t=null;var r=e.split(".");if(r.length>1){var n=r[1];if(n==="image"){t=O.Byte}else if(r.length===2){t=O.fromName(n)||O.Undefined}else{t=O.String}}return t};O.fromValue=function(e){if(M(e))return O.DateTime;switch(typeof e){case"string":if(D(e))return O.Guid;else if(I(e)&&e.length>3)return O.Time;else if(k(e))return O.DateTime;return O.String;case"boolean":return O.Boolean;case"number":return O.Double}return O.Undefined};var A=/.\d{3}$/;O.parseTimeFromServer=function(e){if(typeof e==="string"){return e}if(e&&e.__edmType==="Edm.Time"){var t=Math.floor(e.ms/1e3);return"PT"+t+"S"}return e};O.parseDateAsUTC=function(e){if(typeof e==="string"){var t=A.test(e);e=t?e+"Z":e}e=new Date(Date.parse(e));return e};O.parseDateFromServer=O.parseDateAsUTC;O.parseRawValue=function(e,t){if(e===undefined)return undefined;if(!e)return e;if(t&&t.parseRawValue){e=t.parseRawValue(e)}return e};O.constants=t;O._resetConstants=r;O.getSymbols().forEach(function(e){e.validatorCtor=C(e)});function C(e){switch(e){case O.String:return fe.string;case O.Int64:return fe.int64;case O.Int32:return fe.int32;case O.Int16:return fe.int16;case O.Decimal:return fe.number;case O.Double:return fe.number;case O.Single:return fe.number;case O.DateTime:return fe.date;case O.DateTimeOffset:return fe.date;case O.Boolean:return fe.bool;case O.Guid:return fe.guid;case O.Byte:return fe.byte;case O.Binary:return fe.none;case O.Time:return fe.duration;case O.Undefined:return fe.none}}return O}();q.DataType=_e;var Ne=function(){var e=function e(t){r(this,t)};var t=e.prototype;t._$typeName="DataService";t.using=function(e){if(!e)return this;var t=new Ne(this);return r(t,e)};e.resolve=function(e){e.push({hasServerMetadata:true,useJsonp:false});var t=new Ne(p(e,["serviceName","adapterName","uriBuilderName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName){throw new Error("Unable to resolve a 'serviceName' for this dataService")}t.adapterInstance=t.adapterInstance||ue.getAdapterInstance("dataService",t.adapterName);t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter;t.uriBuilder=t.uriBuilder||ue.getAdapterInstance("uriBuilder",t.uriBuilderName);return t};function r(e,t){if(t){ie(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("uriBuilderName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(Oe).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(e);e.serviceName=e.serviceName&&Ne._normalizeServiceName(e.serviceName);e.adapterInstance=e.adapterName&&ue.getAdapterInstance("dataService",e.adapterName);e.uriBuilder=e.uriBuilderName&&ue.getAdapterInstance("uriBuilder",e.uriBuilderName)}return e}e._normalizeServiceName=function(e){e=e.trim();if(e.substr(-1)!=="/"){return e+"/"}else{return e}};t.toJSON=function(){return h(this,{serviceName:null,adapterName:null,uriBuilderName:null,hasServerMetadata:null,jsonResultsAdapter:function(e){return e&&e.name},useJsonp:null})};e.fromJSON=function(e){e.jsonResultsAdapter=ue._fetchObject(Oe,e.jsonResultsAdapter);return new Ne(e)};t.qualifyUrl=function(e){var t=this.serviceName;if(R.stringEndsWith(t,"/")){t=t.substr(0,t.length-1)}e="/"+e;if(!R.stringEndsWith(t,e)){t=t+e}return t};return e}(),Oe=function(){var e=function e(t){if(arguments.length!==1){throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.")}ie(t).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(n).whereParam("extractSaveResults").isFunction().isOptional().withDefault(a).whereParam("extractKeyMappings").isFunction().isOptional().withDefault(i).whereParam("extractDeletedKeys").isFunction().isOptional().withDefault(o).whereParam("visitNode").isFunction().applyAll(this);ue._storeObject(this,r._$typeName,this.name)};var r=e.prototype;r._$typeName="JsonResultsAdapter";function n(e){return e.results}function a(e){return e.entities||e.Entities||[]}function i(e){return e.keyMappings||e.KeyMappings||[]}function o(e){return e.deletedKeys||e.DeletedKeys||[]}return e}();q.DataService=Ne,q.JsonResultsAdapter=Oe;var Ae=R.requireLib("Q;q");if(!Ae){Ae=function(){var e="Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q";throw new Error(e)};Ae.defer=Ae.resolve=Ae.reject=Ae}q.config.setQ=function(e){q.Q=Ae=e},q.Q=Ae;var Ce=function(){var r=0;var e=function e(t){t=t||{};ie(t).whereParam("namingConvention").isOptional().isInstanceOf(Be).withDefault(Be.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(Ue).withDefault(Ue.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this);this.dataServices=[];this._resourceEntityTypeMap={};this._structuralTypeMap={};this._shortNameMap={};this._ctorRegistry={};this._incompleteTypeMap={};this._incompleteComplexTypeMap={};this._id=r++;this.metadataFetched=new se("metadataFetched",this)};var t=e.prototype;t._$typeName="MetadataStore";se.bubbleEvent(t,null);e.ANONTYPE_PREFIX="_IB_";e.normalizeTypeName=m(function(e){return e&&Ve(e).typeName});t.setProperties=function(e){ie(e).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)};t.addDataService=function(e,t){ne(e,"dataService").isInstanceOf(Ne).check();ne(t,"shouldOverwrite").isBoolean().isOptional().check();var r=this._getDataServiceIndex(e.serviceName);if(r>=0){if(!!t){this.dataServices[r]=e}else{throw new Error("A dataService with this name '"+e.serviceName+"' already exists in this MetadataStore")}}else{this.dataServices.push(e)}};t._getDataServiceIndex=function(t){return f(this.dataServices,function(e){return e.serviceName===t})};t.addEntityType=function(t){if(!(t instanceof Fe||t instanceof Me)){t=t.isComplexType?new Me(t):new Fe(t)}if(!t.isComplexType){if(t.baseTypeName&&!t.baseEntityType){var e=this._getEntityType(t.baseTypeName,true);t._updateFromBase(e)}if(t.keyProperties.length===0&&!t.isAbstract){throw new Error("Unable to add "+t.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.")}}t.metadataStore=this;if(!t.isAnonymous){if(this._structuralTypeMap[t.name]){throw new Error("Type "+t.name+" already exists in this MetadataStore.")}this._structuralTypeMap[t.name]=t;this._shortNameMap[t.shortName]=t.name}t.getProperties().forEach(function(e){t._updateNames(e);if(!e.isUnmapped){t._mappedPropertiesCount++}});t._updateCps();if(!t.isComplexType){t._updateNps();var r=t.defaultResourceName||t.baseEntityType&&t.baseEntityType.defaultResourceName;if(r&&!this.getEntityTypeNameForResourceName(r)){this.setEntityTypeForResourceName(r,t.name)}t.defaultResourceName=r;t.getEntityCtor()}};t.exportMetadata=function(){var e=JSON.stringify({metadataVersion:q.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:B(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,ue.stringifyPad);return e};t.importMetadata=function(e,t){ne(t,"allowMerge").isOptional().isBoolean().check();this._deferredTypes={};var r=typeof e==="string"?JSON.parse(e):e;if(r.schema){return xe.parse(this,r.schema,r.altMetadata)}if(r.metadataVersion&&r.metadataVersion!==q.metadataVersion){var n=V("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",r.metadataVersion,q.metadataVersion);throw new Error(n)}var a=r.namingConvention;var i=r.localQueryComparisonOptions;if(this.isEmpty()){this.namingConvention=ue._fetchObject(Be,a)||this.namingConvention;this.localQueryComparisonOptions=ue._fetchObject(Ue,i)||this.localQueryComparisonOptions}else{if(a&&this.namingConvention.name!==a){throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore")}if(i&&this.localQueryComparisonOptions.name!==i){throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}}var o=this;r.dataServices&&r.dataServices.forEach(function(e){e=Ne.fromJSON(e);o.addDataService(e,true)});var s=this._structuralTypeMap;r.structuralTypes&&r.structuralTypes.forEach(function(e){u(o,e,t)});L(this._resourceEntityTypeMap,r.resourceEntityTypeMap);L(this._incompleteTypeMap,r.incompleteTypeMap);return this};e.importMetadata=function(e){var t=new Ce;t.importMetadata(e);return t};t.hasMetadataFor=function(e){return!!this.getDataService(e)};t.getDataService=function(t){ne(t,"serviceName").isString().check();t=Ne._normalizeServiceName(t);return Z(this.dataServices,function(e){return e.serviceName===t})};t.fetchMetadata=function(t,r,n){try{ne(t,"dataService").isString().or().isInstanceOf(Ne).check();ne(r,"callback").isFunction().isOptional().check();ne(n,"errorCallback").isFunction().isOptional().check();if(typeof t==="string"){t=this.getDataService(t)||new Ne({serviceName:t})}t=Ne.resolve([t]);if(this.hasMetadataFor(t.serviceName)){throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+t.serviceName)}var a=this;return t.adapterInstance.fetchMetadata(this,t).then(function(e){a.metadataFetched.publish({metadataStore:a,dataService:t,rawMetadata:e});if(r)r(e);return Ae.resolve(e)},function(e){if(n)n(e);return Ae.reject(e)})}catch(e){return Ae.reject(e)}};t.trackUnmappedType=function(e,t){ne(e,"entityCtor").isFunction().check();ne(t,"interceptor").isFunction().isOptional().check();var r=new Fe(this);r._setCtor(e,t)};t.registerEntityTypeCtor=function(e,t,r,n){ne(e,"structuralTypeName").isString().check();ne(t,"aCtor").isFunction().isOptional().check();ne(r,"initFn").isOptional().isFunction().or().isString().check();ne(n,"noTrackingFn").isOptional().isFunction().check();var a=c(this,e,false);var i=a||e;if(t){if(t._$typeName&&t._$typeName!=i){console.warn("Registering a constructor for "+i+" that is already used for "+t._$typeName+".")}t._$typeName=i}this._ctorRegistry[i]={ctor:t,initFn:r,noTrackingFn:n};if(a){var o=this._structuralTypeMap[a];o&&o.getCtor(true)}};t.isEmpty=function(){return re(this._structuralTypeMap)};t.getEntityType=function(e,t){ne(e,"structuralTypeName").isString().check();ne(t,"okIfNotFound").isBoolean().isOptional().check(false);return this._getEntityType(e,t)};t._getEntityType=function(e,t){var r=c(this,e,false);var n=this._structuralTypeMap[r];if(!n){if(t)return null;var a=V("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",e);throw new Error(a)}if(n.length){var i=n.join(",");throw new Error("There are multiple types with this 'shortName': "+i)}return n};t.getEntityTypes=function(){return n(this._structuralTypeMap)};t.getIncompleteNavigationProperties=function(){return B(this._incompleteTypeMap,function(e,t){return t})};t.getEntityTypeNameForResourceName=function(e){ne(e,"resourceName").isString().check();return this._resourceEntityTypeMap[e]};t.setEntityTypeForResourceName=function(e,t){ne(e,"resourceName").isString().check();ne(t,"entityTypeOrName").isInstanceOf(Fe).or().isString().check();var r;if(t instanceof Fe){r=t.name}else{r=c(this,t,true)}this._resourceEntityTypeMap[e]=r;var n=this._getEntityType(r,true);if(n&&!n.defaultResourceName){n.defaultResourceName=e}};t._checkEntityType=function(e){if(e.entityType)return;var t=e.prototype._$typeName;if(!t){throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method")}var r=this._getEntityType(t);if(r){e.entityType=r}};function n(e){var t=[];for(var r in e){var n=e[r];if(r===n.name){t.push(e[r])}}return t}function u(e,t,r){var n=Ke(t.shortName,t.namespace);var a=e._getEntityType(n,true);if(a){if(r){return s(a,t)}else{return a}}var i={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:Ie.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName,custom:t.custom};a=t.isComplexType?new Me(i):new Fe(i);if(t.baseTypeName){a.baseTypeName=t.baseTypeName;var o=e._getEntityType(t.baseTypeName,true);if(o){p(e,t,a,o)}else{X(e._deferredTypes,t.baseTypeName).push({json:t,stype:a})}}else{p(e,t,a)}return a}function s(e,t){if(t.custom){e.custom=t.custom}a(e,t.dataProperties);a(e,t.navigationProperties);return e}function a(n,e){if(!e)return;e.forEach(function(e){var t=e.name;if(!t){if(e.nameOnServer){t=n.metadataStore.namingConvention.serverPropertyNameToClient(e.nameOnServer,{})}else{throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes")}}if(e.custom){var r=n.getProperty(t,true);r.custom=e.custom}})}function p(t,e,r){if(e.validators){r.validators=e.validators.map(fe.fromJSON)}e.dataProperties.forEach(function(e){r._addPropertyCore(ke.fromJSON(e))});var n=!e.isComplexType;if(n){e.navigationProperties&&e.navigationProperties.forEach(function(e){r._addPropertyCore(De.fromJSON(e))})}t.addEntityType(r);var a=t._deferredTypes;var i=a[r.name];if(i){i.forEach(function(e){p(t,e.json,e.stype)});delete a[r.name]}}function c(e,t,r){if(Re(t))return t;var n=e._shortNameMap[t];if(!n&&r){throw new Error("Unable to locate 'entityTypeName' of: "+t)}return n}return e}(),xe=function(){function e(n,a,e){n._entityTypeResourceMap={};a=Q(a);a.forEach(function(r){if(r.cSpaceOSpaceMapping){var e=JSON.parse(r.cSpaceOSpaceMapping);var t={};e.forEach(function(e){t[e[0]]=e[1]});r.cSpaceOSpaceMapping=t}if(r.entityContainer){Q(r.entityContainer).forEach(function(e){Q(e.entitySet).forEach(function(e){var t=v(e.entityType,r).typeName;n.setEntityTypeForResourceName(e.name,t);n._entityTypeResourceMap[t]=e.name})})}if(r.complexType){Q(r.complexType).forEach(function(e){var t=o(e,r,n)})}if(r.entityType){Q(r.entityType).forEach(function(e){var t=i(e,r,a,n)})}});var t=n.getIncompleteNavigationProperties();if(t.length>0){var r=t.map(function(e){if(Array.isArray(e)){return e.map(function(e){return e.parentType.name+":"+e.name}).join(", ")}return e.parentType.name+":"+e.name}).join(", ");throw new Error("Incomplete navigation properties: "+r)}if(e){n.importMetadata(e,true)}return n}function i(e,t,r,n){var a=e.name;var i=m(a,t);var o=new Fe({shortName:a,namespace:i,isAbstract:e.abstract&&e.abstract==="true"});if(e.baseType){var s=v(e.baseType,t).typeName;o.baseTypeName=s;var u=n._getEntityType(s,true);if(u){c(o,e,t,r,n)}else{var p=n._deferredTypes[s];if(!p){p=[];n._deferredTypes[s]=p}p.push({entityType:o,csdlEntityType:e})}}else{c(o,e,t,r,n)}return o}function c(t,e,r,n,a){var i=e.key?Q(e.key.propertyRef).map(g("name")):[];Q(e.property).forEach(function(e){u(t,e,r,i)});Q(e.navigationProperty).forEach(function(e){f(t,e,r,n)});a.addEntityType(t);t.defaultResourceName=a._entityTypeResourceMap[t.name];var o=a._deferredTypes;var s=o[t.name];if(s){s.forEach(function(e){c(e.entityType,e.csdlEntityType,r,n,a)});delete o[t.name]}}function o(e,t,r){var n=e.name;var a=m(n,t);var i=new Me({shortName:n,namespace:a});Q(e.property).forEach(function(e){u(i,e,t)});r.addEntityType(i);return i}function u(e,t,r,n){var a;var i=t.type.split(".");if(i[0]==="Edm"&&i.length===2){a=s(e,t,n)}else{if(l(t,r)){a=s(e,t,n);if(a){a.enumType=t.type}}else{a=p(e,t,r)}}if(a){e._addPropertyCore(a);y(a)}return a}function s(e,t,r){var n=_e.fromEdmDataType(t.type);if(n==null){e.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type);return null}var a=t.nullable==="true"||t.nullable==null;var i=r!=null&&r.indexOf(t.name)>=0;if(i&&e.autoGeneratedKeyType===Ie.None){if(h(t)){e.autoGeneratedKeyType=Ie.Identity}}var o=t.maxLength;o=o==null||o==="Max"?null:parseInt(o,10);var s=new ke({nameOnServer:t.name,dataType:n,isNullable:a,isPartOfKey:i,maxLength:o,defaultValue:t.defaultValue,concurrencyMode:t.concurrencyMode});if(n===_e.Undefined){s.rawTypeName=t.type}return s}function p(e,t,r){var n=v(t.type,r).typeName;var a=new ke({nameOnServer:t.name,complexTypeName:n,isNullable:false});return a}function f(e,t,r,n){var a=d(t,r,n);if(!a){throw new Error("Unable to resolve Foreign Key Association: "+t.relationship)}var i=Z(a.end,function(e){return e.role===t.toRole});var o=i.multiplicity!=="*";var s=v(i.type,r).typeName;var u=a.referentialConstraint;if(!u){if(a.end[0].multiplicity=="*"&&a.end[1].multiplicity=="*"){return}else{}}var p={nameOnServer:t.name,entityTypeName:s,isScalar:o,associationName:a.name};if(u){var c=u.principal;var f=u.dependent;var l=Q(f.propertyRef);var y=l.map(g("name"));if(t.fromRole===c.role){p.invForeignKeyNamesOnServer=y}else{p.foreignKeyNamesOnServer=y}}var h=new De(p);e._addPropertyCore(h);return h}function l(e,t){if(t.enumType)return r(e,t);else if(t.extensions)return n(e,t);else return false}function r(e,t){var r=Q(t.enumType);var n=e.type.split(".");var a=n[n.length-1];return r.some(function(e){return e.name===a})}function n(e,t){var r=t.extensions.filter(function(e){return e.name==="EnumType"});var n=e.type.split(".");var a=n[n.length-1];return r.some(function(e){return e.attributes.some(function(e){return e.name==="Name"&&e.value===a})})}function y(e){var t;if(!e.isNullable){e.validators.push(fe.required())}if(e.isComplexProperty)return;if(e.dataType===_e.String){if(e.maxLength){var r={maxLength:e.maxLength};t=fe.maxLength(r)}else{t=fe.string()}}else{t=e.dataType.validatorCtor()}e.validators.push(t)}function h(e){var t=Z(Object.keys(e),function(e){return e.indexOf("StoreGeneratedPattern")>=0});if(t){return e[t]==="Identity"}else{var r=e.extensions;if(!r){return false}var n=Z(r,function(e){return e.name==="StoreGeneratedPattern"&&e.value==="Identity"});return!!n}}function d(e,t,r){var n=v(e.relationship,t);var a=n.namespace;var i=Z(r,function(e){return e.namespace===a});if(!i)return null;var o=n.shortTypeName;var s=i.association;if(!s)return null;if(!Array.isArray(s)){s=[s]}var u=Z(s,function(e){return e.name===o});return u}function v(e,t){var r=Ve(e);if(t&&t.cSpaceOSpaceMapping){var n=m(r.shortTypeName,t);if(n){r=je(r.shortTypeName,n)}}return r}function m(e,t){var r;var n=t.cSpaceOSpaceMapping;if(n){var a=n[t.namespace+"."+e];r=a&&a.substr(0,a.length-(e.length+1));if(r)return r}if(t.entityType||t.namespace!="Default"){return t.namespace}return null}return{parse:e}}(),Fe=function(){var r=0;var e=function e(t){if(arguments.length>1){throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.")}if(t._$typeName==="MetadataStore"){this.metadataStore=t;this.shortName="Anon_"+ ++r;this.namespace="";this.isAnonymous=true}else{ie(t).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(false).whereParam("autoGeneratedKeyType").isEnumOf(Ie).isOptional().withDefault(Ie.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this)}this.name=Ke(this.shortName,this.namespace);this.dataProperties=[];this.navigationProperties=[];this.complexProperties=[];this.keyProperties=[];this.foreignKeyProperties=[];this.inverseForeignKeyProperties=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.validators=[];this.warnings=[];this._mappedPropertiesCount=0;this.subtypes=[];qe(this,t.dataProperties,ke);qe(this,t.navigationProperties,De)};var t=e.prototype;var p=_e.parseRawValue;t._$typeName="EntityType";e.qualifyTypeName=Ke;t.setProperties=function(e){ie(e).whereParam("autoGeneratedKeyType").isEnumOf(Ie).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this);if(e.defaultResourceName){this.defaultResourceName=e.defaultResourceName}};t.isSubtypeOf=function(e){ne(e,"entityType").isInstanceOf(Fe).check();var t=this;do{if(t===e)return true;t=t.baseEntityType}while(t);return false};t.getSelfAndSubtypes=function(){var r=[this];this.subtypes.forEach(function(e){var t=e.getSelfAndSubtypes();r.push.apply(r,t)});return r};t.getAllValidators=function(){var e=this.validators.slice(0);var t=this.baseEntityType;while(t){e.push.apply(e,t.validators);t=t.baseEntityType}return e};t.addProperty=function(t){ne(t,"property").isInstanceOf(ke).or().isInstanceOf(De).check();var e=this._addPropertyCore(t,true);if(this.subtypes&&this.subtypes.length){var r=this;r.getSelfAndSubtypes().forEach(function(e){if(e!==r){if(t.isNavigationProperty){e._addPropertyCore(new De(t),true)}else{e._addPropertyCore(new ke(t),true)}}})}return e};t._updateFromBase=function(e){this.baseEntityType=e;if(this.autoGeneratedKeyType===Ie.None){this.autoGeneratedKeyType=e.autoGeneratedKeyType}e.dataProperties.forEach(function(e){var t=new ke(e);t.validators=[];t.baseProperty=e;this._addPropertyCore(t)},this);e.navigationProperties.forEach(function(e){var t=new De(e);t.validators=[];t.baseProperty=e;this._addPropertyCore(t)},this);e.subtypes.push(this)};t._addPropertyCore=function(e,t){if(this.isFrozen){throw new Error("The '"+this.name+"' EntityType/ComplexType has been frozen. You can only add properties to an EntityType/ComplexType before any instances of that type have been created and attached to an entityManager.")}var r=e.parentType;if(r){if(r!==this){throw new Error("This property: "+e.name+" has already been added to "+e.parentType.name)}else{return this}}e.parentType=this;var n=this.metadataStore;if(e.isDataProperty){this._addDataProperty(e)}else{this._addNavigationProperty(e);if(t&&n){u(e,n)}}if(n&&!(e.name&&e.nameOnServer)){i(n.namingConvention,e,"name")}if(n&&this._extra){if(this._extra.alreadyWrappedProps){var a=this._ctor.prototype;pe.getDefaultInstance().initializeEntityPrototype(a)}}return this};t.createEntity=function(i){if(i&&i._$eref&&!i._$eref.entityAspect.entityManager)return i._$eref;var o=this._createInstanceCore();if(i){if(this.keyProperties.every(function(e){return i[e.name]!=null})){i._$eref=o}this._updateTargetFromRaw(o,i,n);this.navigationProperties.forEach(function(e){var t;var r=i[e.name];if(r!=undefined){var n=e.entityType;if(e.isScalar){t=r.entityAspect?r:n.createEntity(r);o.setProperty(e.name,t)}else{var a=o.getProperty(e.name);r.forEach(function(e){t=e.entityAspect?e:n.createEntity(e);a.push(t)})}}})}this._initializeInstance(o);return o};function n(e,t){return e.entityAspect||e.complexAspect?e.getProperty(t.name):e[t.name]}t._createInstanceCore=function(){var e=this.getEntityCtor();var t=new e;new de(t);return t};t._initializeInstance=function(r){if(this.baseEntityType){this.baseEntityType._initializeInstance(r)}var e=this.initFn;if(e){if(typeof e==="string"){e=r[e]}e(r)}this.complexProperties&&this.complexProperties.forEach(function(t){var e=r.getProperty(t.name);if(Array.isArray(e)){e.forEach(function(e){t.dataType._initializeInstance(e)})}else{t.dataType._initializeInstance(e)}});if(r.entityAspect){r.entityAspect._initialized=true}};t.getCtor=t.getEntityCtor=function(e){if(this._ctor&&!e)return this._ctor;var t=this.metadataStore._ctorRegistry;var r=t[this.name]||t[this.shortName]||{};var n=r.ctor||this._ctor;var a=n&&n.prototype&&(n.prototype.entityType||n.prototype.complexType);if(a&&a.metadataStore!==this.metadataStore){throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.")}if(r.ctor&&e){this._extra=undefined}if(!n){var i=pe.getDefaultInstance().createCtor;n=i?i(this):o(this)}this.initFn=r.initFn;this.noTrackingFn=r.noTrackingFn;n.prototype._$typeName=this.name;this._setCtor(n);return n};function o(e){var t=e.name.replace(/\W/g,"_");return Function("return function "+t+"(){}")()}t._setCtor=function(e,t){var r=e.prototype;this._extra=this._extra||{};var n=new e;f(this,n);if(this._$typeName==="EntityType"){r.entityType=this}else{r.complexType=this}r._$interceptor=t||we;pe.getDefaultInstance().initializeEntityPrototype(r);this._ctor=e};t.addValidator=function(e,t){ne(e,"validator").isInstanceOf(fe).check();ne(t,"property").isOptional().isString().or().isEntityProperty().check();if(t){if(typeof t==="string"){t=this.getProperty(t,true)}t.validators.push(e)}else{this.validators.push(e)}};t.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)};t.getPropertyNames=function(){return this.getProperties().map(g("name"))};t.getDataProperty=function(e){return Z(this.dataProperties,y("name",e))};t.getNavigationProperty=function(e){return Z(this.navigationProperties,y("name",e))};t.getProperty=function(e,t){var r=this.getPropertiesOnPath(e,false,t);return r?r[r.length-1]:null};t.getPropertiesOnPath=function(e,t,r){r=r||false;var n=Array.isArray(e)?e:e.trim().split(".");var a=true;var i=this;var o=t?"nameOnServer":"name";var s=n.map(function(e){var t=Z(i.getProperties(),y(o,e));if(t){i=t.isNavigationProperty?t.entityType:t.dataType}else if(r){throw new Error("unable to locate property: "+e+" on entityType: "+i.name)}else{a=false}return t});return a?s:null};t.clientPropertyPathToServer=function(e,t){var t=t||".";var r;if(this.isAnonymous){var n=this.metadataStore.namingConvention.clientPropertyNameToServer;r=e.split(".").map(function(e){return n(e)})}else{r=this.getPropertiesOnPath(e,false,true).map(function(e){return e.nameOnServer})}return r.join(t)};t.getEntityKeyFromRawEntity=function(r,n){var e=this.keyProperties.map(function(e){var t=n(r,e);return p(t,e.dataType)});return new me(this,e)};t._updateTargetFromRaw=function(o,s,u){this.dataProperties.forEach(function(r){if(!r.isSettable)return;var e=u(s,r);if(e===undefined)return;var n=r.dataType;var t;if(r.isComplexProperty){if(e===null)return;t=o.getProperty(r.name);if(r.isScalar){n._updateTargetFromRaw(t,e,u)}else{if(Array.isArray(e)){var a=e.map(function(e){var t=n._createInstanceCore(o,r);n._updateTargetFromRaw(t,e,u);n._initializeInstance(t);return t});if(!v(t,a,c)){t.length=0;a.forEach(function(e){t.push(e)})}}else{t.length=0}}}else{var i;if(r.isScalar){var a=p(e,n);o.setProperty(r.name,a)}else{t=o.getProperty(r.name);if(Array.isArray(e)){var a=e.map(function(e){return p(e,n)});if(!v(t,a)){t.length=0;a.forEach(function(e){t.push(e)})}}else{t.length=0}}}});var e=s.entityAspect||s.complexAspect;if(e){var t=o.entityAspect||o.complexAspect;if(e.originalValuesMap){t.originalValues=e.originalValuesMap}if(e.extraMetadata){t.extraMetadata=e.extraMetadata}}};function c(a,i){var e=a.complexAspect.parentProperty.dataType.dataProperties;var t=e.every(function(e){if(!e.isSettable)return true;var t=a.getProperty(e.name);var r=i.getProperty(e.name);if(e.isComplexProperty&&e.isScalar){return c(t,r)}else if(e.isComplexProperty&&!e.isScalar){return v(t,r,c)}else{var n=e.dataType;return t===r||n&&n.normalize&&t&&r&&n.normalize(t)===n.normalize(r)}});return t}t.toString=function(){return this.name};t.toJSON=function(){return h(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:false,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:a,navigationProperties:a,validators:null,custom:null})};function a(e){return e.filter(function(e){return e.baseProperty==null})}t._updateNames=function(e){var t=this.metadataStore.namingConvention;i(t,e,"name");if(e.isNavigationProperty){i(t,e,"foreignKeyNames");i(t,e,"invForeignKeyNames")}};function i(n,a,e){var t=e+"OnServer";var r=a[e];if(r&&r.length){var i=Q(r).map(function(e){var t=n.clientPropertyNameToServer(e,a);var r=n.serverPropertyNameToClient(t,a);if(e!==r){throw new Error("NamingConvention for this client property name does not roundtrip properly:"+e+"--\x3e"+r)}return t});a[t]=Array.isArray(r)?i:i[0]}else{var o=a[t];if(!o||o.length===0)return;var s=Q(o).map(function(e){var t=n.serverPropertyNameToClient(e,a);var r=n.clientPropertyNameToServer(t,a);if(e!==r){throw new Error("NamingConvention for this server property name does not roundtrip properly:"+e+"--\x3e"+r)}return t});a[e]=Array.isArray(o)?s:s[0]}}t._checkNavProperty=function(e){if(e.isNavigationProperty){if(e.parentType!==this){throw new Error(V("The navigationProperty '%1' is not a property of entity type '%2'",e.name,this.name))}return e}if(typeof e==="string"){var t=this.getProperty(e);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")};t._addDataProperty=function(e){this.dataProperties.push(e);if(e.isPartOfKey){this.keyProperties.push(e)}if(e.isComplexProperty){this.complexProperties.push(e)}if(e.concurrencyMode&&e.concurrencyMode!=="None"){this.concurrencyProperties.push(e)}if(e.isUnmapped){this.unmappedProperties.push(e)}};t._addNavigationProperty=function(e){this.navigationProperties.push(e);if(!Re(e.entityTypeName)){e.entityTypeName=Ke(e.entityTypeName,this.namespace)}};t._updateCps=function(){var t=this.metadataStore;var r=t._incompleteComplexTypeMap;this.complexProperties.forEach(function(e){if(e.complexType)return;if(!s(e,t)){X(r,e.complexTypeName).push(e)}});if(this.isComplexType){(r[this.name]||[]).forEach(function(e){s(e,t)});delete r[this.name]}};function s(e,t){var r=t._getEntityType(e.complexTypeName,true);if(!r)return false;if(!(r instanceof Me)){throw new Error("Unable to resolve ComplexType with the name: "+e.complexTypeName+" for the property: "+property.name)}e.dataType=r;e.defaultValue=null;return true}t._updateNps=function(){var t=this.metadataStore;this.navigationProperties.forEach(function(e){u(e,t)});var e=t._incompleteTypeMap;(e[this.name]||[]).forEach(function(e){u(e,t)});delete e[this.name]};function u(e,t){if(e.entityType)return true;var r=t._getEntityType(e.entityTypeName,true);if(r){e.entityType=r;e._resolveNp()}else{var n=X(t._incompleteTypeMap,e.entityTypeName);d(n,e)}return!!r}function f(a,i){var o=a.getPropertyNames();var e=pe.getDefaultInstance();var t=e.getTrackablePropertyNames(i);t.forEach(function(e){if(o.indexOf(e)===-1){var t=i[e];try{if(typeof t=="function")t=t()}catch(e){}var r=_e.fromValue(t);var n=new ke({name:e,dataType:r,isNullable:true,isUnmapped:true});n.isSettable=l(i,e);if(a.subtypes&&a.subtypes.length){a.getSelfAndSubtypes().forEach(function(e){e._addPropertyCore(new ke(n))})}else{a._addPropertyCore(n)}}})}return e}(),Me=function(){var e=function e(t){if(arguments.length>1){throw new Error("The ComplexType ctor has a single argument that is a configuration object.")}ie(t).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().applyAll(this);this.name=Ke(this.shortName,this.namespace);this.isComplexType=true;this.dataProperties=[];this.complexProperties=[];this.validators=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.navigationProperties=[];this.keyProperties=[];qe(this,t.dataProperties,ke)};var t=e.prototype;t.setProperties=function(e){ie(e).whereParam("custom").isOptional().applyAll(this)};t.getAllValidators=function(){return this.validators};t._createInstanceCore=function(e,t){var r=this.getCtor();var n=new r;new ve(n,e,t);return n};t.addProperty=function(e){ne(e,"dataProperty").isInstanceOf(ke).check();return this._addPropertyCore(e)};t.getProperties=function(){return this.dataProperties};t=L(t,Fe.prototype,["addValidator","getProperty","getPropertiesOnPath","getPropertyNames","_addPropertyCore","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_setCtor"]);t.createInstance=Fe.prototype.createEntity;t.getCtor=Fe.prototype.getEntityCtor;t.toJSON=function(){return h(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})};t._$typeName="ComplexType";return e}(),ke=function(){var e=function e(t){ie(t).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(_e).isOptional().or().isString().or().isInstanceOf(Me).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(true).whereParam("isScalar").isOptional().withDefault(true).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("isSettable").isBoolean().isOptional().withDefault(true).whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(fe).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this);var r=!!(this.name||this.nameOnServer);if(!r){throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property")}if(this.complexTypeName){this.isComplexProperty=true;this.dataType=null}else if(typeof this.dataType==="string"){var n=_e.fromName(this.dataType);if(!n){throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType)}this.dataType=n}else if(!this.dataType){this.dataType=_e.String}if(this.defaultValue==null){if(this.isNullable){this.defaultValue=null}else{if(this.isComplexProperty){}else if(this.dataType===_e.Binary){this.defaultValue="AAAAAAAAJ3U="}else{this.defaultValue=this.dataType.defaultValue;if(this.defaultValue==null){throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+(this.name||this.nameOnServer))}}}}else if(this.dataType.isNumeric){if(typeof this.defaultValue==="string"){this.defaultValue=parseFloat(this.defaultValue)}}if(this.isComplexProperty){this.isScalar=this.isScalar==null||this.isScalar===true}};var t=e.prototype;t._$typeName="DataProperty";e.getRawValueFromServer=function(e,t){if(t.isUnmapped){return e[t.nameOnServer||t.name]}else{var r=e[t.nameOnServer];return r!==undefined?r:t.defaultValue}};e.getRawValueFromClient=function(e,t){var r=e[t.name];return r!==undefined?r:t.defaultValue};t.isDataProperty=true;t.isNavigationProperty=false;t.resolveProperty=function(e){var t=this[e];var r=this.baseProperty;while(t==undefined&&r!=null){t=r[e];r=r.baseProperty}return t};t.formatName=function(){return this.parentType.name+"--"+this.name};t.setProperties=function(e){ie(e).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this)};t.getAllValidators=function(){var e=this.validators.slice(0);var t=this.baseProperty;while(t){e.push.apply(e,t.validators);t=t.baseProperty}return e};t.toJSON=function(){return h(this,{name:null,dataType:function(e){return e&&e.parentEnum?e.name:undefined},complexTypeName:null,isNullable:true,defaultValue:null,isPartOfKey:false,isUnmapped:false,isSettable:true,concurrencyMode:null,maxLength:null,validators:null,displayName:null,enumType:null,rawTypeName:null,isScalar:true,custom:null})};e.fromJSON=function(e){e.dataType=_e.fromName(e.dataType);if(e.defaultValue&&e.dataType&&e.dataType.parse){e.defaultValue=e.dataType.parse(e.defaultValue,typeof e.defaultValue)}if(e.validators){e.validators=e.validators.map(fe.fromJSON)}return new ke(e)};return e}(),De=function(){var e=function e(t){ie(t).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(true).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(fe).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this);var r=!!(this.name||this.nameOnServer);if(!r){throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")}};var t=e.prototype;t._$typeName="NavigationProperty";t.isDataProperty=false;t.isNavigationProperty=true;L(t,ke.prototype,["formatName","getAllValidators","resolveProperty"]);t.setProperties=function(e){if(!this.parentType){throw new Error("Cannot call NavigationProperty.setProperties until the parent EntityType of the NavigationProperty has been set.")}var t=e.inverse;if(t)delete e.inverse;ie(e).whereParam("displayName").isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this);this.parentType._updateNames(this);this._resolveNp();if(t){this.setInverse(t)}};t.getInverse=function(){var e=this;while(!e.inverse&&e.baseProperty){e=e.baseProperty}return e.inverse};t.setInverse=function(e){var t;if(typeof e==="string"){t=this.entityType.getNavigationProperty(e)}else{t=e}if(!t){throw r(this,"Unable to find inverse property: "+invNpName)}if(this.inverse||t.inverse){r(this,"It has already been set on one side or the other.")}if(t.entityType!=this.parentType){r(this,t.formatName+" is not a valid inverse property for this.")}if(this.associationName){t.associationName=this.associationName}else{if(!t.associationName){t.associationName=this.formatName()+"_"+t.formatName()}this.associationName=t.associationName}this._resolveNp();t._resolveNp()};t.createInverse=function(e){if(!this.entityType){n(this,"has not yet been defined.")}if(this.entityType.isFrozen){n(this,"is frozen.")}var t=this.entityType.metadataStore;if(t==null){n(this,"has not yet been added to the metadataStore.")}e.entityTypeName=this.parentEntityType.name;e.associationName=this.associationName;var r=new De(e);this.parentEntityType.addNavigationProperty(r);return r};function r(e,t){throw new Error("Cannot set the inverse property for: "+e.formatName()+". "+t)}function n(e,t){throw new Error("Cannot create inverse for: "+e.formatName()+". The entityType for this navigation property "+t)}t.toJSON=function(){return h(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,displayName:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})};e.fromJSON=function(e){if(e.validators){e.validators=e.validators.map(fe.fromJSON)}return new De(e)};t._resolveNp=function(){var n=this;var a=n.entityType;var e=Z(a.navigationProperties,function(e){return e.associationName===n.associationName&&(e.name!==n.name||e.entityTypeName!==n.entityTypeName)});n.inverse=e;if(!e){n.invForeignKeyNames.forEach(function(e){var t=a.getDataProperty(e);if(!t){throw new Error("EntityType '"+n.entityTypeName+"' has no foreign key matching '"+e+"'")}var r=n.parentType;t.inverseNavigationProperty=Z(r.navigationProperties,function(e){return e.invForeignKeyNames&&e.invForeignKeyNames.indexOf(t.name)>=0&&e.entityType===t.parentType});d(a.foreignKeyProperties,t)})}i(n)};function i(t){var e=t.foreignKeyNames;if(e.length===0)return;var r=t.parentType;var n=e.map(function(e){return r.getDataProperty(e)});var a=r.foreignKeyProperties;n.forEach(function(e){d(a,e);e.relatedNavigationProperty=t;d(t.entityType.inverseForeignKeyProperties,e);if(t.relatedDataProperties){d(t.relatedDataProperties,e)}else{t.relatedDataProperties=[e]}})}return e}(),Ie=function(){var e=new oe("AutoGeneratedKeyType");e.None=e.addSymbol();e.Identity=e.addSymbol();e.KeyGenerator=e.addSymbol();e.resolveSymbols();return e}();function Ve(e){if(!e){return null}var t=e.split(":#");if(t.length>1){return je(t[0],t[1])}if(A(e,Ce.ANONTYPE_PREFIX)){var r=je(e);r.isAnonymous=true;return r}var n=e.split(",")[0];var t=n.split(".");if(t.length>1){var a=t[t.length-1];var i=t.slice(0,t.length-1);var o=i.join(".");return je(a,o)}else{return je(e)}}function je(e,t){return{shortTypeName:e,namespace:t,typeName:Ke(e,t)}}function Re(e){return e.indexOf(":#")>=0}function Ke(e,t){if(t&&t.length>0){return e+":#"+t}else{return e}}function qe(e,t,r){if(!t)return;if(Array.isArray(t)){t.forEach(e._addPropertyCore.bind(e))}else if(typeof t==="object"){for(var n in t){if(b(t,n)){var a=t[n];a.name=n;var i=new r(a);e._addPropertyCore(i)}}}else{throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property")}}(function(){var e=K.prototype;e.isEntity=function(){return this._addContext({fn:t,msg:" must be an entity"})};function t(e,t){if(t==null)return false;return t.entityType!==undefined}e.isEntityProperty=function(){return this._addContext({fn:r,msg:" must be either a DataProperty or a NavigationProperty"})};function r(e,t){if(t==null)return false;return t.isDataProperty||t.isNavigationProperty}})(),q.MetadataStore=Ce,q.EntityType=Fe,q.ComplexType=Me,q.DataProperty=ke,q.NavigationProperty=De,q.AutoGeneratedKeyType=Ie;var ze=function(){var e=function e(){this._tempIdMap={}};var t=e.prototype;t.generateTempKeyValue=function(e,t){var r=e.keyProperties;if(r.length>1){throw new Error("Ids can not be autogenerated for entities with multipart keys")}var n=r[0];var a=s(this,n,true);var i;if(t!=null){if(!a.keyMap[t.toString()]){i=t}}if(i===undefined){var o=n.dataType;if(o.getNext){i=o.getNext(this);while(a.keyMap[i.toString()]!=null){i=o.getNext(this)}}else{throw new Error("Cannot use a property with a dataType of: "+o.toString()+" for id generation")}}a.keyMap[i.toString()]=true;return i};t.getTempKeys=function(){var e=[];for(var t in this._tempIdMap){var r=this._tempIdMap[t];var n=r.entityType;for(var a in r.keyMap){e.push(new me(n,[a]))}}return e};t.isTempKey=function(e){var t=e.entityType.keyProperties;if(t.length>1)return false;var r=t[0];var n=s(this,r);if(!n){return false}return n.keyMap[e.values[0].toString()]!==undefined};function s(e,t,r){var n=t.name+".."+t.parentType.name;var a=e._tempIdMap[n];if(!a){if(r){a={entityType:t.parentType,propertyName:t.name,keyMap:{}};e._tempIdMap[n]=a}}return a}ue.registerType(e,"KeyGenerator");return e}();q.KeyGenerator=ze;var Ue=function(){var e=function e(t){ie(t||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this);if(!this.name){this.name=x()}ue._storeObject(this,r._$typeName,this.name)};var r=e.prototype;r._$typeName="LocalQueryComparisonOptions";e.caseInsensitiveSQL=new e({name:"caseInsensitiveSQL",isCaseSensitive:false,usesSql92CompliantStringComparison:true});e.defaultInstance=new e(e.caseInsensitiveSQL);r.setAsDefault=function(){return o(this,e)};return e}();q.LocalQueryComparisonOptions=Ue;var Be=function(){var e=function e(t){ie(t||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this);if(!this.name){this.name=x()}ue._storeObject(this,r._$typeName,this.name)};var r=e.prototype;r._$typeName="NamingConvention";e.none=new e({name:"noChange",serverPropertyNameToClient:function(e){return e},clientPropertyNameToServer:function(e){return e}});e.camelCase=new e({name:"camelCase",serverPropertyNameToClient:function(e){return e.substr(0,1).toLowerCase()+e.substr(1)},clientPropertyNameToServer:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}});e.defaultInstance=new e(e.none);r.setAsDefault=function(){return o(this,e)};return e}();q.NamingConvention=Be;var $e=function(){var s=function(){var e=function(){if(arguments.length===0)return;if(arguments.length===1){var e=arguments[0];if(Array.isArray(e)){if(e.length===1){return s(e[0])}else{return a(e)}}else if(e instanceof s){return e}else if(typeof e=="string"){return new u(e)}else{return o(e)}}else{return a(Array.prototype.slice.call(arguments,0))}};var t=e.prototype;e.create=e;e.and=function(){var e=new f("and",z(arguments));return e.op&&e};e.or=function(){var e=new f("or",z(arguments));return e.op&&e};e.not=function(e){return e.not()};e.extendBinaryPredicateFn=function(e,t){var a=T.binaryPredicate;for(var r in e||{}){var n=e[r];n.visitorFn=t;i(c.prototype.aliasMap,r,e[r])}if(!T.isExtended){T.binaryPredicate=function(e,t,r){var n=this.aliasMap[this.op.key].visitorFn;if(n){return n(e,t,r)}else{return a(e,t,r)}};T.isExtended=true}};t.and=function(){return new f("and",r(this,arguments))};t.or=function(){return new f("or",r(this,arguments))};t.not=function(){return new p("not",this)};t.toJSON=function(){return this.toJSONExt({entityType:this._entityType})};t.toJSONExt=function(e){return this.visit(e,P)};t.toFunction=function(e){return this.visit(e,T)};t.toString=function(){return JSON.stringify(this)};t.visit=function(e,t){if(re(e)){e={entityType:null}}else if(e instanceof Fe){e={entityType:e}}else if(!b(e,"entityType")){throw new Error("All visitor methods must be called with a context object containing at least an 'entityType' property")}if(t){e.visitor=t}else{t=e.visitor}var r=t[this.visitorMethodName];if(r==null){throw new Error("Unable to locate method: "+this.visitorMethodName+" on visitor")}var n=e.entityType;if(this._validate&&n==null||this._entityType!==n){this._validate(n,e.usesNameOnServer);this._entityType=n}var a=Array.prototype.slice.call(arguments,1);return r.call(this,e)};t._initialize=function(e,t){this.visitorMethodName=e;var r=this.aliasMap={};for(var n in t||{}){i(r,n,t[n])}};function r(e,t){var r=t[0];if(r instanceof s){r=z(t)}else if(!Array.isArray(r)){r=[s(z(t))]}return[e].concat(r)}function i(t,e,r){var n=e.toLowerCase();r.key=n;t[n]=r;r.aliases&&r.aliases.forEach(function(e){t[e.toLowerCase()]=r})}t._resolveOp=function(e,t){e=e.operator||e;var r=this.aliasMap[e.toLowerCase()];if(!r&&!t){throw new Error("Unable to resolve operator: "+e)}return r};function a(e){var t={};var r={};t[e[0]]=r;var n=e[1];n=n.operator||n;if(e.length==3){r[n]=e[2]}else{r[n]=a(e.splice(2))}return o(t)}function o(t){if(t instanceof s)return t;if(typeof t!="object"){throw new Error("Unable to convert to a Predicate: "+t)}var e=Object.keys(t);var r=e.map(function(e){return n(e,t[e])});return r.length===1?r[0]:new f("and",r)}function n(e,r){if(f.prototype._resolveOp(e,true)){return new f(e,r)}if(p.prototype._resolveOp(e,true)){return new p(e,r)}if(typeof r!=="object"||r==null||M(r)){return new c("eq",e,r)}else if(b(r,"value")){return new c("eq",e,r)}if(Array.isArray(r)){throw new Error("Unable to resolve predicate after the phrase: "+e)}var n=e;var t=Object.keys(r);var a=t.map(function(e){if(l.prototype._resolveOp(e,true)){return new l(e,n,r[e])}if(c.prototype._resolveOp(e,true)){return new c(e,n,r[e])}else if(b(r[e],"value")){return new c("eq",n,r[e])}var t=V("Unable to resolve predicate after the phrase: '%1' for operator: '%2'  and value: '%3'",n,e,r[e]);throw new Error(t)});return a.length===1?a[0]:new f("and",a)}return e}();var u=function(){var e=function e(t){this.value=t};var t=e.prototype=new s;t._initialize("passthruPredicate");t._validate=_;return e}();var p=function(){var e=function e(t,r){this.op=this._resolveOp(t);this.pred=s(r)};var t=e.prototype=new s;t._initialize("unaryPredicate",{not:{aliases:["!","~"]}});t._validate=function(e,t){this.pred._validate(e,t)};return e}();var c=function(){var e=function e(t,r,n){this.op=this._resolveOp(t);this.expr1Source=r;this.expr2Source=n};var t=e.prototype=new s;t._initialize("binaryPredicate",{eq:{aliases:["==","equals"]},ne:{aliases:["!=","~=","notequals"]},lt:{aliases:["<","lessthan"]},le:{aliases:["<=","lessthanorequal"]},gt:{aliases:[">","greaterthan"]},ge:{aliases:[">=","greaterthanorequal"]},startswith:{isFunction:true},endswith:{isFunction:true},contains:{aliases:["substringof"],isFunction:true},in:{}});t._validate=function(e,t){var r={entityType:e,usesNameOnServer:t};this.expr1=a(this.expr1Source,r);if(this.expr1==null){throw new Error("Unable to validate 1st expression: "+this.expr1Source)}if(this.expr1 instanceof y){throw new Error("The left hand side of a binary predicate cannot be a literal expression, it must be a valid property or functional predicate expression: "+this.expr1Source)}if(this.op.key=="in"&&!Array.isArray(this.expr2Source)){throw new Error("The 'in' operator requires that its right hand argument be an array")}var n=L(r,{isRHS:true,dataType:this.expr1.dataType});this.expr2=a(this.expr2Source,n);if(this.expr2==null){throw new Error("Unable to validate 2nd expression: "+this.expr2Source)}if(this.expr1.dataType==null){this.expr1.dataType=this.expr2.dataType}};return e}();var f=function(){var e=function e(t,r){this.op=this._resolveOp(t);if(r.length==1&&Array.isArray(r[0])){r=r[0]}this.preds=r.filter(function(e){return e!=null}).map(function(e){return s(e)});if(this.preds.length==0){this.op=null}if(this.preds.length==1){return this.preds[0]}};var t=e.prototype=new s;t._initialize("andOrPredicate",{and:{aliases:["&&"]},or:{aliases:["||"]}});t._validate=function(t,r){this.preds.every(function(e){e._validate(t,r)})};return e}();var l=function(){var e=function e(t,r,n){this.op=this._resolveOp(t);this.exprSource=r;this.pred=s(n)};var t=e.prototype=new s;t._initialize("anyAllPredicate",{any:{aliases:["some"]},all:{aliases:["every"]}});t._validate=function(e,t){this.expr=a(this.exprSource,{entityType:e,usesNameOnServer:t});if(e==null||e.isAnonymous){this.expr.dataType=null}this.pred._validate(this.expr.dataType,t)};return e}();var r=function(e){this.visitorMethodName=e;this.visit=s.prototype.visit;this._validate=_};var y=function(){var e=function e(t,r,n){r=a(r);r=r||_e.fromValue(t);if(r&&r.parse){if(Array.isArray(t)){this.value=t.map(function(e){return r.parse(e,typeof e)})}else{this.value=r.parse(t,typeof t)}}else{this.value=t}this.dataType=r;this.hasExplicitDataType=n};var t=e.prototype=new r("litExpr");t.toString=function(){return" LitExpr - value: "+this.value.toString()+" dataType: "+this.dataType.toString()};function a(e){if(e==null)return e;if(_e.contains(e)){return e}if(N(e)){var t=_e.fromName(e);if(t)return t;throw new Error("Unable to resolve a dataType named: "+e)}throw new Error("The dataType parameter passed into this literal expression is not a 'DataType'"+e)}return e}();var h=function(){var e=function e(t){this.propertyPath=t};var t=e.prototype=new r("propExpr");t.toString=function(){return" PropExpr - "+this.propertyPath};t._validate=function(e,t){if(e==null||e.isAnonymous)return;var r=e.getPropertiesOnPath(this.propertyPath,t,false);if(!r){var n=V("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",e.name,this.propertyPath);throw new Error(n)}var a=r[r.length-1];if(a.isDataProperty){this.dataType=a.dataType}else{this.dataType=a.entityType}};return e}();var d=function(){var e=function e(t,r){this.fnName=t;this.exprs=r;var n=a[t];if(n==null){throw new Error("Unknown function: "+t)}this.localFn=n.fn;this.dataType=n.dataType};var t=e.prototype=new r("fnExpr");t.toString=function(){var e=this.exprs.map(function(e){e.toString()}).toString();return"FnExpr - "+this.fnName+"("+e+")"};t._validate=function(t,r){this.exprs.forEach(function(e){e._validate(t,r)})};var a=e.funcMap={toupper:{fn:function(e){return e.toUpperCase()},dataType:_e.String},tolower:{fn:function(e){return e.toLowerCase()},dataType:_e.String},substring:{fn:function(e,t,r){return e.substring(t,r)},dataType:_e.String},substringof:{fn:function(e,t){return t.indexOf(e)>=0},dataType:_e.Boolean},length:{fn:function(e){return e.length},dataType:_e.Int32},trim:{fn:function(e){return e.trim()},dataType:_e.String},concat:{fn:function(e,t){return e.concat(t)},dataType:_e.String},replace:{fn:function(e,t,r){return e.replace(t,r)},dataType:_e.String},startswith:{fn:function(e,t){return A(e,t)},dataType:_e.Boolean},endswith:{fn:function(e,t){return C(e,t)},dataType:_e.Boolean},indexof:{fn:function(e,t){return e.indexOf(t)},dataType:_e.Int32},round:{fn:function(e){return Math.round(e)},dataType:_e.Int32},ceiling:{fn:function(e){return Math.ceil(e)},dataType:_e.Int32},floor:{fn:function(e){return Math.floor(e)},dataType:_e.Int32},second:{fn:function(e){return e.getSeconds()},dataType:_e.Int32},minute:{fn:function(e){return e.getMinutes()},dataType:_e.Int32},day:{fn:function(e){return e.getDate()},dataType:_e.Int32},month:{fn:function(e){return e.getMonth()+1},dataType:_e.Int32},year:{fn:function(e){return e.getFullYear()},dataType:_e.Int32}};return e}();var v=/^[a-z_][\w.$]*$/i;var m=/('[^']*'|[^,]+)/g;var g=/("[^"]*"|[^,]+)/g;var w=String.fromCharCode(191);function a(e,t){var r=t.entityType;if(Array.isArray(e)){if(!t.isRHS){throw new Error("Array expressions are only permitted on the right hand side of a BinaryPredicate")}return new y(e,t.dataType)}if(!N(e)){if(e!=null&&O(e)&&!e.toISOString){if(e.value===undefined){throw new Error("Unable to resolve an expression for: "+e+" on entityType: "+r.name)}if(e.isProperty){return new h(e.value)}else{return new y(e.value,e.dataType||t.dataType,true)}}else{return new y(e,t.dataType)}}if(t.isRHS){if(r==null||r.isAnonymous){return new y(e,t.dataType)}else{return E(e,t)}}else{var n=/\([^()]*\)/;var a;var i=[];var o=0;while(a=n.exec(e)){var s=a[0];i.push(s);var u=w+o++;e=e.replace(s,u)}var p=S(e,i,t);p._validate(r,t.usesNameOnServer);return p}}function S(e,t,r){var n=e.split(w);if(n.length===1){return E(n[0],r)}else{return i(e,n,t,r)}}function E(e,t){e=e.trim();var r=e.substr(0,1);var n=(r==="'"||r==='"')&&e.length>1&&e.substr(e.length-1)===r;if(n){var a=e.substr(1,e.length-2);return new y(a,t.dataType||_e.String)}else{var i=t.entityType;if(i==null||i.isAnonymous){return new h(e)}else{var o=v.test(e);if(o){if(i.getPropertiesOnPath(e,t.usesNameOnServer,false)!=null){return new h(e)}}}return new y(e,t.dataType)}}function i(e,t,r,n){try{var a=t[0].trim().toLowerCase();var i=r[t[1]].trim();if(i.substr(0,1)==="("){i=i.substr(1,i.length-2)}var o=e.indexOf("'")>=0?m:g;var s=i.match(o);var u=L({},n);u.dataType=_e.Undefined;u.isFnArg=true;var p=s.map(function(e){return S(e,r,u)});return new d(a,p)}catch(e){return null}}var T=function(){var e={passthruPredicate:function(){throw new Error("Cannot execute an PassthruPredicate expression against the local cache: "+this.value)},unaryPredicate:function(e){var t=this.pred.visit(e);switch(this.op.key){case"not":return function(e){return!t(e)};default:throw new Error("Invalid unary operator:"+this.op.key)}},binaryPredicate:function(e){var t=this.expr1.visit(e);var r=this.expr2.visit(e);var n=this.expr1.dataType||this.expr2.dataType;var a=e.entityType.metadataStore.localQueryComparisonOptions;var i=o(this,n,a);if(i==null){throw new Error("Invalid binaryPredicate operator:"+this.op.key)}return function(e){return i(t(e),r(e))}},andOrPredicate:function(t){var n=this.preds.map(function(e){return e.visit(t)});switch(this.op.key){case"and":return function(r){var e=n.reduce(function(e,t){return e&&t(r)},true);return e};case"or":return function(r){var e=n.reduce(function(e,t){return e||t(r)},false);return e};default:throw new Error("Invalid boolean operator:"+op.key)}},anyAllPredicate:function(e){var t=this.expr.visit(e);var r=L({},e);r.entityType=this.expr.dataType;var n=this.pred.visit(r);var a=i(this.op);return function(e){return a(t(e),n)}},litExpr:function(){var t=this.value;return function(e){return t}},propExpr:function(){var t=this.propertyPath;var r=t.split(".");if(r.length===1){return function(e){return e.getProperty(t)}}else{return function(e){return We(e,r)}}},fnExpr:function(t){var n=this.exprs.map(function(e){return e.visit(t)});var a=this;return function(r){var e=n.map(function(e){var t=e(r);return t});var t=a.localFn.apply(null,e);return t}}};function i(e){switch(e.key){case"any":return function(e,t){return e.some(function(e){return t(e)})};case"all":return function(e,t){return e.every(function(e){return t(e)})};default:throw new Error("Unknown operator: "+e.key)}}function o(e,t,r){var n=e.op;var a=_e.getComparableFn(t);var i;switch(n.key){case"eq":i=function(e,t){if(e&&typeof e==="string"){return s(e,t,r)}else{return a(e)==a(t)}};break;case"ne":i=function(e,t){if(e&&typeof e==="string"){return!s(e,t,r)}else{return a(e)!=a(t)}};break;case"gt":i=function(e,t){return a(e)>a(t)};break;case"ge":i=function(e,t){return a(e)>=a(t)};break;case"lt":i=function(e,t){return a(e)<a(t)};break;case"le":i=function(e,t){return a(e)<=a(t)};break;case"startswith":i=function(e,t){return u(e,t,r)};break;case"endswith":i=function(e,t){return p(e,t,r)};break;case"contains":i=function(e,t){return c(e,t,r)};break;case"in":i=function(e,t){e=a(e);t=t.map(function(e){return a(e)});return t.indexOf(e)>=0};break;default:return null}return i}function s(e,t,r){if(t==null)return false;if(typeof t!=="string"){t=t.toString()}if(r.usesSql92CompliantStringComparison){e=(e||"").trim();t=(t||"").trim()}if(!r.isCaseSensitive){e=(e||"").toLowerCase();t=(t||"").toLowerCase()}return e===t}function u(e,t,r){if(!r.isCaseSensitive){e=(e||"").toLowerCase();t=(t||"").toLowerCase()}return A(e,t)}function p(e,t,r){if(!r.isCaseSensitive){e=(e||"").toLowerCase();t=(t||"").toLowerCase()}return C(e,t)}function c(e,t,r){if(!r.isCaseSensitive){e=(e||"").toLowerCase();t=(t||"").toLowerCase()}return e.indexOf(t)>=0}return e}();var P=function(){var e={passthruPredicate:function(){return this.value},unaryPredicate:function(e){var t=this.pred.visit(e);var r={};r[this.op.key]=t;return r},binaryPredicate:function(e){var t=this.expr1.visit(e);var r=this.expr2.visit(e);var n={};if(this.expr2 instanceof h){r={value:r,isProperty:true}}if(this.op.key==="eq"){n[t]=r}else{var a={};n[t]=a;a[this.op.key]=r}return n},andOrPredicate:function(t){var e=this.preds.map(function(e){return e.visit(t)});if(!e||!e.length){return{}}var r;if(this.op.key==="and"&&e.length===2&&!e.some(N)){r=e.reduce(n)}if(r==null){r={};r[this.op.key]=e}return r},anyAllPredicate:function(e){var t=this.expr.visit(e);var r=L({},e);r.entityType=this.expr.dataType;var n=this.pred.visit(r);var a={};var i={};i[this.op.key]=n;a[t]=i;return a},litExpr:function(e){if(this.hasExplicitDataType||e.useExplicitDataType){return{value:this.value,dataType:this.dataType.name}}else{return this.value}},propExpr:function(e){if(e.toNameOnServer){return e.entityType.clientPropertyPathToServer(this.propertyPath)}else{return this.propertyPath}},fnExpr:function(t){var e=this.exprs.map(function(e){return e.visit(t)});return this.fnName+"("+e.join(",")+")"}};function n(t,r){var e=Object.keys(r).every(function(e){if(t.hasOwnProperty(e)){if(typeof r[e]!="object"){return false}if(n(t[e],r[e])==null){return false}}else{t[e]=r[e]}return true});return e?t:null}return e}();return s}();q.Predicate=$e;var Le=function(){var e=function e(t){if(t!=null&&!N(t)){return r(this,t)}this.resourceName=t;this.fromEntityType=null;this.wherePredicate=null;this.orderByClause=null;this.selectClause=null;this.skipCount=null;this.takeCount=null;this.expandClause=null;this.parameters={};this.inlineCountEnabled=false;this.noTrackingEnabled=false;this.entityManager=null};var t=e.prototype;t._$typeName="EntityQuery";t.from=function(e){ne(e,"resourceName").isString().check();return n(this,"resourceName",e)};e.from=function(e){ne(e,"resourceName").isString().check();return new Le(e)};t.toType=function(e){ne(e,"entityType").isString().or().isInstanceOf(Fe).check();return n(this,"resultEntityType",e)};t.where=function(e){if(e!=null){e=$e.create(z(arguments));if(this.fromEntityType)e._validate(this.fromEntityType);if(this.wherePredicate){e=this.wherePredicate.and(e)}}return n(this,"wherePredicate",e)};t.orderBy=function(e,t){var r=e==null?null:new Qe(a(e),t);if(this.orderByClause&&r){r=new Qe([this.orderByClause,r])}return n(this,"orderByClause",r)};t.orderByDesc=function(e){return this.orderBy(e,true)};t.select=function(e){var t=e==null?null:new He(a(e));return n(this,"selectClause",t)};t.skip=function(e){ne(e,"count").isOptional().isNumber().check();return n(this,"skipCount",e==null?null:e)};t.top=function(e){return this.take(e)};t.take=function(e){ne(e,"count").isOptional().isNumber().check();return n(this,"takeCount",e==null?null:e)};t.expand=function(e){var t=e==null?null:new Ze(a(e));return n(this,"expandClause",t)};t.withParameters=function(e){ne(e,"parameters").isObject().check();return n(this,"parameters",e)};t.inlineCount=function(e){ne(e,"enabled").isBoolean().isOptional().check();e=e===undefined?true:!!e;return n(this,"inlineCountEnabled",e)};t.useNameOnServer=function(e){ne(e,"usesNameOnServer").isBoolean().isOptional().check();e=e===undefined?true:!!e;return n(this,"usesNameOnServer",e)};t.noTracking=function(e){ne(e,"enabled").isBoolean().isOptional().check();e=e===undefined?true:!!e;return n(this,"noTrackingEnabled",e)};t.using=function(e){if(!e)return this;var t=n(this);s(t,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(e,t){e.queryOptions=(e.queryOptions||new et).using(t)},mergeStrategy:function(e,t){e.queryOptions=(e.queryOptions||new et).using(t)},jsonResultsAdapter:function(e,t){e.dataService=(e.dataService||new Ne).using({jsonResultsAdapter:t})}},e);return t};t.execute=function(e,t){if(!this.entityManager){throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'")}return this.entityManager.executeQuery(this,e,t)};t.executeLocally=function(){if(!this.entityManager){throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'")}return this.entityManager.executeQueryLocally(this)};t.toJSON=function(){return this.toJSONExt()};t.toJSONExt=function(t){t=t||{};t.entityType=t.entityType||this.fromEntityType;t.propertyPathFn=t.toNameOnServer?t.entityType.clientPropertyPathToServer.bind(t.entityType):w;var e=this;var r=function(e){return e?e.toJSONExt(t):undefined};return h(this,{"from,resourceName":null,"toType,resultEntityType":function(e){return e?N(e)?e:e.name:undefined},"where,wherePredicate":r,"orderBy,orderByClause":r,"select,selectClause":r,"expand,expandClause":r,"skip,skipCount":null,"take,takeCount":null,parameters:function(e){return re(e)?undefined:e},"inlineCount,inlineCountEnabled":false,"noTracking,noTrackingEnabled":false,queryOptions:null})};function r(e,t){h(t,{"resourceName,from":null,"resultEntityType,toType":null,"wherePredicate,where":function(e){return e?new $e(e):undefined},"orderByClause,orderBy":function(e){return e?new Qe(e):undefined},"selectClause,select":function(e){return e?new He(e):undefined},"expandClause,expand":function(e){return e?new Ze(e):undefined},"skipCount,skip":null,"takeCount,take":null,parameters:function(e){return re(e)?undefined:e},"inlineCountEnabled,inlineCount":false,"noTrackingEnabled,noTracking":false,queryOptions:function(e){return e?et.fromJSON(e):undefined}},e);return e}e.fromEntities=function(e){ne(e,"entities").isEntity().or().isNonEmptyArray().isEntity().check();if(!Array.isArray(e)){e=z(arguments)}var t=e[0];var r=t.entityType;if(e.some(function(e){return e.entityType!==r})){throw new Error("All 'fromEntities' must be the same type; at least one is not of type "+r.name)}var n=new Le(r.defaultResourceName);var a=e.map(function(e){return u(e)});var i=$e.or(a);n=n.where(i);var o=t.entityAspect.entityManager;if(o){n=n.using(o)}return n};e.fromEntityKey=function(e){ne(e,"entityKey").isInstanceOf(me).check();var t=new Le(e.entityType.defaultResourceName);var r=p(e);t=t.where(r).toType(e.entityType);return t};e.fromEntityNavigation=function(e,t){ne(e,"entity").isEntity().check();var r=e.entityType._checkNavProperty(t);var n=new Le(r.entityType.defaultResourceName);var a=o(e,r);n=n.where(a);var i=e.entityAspect.entityManager;return i?n.using(i):n};t._getFromEntityType=function(e,t){var r=this.fromEntityType;if(r)return r;var n=this.resourceName;if(!n){throw new Error("There is no resourceName for this query")}if(e.isEmpty()){if(t){throw new Error("There is no metadata available for this query. "+"Are you querying the local cache before you've fetched metadata?")}else{return null}}var a=e.getEntityTypeNameForResourceName(n);if(a){r=e._getEntityType(a)}else{r=this._getToEntityType(e,true)}if(!r){if(t){throw new Error(V("Cannot find an entityType for resourceName: '%1'. "+" Consider adding an 'EntityQuery.toType' call to your query or "+"calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",n))}else{return null}}this.fromEntityType=r;return r};t._getToEntityType=function(e,t){if(this.resultEntityType instanceof Fe){return this.resultEntityType}else if(this.resultEntityType){this.resultEntityType=e._getEntityType(this.resultEntityType,false);return this.resultEntityType}else{return t?null:!this.selectClause&&this._getFromEntityType(e,false)}};t._toUri=function(e){var t=Ne.resolve([e.dataService]);return t.uriBuilder.buildUri(this,e.metadataStore)};function n(e,t,r){if(t){if(e[t]===r)return e}var n=L(new Le,e,["resourceName","fromEntityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","usesNameOnServer","queryOptions","entityManager","dataService","resultEntityType"]);n.parameters=L({},e.parameters);if(t){n[t]=r}return n}function s(r,n,e,t){var a=e._$typeName||e.parentEnum&&e.parentEnum.name;var i=a&&a.substr(0,1).toLowerCase()+a.substr(1);if(t&&i!=t){throw new Error("Invalid value for property: "+t)}if(i){var o=n[i];if(o===undefined){throw new Error("Invalid config property: "+i)}else if(o===null){r[i]=e}else{o(r,e)}}else{U(e,function(e,t){s(r,n,t,e)})}}function a(e){ne(e,"propertyPaths").isOptional().isString().or().isArray().isString().check();if(typeof e==="string"){e=e.split(",")}e=e.map(function(e){return e.trim()});return e}function u(t){var e=t.entityType;var r=e.keyProperties.map(function(e){return $e.create(e.name,Ge.Equals,t.getProperty(e.name))});var n=$e.and(r);return n}function p(e){var t=e.entityType.keyProperties;var r=Y(t,e.values,function(e,t){return $e.create(e.name,Ge.Equals,t)});var n=$e.and(r);return n}function o(t,e){if(e.isScalar){if(e.foreignKeyNames.length===0)return null;var r=e.foreignKeyNames.map(function(e){return t.getProperty(e)});var n=new me(e.entityType,r);return p(n)}else{var a=e.getInverse();var i=a?a.foreignKeyNames:e.invForeignKeyNames;if(i.length===0)return null;var o=t.entityAspect.getKey().values;var s=Y(i,o,function(e,t){return $e.create(e,Ge.Equals,t)});return $e.and(s)}}return e}(),Ge=function(){var e=new oe("FilterQueryOp");e.Equals=e.addSymbol({operator:"eq"});e.NotEquals=e.addSymbol({operator:"ne"});e.GreaterThan=e.addSymbol({operator:"gt"});e.LessThan=e.addSymbol({operator:"lt"});e.GreaterThanOrEqual=e.addSymbol({operator:"ge"});e.LessThanOrEqual=e.addSymbol({operator:"le"});e.Contains=e.addSymbol({operator:"contains"});e.StartsWith=e.addSymbol({operator:"startswith"});e.EndsWith=e.addSymbol({operator:"endswith"});e.Any=e.addSymbol({operator:"any"});e.All=e.addSymbol({operator:"all"});e.In=e.addSymbol({operator:"in"});e.IsTypeOf=e.addSymbol({operator:"isof"});e.resolveSymbols();return e}(),Je=function(){var e=new oe("BooleanQueryOp");e.And=e.addSymbol({operator:"and"});e.Or=e.addSymbol({operator:"or"});e.Not=e.addSymbol({operator:"not"});e.resolveSymbols();return e}(),Qe=function(){var e=function(e,t){if(e.length>1){if(e[0]instanceof Qe){this.items=Array.prototype.concat.apply(e[0].items,e.slice(1).map(g("items")));return}var r=e.map(function(e){return new n(e,t)})}else{var r=[new n(e[0],t)]}this.items=r};var t=e.prototype;t.validate=function(t){if(t==null||t.isAnonymous)return;this.items.forEach(function(e){e.validate(t)})};t.getComparer=function(t){var a=this.items.map(function(e){return e.getComparer(t)});return function(e,t){for(var r=0;r<a.length;r++){var n=a[r](e,t);if(n!==0){return n}}return 0}};t.toJSONExt=function(t){return this.items.map(function(e){return t.propertyPathFn(e.propertyPath)+(e.isDesc?" desc":"")})};var n=function(e,t){if(!(typeof e==="string")){throw new Error("propertyPath is not a string")}e=e.trim();var r=e.split(" ");if(r.length>1&&t!==true&&t!==false){t=A(r[1].toLowerCase(),"desc");if(!t){var n=A(r[1].toLowerCase(),"asc");if(!n){throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}}}this.propertyPath=r[0];this.isDesc=t};var r=n.prototype;r.validate=function(e){if(e==null||e.isAnonymous)return;this.lastProperty=e.getProperty(this.propertyPath,true)};r.getComparer=function(e){if(!this.lastProperty)this.validate(e);if(this.lastProperty){var o=this.lastProperty.dataType;var s=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive}var u=this.propertyPath;var p=this.isDesc;return function(e,t){var r=We(e,u);var n=We(t,u);var a=o||r&&_e.fromValue(r)||_e.fromValue(n);if(a===_e.String){if(s){r=r||"";n=n||""}else{r=(r||"").toLowerCase();n=(n||"").toLowerCase()}}else{var i=_e.getComparableFn(a);r=i(r);n=i(n)}if(r===n){return 0}else if(r>n||n===undefined){return p?-1:1}else{return p?1:-1}}};return e}(),He=function(){var e=function(e){this.propertyPaths=e;this._pathNames=e.map(function(e){return e.replace(".","_")})};var t=e.prototype;t.validate=function(t){if(t==null||t.isAnonymous)return;this.propertyPaths.forEach(function(e){t.getProperty(e,true)})};t.toFunction=function(){var a=this;return function(r){var n={};a.propertyPaths.forEach(function(e,t){n[a._pathNames[t]]=We(r,e)});return n}};t.toJSONExt=function(t){return this.propertyPaths.map(function(e){return t.propertyPathFn(e)})};return e}(),Ze=function(){var e=function(e){this.propertyPaths=e};var t=e.prototype;t.toJSONExt=function(t){return this.propertyPaths.map(function(e){return t.propertyPathFn(e)})};return e}();function We(e,t){var r=Array.isArray(t)?t:t.split(".");if(r.length===1){return e.getProperty(t)}else{var n=e;r.some(function(e){n=n.getProperty(e);return n==null});return n}}q.FilterQueryOp=Ge,q.EntityQuery=Le,q.OrderByClause=Qe;var Ye=function(){var e=new oe("MergeStrategy");e.PreserveChanges=e.addSymbol();e.OverwriteChanges=e.addSymbol();e.SkipMerge=e.addSymbol();e.Disallowed=e.addSymbol();e.resolveSymbols();return e}(),Xe=function(){var e=new oe("FetchStrategy");e.FromServer=e.addSymbol();e.FromLocalCache=e.addSymbol();e.resolveSymbols();return e}(),et=function(){var e=function e(t){r(this,t)};var t=e.prototype;t._$typeName="QueryOptions";e.resolve=function(e){return new et(p(e,["fetchStrategy","mergeStrategy","includeDeleted"]))};e.defaultInstance=new e({fetchStrategy:Xe.FromServer,mergeStrategy:Ye.PreserveChanges,includeDeleted:false});t.using=function(e){if(!e)return this;var t=new et(this);if(Ye.contains(e)){e={mergeStrategy:e}}else if(Xe.contains(e)){e={fetchStrategy:e}}return r(t,e)};t.setAsDefault=function(){return o(this,e)};t.toJSON=function(){return h(this,{fetchStrategy:null,mergeStrategy:null,includeDeleted:false})};e.fromJSON=function(e){return new et({fetchStrategy:Xe.fromName(e.fetchStrategy),mergeStrategy:Ye.fromName(e.mergeStrategy),includeDeleted:e.includeDeleted===true})};function r(e,t){if(t){ie(t).whereParam("fetchStrategy").isEnumOf(Xe).isOptional().whereParam("mergeStrategy").isEnumOf(Ye).isOptional().whereParam("includeDeleted").isBoolean().isOptional().applyAll(e)}return e}return e}();q.QueryOptions=et,q.FetchStrategy=Xe,q.MergeStrategy=Ye;var tt=function(){var e=function e(t,r){this.entityManager=t;this.entityType=r;this.entityType.isFrozen=true;this._indexMap={};this._entities=[];this._emptyIndexes=[]};var t=e.prototype;t.attachEntity=function(e,t,r){var n=e.entityAspect;if(!n._initialized){this.entityType._initializeInstance(e)}delete n._initialized;var a=n.getKey()._keyInGroup;var i=this._indexMap[a];if(i>=0){var o=this._entities[i];var s=o.entityAspect.entityState;var u=s.isUnchanged();if(o===e){n.entityState=t}else if(r===Ye.Disallowed){throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+n.getKey())}else if(r===Ye.OverwriteChanges||r===Ye.PreserveChanges&&u){var p=this.entityManager.helper.unwrapInstance(e);this.entityType._updateTargetFromRaw(o,p,ke.getRawValueFromServer);o.entityAspect.setEntityState(t)}return o}else{if(this._emptyIndexes.length===0){i=this._entities.push(e)-1}else{i=this._emptyIndexes.pop();this._entities[i]=e}this._indexMap[a]=i;n.entityState=t;n.entityGroup=this;n.entityManager=this.entityManager;return e}};t.detachEntity=function(e){var t=e.entityAspect;var r=t.getKey()._keyInGroup;var n=this._indexMap[r];if(n===undefined){throw new Error("internal error - entity cannot be found in group")}delete this._indexMap[r];this._emptyIndexes.push(n);this._entities[n]=null;return e};t.findEntityByKey=function(e){var t;if(e instanceof me){t=e._keyInGroup}else{t=me.createKeyString(e)}var r=this._indexMap[t];return r!==undefined?this._entities[r]:null};t.hasChanges=function(){var e=this._entities;var t=ge.Unchanged;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a&&a.entityAspect.entityState!==t){return true}}return false};t.getChanges=function(){var e=this._entities;var t=ge.Unchanged;var r=[];for(var n=0,a=e.length;n<a;n++){var i=e[n];if(i&&i.entityAspect.entityState!==t){r.push(i)}}return r};t.getEntities=function(e){var t=r(e);return this._entities.filter(t)};t._checkOperation=function(t){this._entities.forEach(function(e){e&&e.entityAspect._checkOperation(t)});return this};t._clear=function(){this._entities.forEach(function(e){if(e!=null){e.entityAspect._detach()}});this._entities=null;this._indexMap=null;this._emptyIndexes=null};t._updateFkVal=function(e,t,r){var n=e.name;this._entities.forEach(function(e){if(e!=null){if(e.getProperty(n)==t){e.setProperty(n,r)}}})};t._fixupKey=function(e,t){var r=this._indexMap[e];if(r===undefined){throw new Error("Internal Error in key fixup - unable to locate entity")}var n=this._entities[r];var a=n.entityType.keyProperties[0].name;n.setProperty(a,t);delete n.entityAspect.hasTempKey;delete this._indexMap[e];this._indexMap[t]=r};t._replaceKey=function(e,t){var r=this._indexMap[e._keyInGroup];delete this._indexMap[e._keyInGroup];this._indexMap[t._keyInGroup]=r};function r(t){if(!t){return function(e){return!!e}}else if(t.length===1){var r=t[0];return function(e){return!!e&&e.entityAspect.entityState===r}}else{return function(e){return!!e&&-1!==t.indexOf(e.entityAspect.entityState)}}}return e}(),rt=function(){var t=function e(t){if(arguments.length>1){throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.")}if(arguments.length===0){t={serviceName:""}}else if(typeof t==="string"){t={serviceName:t}}r(this,t,true);this.entityChanged=new se("entityChanged",this);this.validationErrorsChanged=new se("validationErrorsChanged",this);this.hasChangesChanged=new se("hasChangesChanged",this);this.clear()};var e=t.prototype;e._$typeName="EntityManager";se.bubbleEvent(e,null);e.setProperties=function(e){r(this,e,false)};function r(e,t,r){var n=r?et.defaultInstance:e.queryOptions;var a=r?at.defaultInstance:e.saveOptions;var i=r?ye.defaultInstance:e.validationOptions;var o=ie(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Ne).whereParam("queryOptions").isInstanceOf(et).isOptional().withDefault(n).whereParam("saveOptions").isInstanceOf(at).isOptional().withDefault(a).whereParam("validationOptions").isInstanceOf(ye).isOptional().withDefault(i).whereParam("keyGeneratorCtor").isFunction().isOptional();if(r){o=o.whereParam("metadataStore").isInstanceOf(Ce).isOptional().withDefault(new Ce)}o.applyAll(e);G(e.queryOptions,n);G(e.saveOptions,a);G(e.validationOptions,i);if(t.serviceName){e.dataService=new Ne({serviceName:e.serviceName})}e.serviceName=e.dataService&&e.dataService.serviceName;e.keyGeneratorCtor=e.keyGeneratorCtor||ze;if(r||t.keyGeneratorCtor){e.keyGenerator=new e.keyGeneratorCtor}}e.createEntity=function(e,t,r,n){ne(e,"entityType").isString().or().isInstanceOf(Fe).check();ne(r,"entityState").isEnumOf(ge).isOptional().check();ne(n,"mergeStrategy").isEnumOf(Ye).isOptional().check();if(typeof e==="string"){e=this.metadataStore._getEntityType(e)}r=r||ge.Added;var a;ee(this,"isLoading",true,function(){a=e.createEntity(t)});if(r!==ge.Detached){a=this.attachEntity(a,r,n)}return a};t.importEntities=function(e,t){var r=new rt;r.importEntities(e,t);return r};e.acceptChanges=function(){this.getChanges().map(function(e){return e.entityAspect._checkOperation("acceptChanges")}).forEach(function(e){e.acceptChanges()})};e.exportEntities=function(e,t){ne(e,"entities").isArray().isEntity().or().isNonEmptyArray().isInstanceOf(Fe).or().isNonEmptyArray().isString().or().isOptional().check();ne(t,"config").isObject().or().isBoolean().or().isOptional().check();if(t==null){t={includeMetadata:true,asString:true}}else if(typeof t==="boolean"){t={includeMetadata:t,asString:true}}ie(t).whereParam("asString").isBoolean().isOptional().withDefault(true).whereParam("includeMetadata").isBoolean().isOptional().withDefault(true).applyAll(t);var r=c(this,e);var n=L({},r,["tempKeys","entityGroupMap"]);if(t.includeMetadata){n=L(n,this,["dataService","saveOptions","queryOptions","validationOptions"]);n.metadataStore=this.metadataStore.exportMetadata()}else{n.metadataVersion=q.metadataVersion;n.metadataStoreName=this.metadataStore.name}var a=t.asString?JSON.stringify(n,null,ue.stringifyPad):n;return a};e.importEntities=function(e,i){i=i||{};ie(i).whereParam("mergeStrategy").isEnumOf(Ye).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().whereParam("mergeAdds").isBoolean().isOptional().applyAll(i);var o=this;var t=typeof e==="string"?JSON.parse(e):e;if(t.metadataStore){this.metadataStore.importMetadata(t.metadataStore);this.dataService=t.dataService&&Ne.fromJSON(t.dataService)||new Ne({serviceName:t.serviceName});this.saveOptions=new at(t.saveOptions);this.queryOptions=et.fromJSON(t.queryOptions);this.validationOptions=new ye(t.validationOptions)}else{i.metadataVersionFn&&i.metadataVersionFn({metadataVersion:t.metadataVersion,metadataStoreName:t.metadataStoreName})}var r={};t.tempKeys.forEach(function(e){var t=me.fromJSON(e,o.metadataStore);r[t.toString()]=new me(t.entityType,o.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))});var s=[];i.tempKeyMap=r;te(function(){o._pendingPubs=[]},function(e){o._pendingPubs.forEach(function(e){e()});o._pendingPubs=null;o._hasChangesAction&&o._hasChangesAction()},function(){U(t.entityGroupMap,function(e,t){var r=o.metadataStore._getEntityType(e,true);var n=F(o,r);var a=h(n,t,i);if(a&&a.length){s=s.concat(a)}});s.forEach(function(e){if(!e.entityAspect.entityState.isDeleted()){o._linkRelatedEntities(e)}})});return{entities:s,tempKeyMapping:r}};e.clear=function(){B(this._entityGroupMap,function(e,t){return t._checkOperation()}).forEach(function(e){e._clear()});this._entityGroupMap={};this._unattachedChildrenMap=new K;this.keyGenerator=new this.keyGeneratorCtor;this.entityChanged.publish({entityAction:he.Clear});this._setHasChanges(false)};e.createEmptyCopy=function(){var e=new t(L({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]));return e};e.addEntity=function(e){return this.attachEntity(e,ge.Added)};e.attachEntity=function(e,t,r){ne(e,"entity").isRequired().check();this.metadataStore._checkEntityType(e);t=ne(t,"entityState").isEnumOf(ge).isOptional().check(ge.Unchanged);r=ne(r,"mergeStrategy").isEnumOf(Ye).isOptional().check(Ye.Disallowed);if(e.entityType.metadataStore!==this.metadataStore){throw new Error("Cannot attach this entity because the EntityType ("+e.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.")}var n=e.entityAspect;if(n){if(n._inProcessEntity)return n._inProcessEntity}else{n=new de(e)}var a=n.entityManager;if(a){if(a===this){return e}else{throw new Error("This entity already belongs to another EntityManager")}}var i=this;var o;ee(this,"isLoading",true,function(){if(t.isAdded()){P(i,e)}o=i._attachEntityCore(e,t,r);n._inProcessEntity=o;try{_(i,e,t,r)}finally{n._inProcessEntity=null}});if(this.validationOptions.validateOnAttach){o.entityAspect.validateEntity()}if(!t.isUnchanged()){this._notifyStateChange(o,true)}this.entityChanged.publish({entityAction:he.Attach,entity:o});return o};e.detachEntity=function(e){ne(e,"entity").isEntity().check();var t=e.entityAspect;if(!t){return false}if(t.entityManager!==this){throw new Error("This entity does not belong to this EntityManager.")}return t.setDetached()};e.fetchMetadata=function(e,t,r){if(typeof e==="function"){r=t;t=e;e=null}else{ne(e,"dataService").isInstanceOf(Ne).isOptional().check();ne(t,"callback").isFunction().isOptional().check();ne(r,"errorCallback").isFunction().isOptional().check()}var n=this.metadataStore.fetchMetadata(e||this.dataService);return d(n,t,r)};e.executeQuery=function(e,t,r){ne(e,"query").isInstanceOf(Le).or().isString().check();ne(t,"callback").isFunction().isOptional().check();ne(r,"errorCallback").isFunction().isOptional().check();var n;var a=et.resolve([e.queryOptions,this.queryOptions,et.defaultInstance]);var i=Ne.resolve([e.dataService,this.dataService]);if(!i.hasServerMetadata||this.metadataStore.hasMetadataFor(i.serviceName)){n=N(this,e,a,i)}else{var o=this;n=this.fetchMetadata(i).then(function(){return N(o,e,a,i)})}return d(n,t,r)};e.executeQueryLocally=function(e){return p(this,e).results};function p(e,t){ne(t,"query").isInstanceOf(Le).check();var r=e.metadataStore;var n=t._getFromEntityType(r,true);var a=M(e,n);var i=t.wherePredicate&&t.wherePredicate.toFunction({entityType:n});var o=et.resolve([t.queryOptions,e.queryOptions,et.defaultInstance]);var s=o.includeDeleted===true;var u=function(e){return e&&(s||!e.entityAspect.entityState.isDeleted())&&(i?i(e):true)};var p=[];a.forEach(function(e){var t=e._entities.filter(u);if(t.length){p=p.length?p.concat(t):t}});var c=t.orderByClause&&t.orderByClause.getComparer(n);if(c){p.sort(c)}if(t.inlineCountEnabled){var f=p.length}var l=t.skipCount;if(l){p=p.slice(l)}var y=t.takeCount;if(y){p=p.slice(0,y)}var h=t.selectClause;if(h){var d=h.toFunction();p=p.map(d)}return{results:p,inlineCount:f}}e.saveChanges=function(e,t,n,r){ne(e,"entities").isOptional().isArray().isEntity().check();ne(t,"saveOptions").isInstanceOf(at).isOptional().check();ne(n,"callback").isFunction().isOptional().check();ne(r,"errorCallback").isFunction().isOptional().check();t=t||this.saveOptions||at.defaultInstance;var a=e==null;var i=S(this,e);if(i.length===0){var o={entities:[],keyMappings:[]};if(n)n(o);return Ae.resolve(o)}if(!t.allowConcurrentSaves){var s=i.some(function(e){return e.entityAspect.isBeingSaved});if(s){var u=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");if(r)r(u);return Ae.reject(u)}}v(i);var p=this.saveChangesValidateOnClient(i);if(p){if(r)r(p);return Ae.reject(p)}var c=Ne.resolve([t.dataService,this.dataService]);var f={entityManager:this,dataService:c,processSavedEntities:h,resourceName:t.resourceName||this.saveOptions.resourceName||"SaveChanges"};var l={entities:i,saveOptions:t};try{C(i);return c.adapterInstance.saveChanges(f,l).then(y).then(null,d)}catch(u){g(i,false);if(r)r(u);return Ae.reject(u)}function y(e){var t=f.entityManager;g(i,false);var r=e.entities=f.processSavedEntities(e);t._setHasChanges(null);if(n)n(e);return Ae.resolve(e)}function h(e){var t=e.entities;var r=e.deletedKeys||[];if(t.length===0&&r.length==0){return[]}var n=e.keyMappings;var a=f.entityManager;E(a,n);ee(a,"isLoading",true,function(){var e=new nt({query:null,entityManager:a,mergeOptions:{mergeStrategy:Ye.OverwriteChanges},dataService:c});t=e.visitAndMerge(t,{nodeType:"root"})});r.forEach(function(e){var t=a.metadataStore._getEntityType(e.entityTypeName);var r=new me(t,e.keyValues);var n=a.findEntityByKey(r);if(n){n.entityAspect.setDetached()}});return t}function d(e){g(i,false);m(f,e);if(r)r(e);return Ae.reject(e)}};e.saveChangesValidateOnClient=function(e){if(this.validationOptions.validateOnSave){var t=e.filter(function(e){var t=e.entityAspect;var r=t.entityState.isDeleted()||t.validateEntity();return!r});if(t.length>0){var r=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");r.entityErrors=n(t);return r}}return null};function v(e){e.forEach(function(e){var r=[];var t=e.entityAspect;U(t._validationErrors,function(e,t){if(t.isServerError)r.push(e)});if(r.length===0)return;t._processValidationOpAndPublish(function(){r.forEach(function(e){t._removeValidationError(e)})})})}function n(e){var a=[];e.forEach(function(n){U(n.entityAspect._validationErrors,function(e,t){var r=L({entity:n,errorName:t.validator.name},t,["errorMessage","propertyName","isServerError"]);a.push(r)})});return a}function m(e,t){var r=t.entityErrors;if(!r)return;var u=e.entityManager;var p=u.metadataStore;t.entityErrors=r.map(function(e){var t=null;if(e.keyValues){var r=p._getEntityType(e.entityTypeName);var n=new me(r,e.keyValues);t=u.findEntityByKey(n)}if(t){var a=e.propertyName?{propertyName:e.propertyName,property:r.getProperty(e.propertyName)}:{};var i=le.getKey(e.errorName||e.errorMessage,e.propertyName);var o=new le(null,a,e.errorMessage,i);o.isServerError=true;t.entityAspect.addValidationError(o)}var s=L({entity:t,isServerError:true},e,["errorName","errorMessage","propertyName"]);return s})}e._findEntityGroup=function(e){return this._entityGroupMap[e.name]};e.getEntityByKey=function(){var r=u(this,arguments).entityKey;var e=r._subtypes||[r.entityType];var n=null;e.some(function(e){var t=this._findEntityGroup(e);n=t&&t.findEntityByKey(r);return n},this);return n};e.fetchEntityByKey=function(){var e=Ne.resolve([this.dataService]);if(!e.hasServerMetadata||this.metadataStore.hasMetadataFor(e.serviceName)){return a(this,arguments)}else{var t=this;var r=arguments;return this.fetchMetadata(e).then(function(){return a(t,r)})}};function a(e,t){var r=u(e,t);var n=r.entityKey;var a=r.remainingArgs.length===0?false:!!r.remainingArgs[0];var i;var o=false;if(a){i=e.getEntityByKey(n);o=!!i;if(o&&!e.queryOptions.includeDeleted&&i.entityAspect.entityState.isDeleted()){i=null;o=e.queryOptions.mergeStrategy!==Ye.OverwriteChanges}}if(o){return Ae.resolve({entity:i,entityKey:n,fromCache:true})}else{return Le.fromEntityKey(n).using(e).execute().then(function(e){i=e.results.length===0?null:e.results[0];return Ae.resolve({entity:i,entityKey:n,fromCache:false})})}}e.findEntityByKey=function(e){return this.getEntityByKey(e)};e.generateTempKeyValue=function(e){ne(e,"entity").isEntity().check();var t=e.entityType;var r=this.keyGenerator.generateTempKeyValue(t);var n=t.keyProperties[0];e.setProperty(n.name,r);e.entityAspect.hasTempKey=true;return r};e.hasChanges=function(e){if(!this._hasChanges)return false;if(e===undefined)return this._hasChanges;return this._hasChangesCore(e)};e._hasChangesCore=function(e){e=s(this,e);var t=T(this,e);return t.some(function(e){return e&&e.hasChanges()})};e.getChanges=function(e){e=s(this,e);return i(this,e)};e.rejectChanges=function(){if(!this._hasChanges)return[];var e=i(this,null);var t=e.map(function(e){return e.entityAspect._checkOperation("rejectChanges")});this._hasChanges=false;t.forEach(function(e){e.rejectChanges()});this.hasChangesChanged.publish({entityManager:this,hasChanges:false});return e};e.getEntities=function(e,t){e=s(this,e);ne(t,"entityStates").isOptional().isEnumOf(ge).or().isNonEmptyArray().isEnumOf(ge).check();t=t&&b(this,t);return o(this,e,t)};e._notifyStateChange=function(e,t){var r={entityAction:he.EntityStateChange,entity:e};if(t){if(!this._hasChanges)this._setHasChanges(true)}else{if(this._hasChanges){if(this.isLoading){this._hasChangesAction=this._hasChangesAction||function(){this._setHasChanges(null);this.entityChanged.publish(r)}.bind(this);return}else{this._setHasChanges(null)}}}this.entityChanged.publish(r)};e._setHasChanges=function(e){if(e==null)e=this._hasChangesCore();var t=this._hasChanges;this._hasChanges=e;if(e!=t){this.hasChangesChanged.publish({entityManager:this,hasChanges:e})}this._hasChangesAction=null};e._linkRelatedEntities=function(p){var i=this;var a=p.entityAspect;ee(i,"isLoading",true,function(){var s=i._unattachedChildrenMap;var e=a.getKey();var t=e.entityType;while(t){var u=e.toString(t);var r=s.getTuplesByString(u);if(r&&r.length){r.slice(0).forEach(function(e){var t=e.children.filter(function(e){return e.entityAspect.entityState!==ge.Detached});var r,n;var a=e.navigationProperty;if(a.getInverse()){r=a;n=a.getInverse();if(n.isScalar){var i=t[0];p.setProperty(n.name,i);i.setProperty(r.name,p)}else{var o=p.getProperty(n.name);t.forEach(function(e){o.push(e);e.setProperty(r.name,p)})}}else{if(a.isScalar){r=a;t.forEach(function(e){e.setProperty(r.name,p)})}else{n=a;var o=p.getProperty(n.name);t.forEach(function(e){o._push(e)})}}s.removeChildrenByString(u,r)})}t=t.baseEntityType}p.entityType.navigationProperties.forEach(function(e){if(e.isScalar){var t=p.getProperty(e.name);if(t)return}var r=a.getParentKey(e);if(r){if(r._isEmpty())return;var n=i.findEntityByKey(r);if(n){p.setProperty(e.name,n)}else{s.addChild(r,e,p)}}});p.entityType.foreignKeyProperties.forEach(function(e){var t=e.inverseNavigationProperty;if(!t)return;var r=p.getProperty(e.name);var n=new me(t.parentType,[r]);var a=i.findEntityByKey(n);if(a){if(t.isScalar){a.setProperty(t.name,p)}else{if(i.isLoading){a.getProperty(t.name)._push(p)}else{a.getProperty(t.name).push(p)}}}else{s.addChild(n,t,p)}})})};function s(t,e){ne(e,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(Fe).or().isNonEmptyArray().isInstanceOf(Fe).check();if(typeof e==="string"){e=t.metadataStore._getEntityType(e,false)}else if(Array.isArray(e)&&typeof e[0]==="string"){e=e.map(function(e){return t.metadataStore._getEntityType(e,false)})}return e}function i(e,t){var r=T(e,t);var n;r.forEach(function(e){if(!e)return;var t=e.getChanges();if(n&&n.length){n=n.concat(t)}else{n=t}});return n||[]}function o(e,t,r){var n=T(e,t);var a;n.forEach(function(e){if(!e)return;var t=e.getEntities(r);if(a&&a.length){a=a.concat(t)}else{a=t}});return a||[]}function u(e,t){try{if(t[0]instanceof me){return{entityKey:t[0],remainingArgs:z(t,1)}}else if(t.length>=2){var r=typeof t[0]==="string"?e.metadataStore._getEntityType(t[0],false):t[0];return{entityKey:new me(r,t[1]),remainingArgs:z(t,2)}}}catch(e){}throw new Error("Must supply an EntityKey OR an EntityType name or EntityType followed by a key value or an array of key values.")}function g(e,t){e.forEach(function(e){e.entityAspect.isBeingSaved=t})}function c(r,e){var n;var t=e&&e[0];if(t){n={};if(t.entityType){e.forEach(function(e){if(e.entityAspect.entityState==ge.Detached){throw new Error("Unable to export an entity with an EntityState of 'Detached'")}var t=n[e.entityType.name];if(!t){t={};t.entityType=e.entityType;t._entities=[];n[e.entityType.name]=t}t._entities.push(e)})}else{var a=s(r,e);a.forEach(function(e){var t=r._entityGroupMap[e.name];if(t&&t._entities.length){n[e.name]=t}})}}else if(e&&e.length===0){n={}}else{n=r._entityGroupMap}var i=[];var o={};U(n,function(e,t){o[e]=f(t,i)});return{entityGroupMap:o,tempKeys:i}}function f(e,r){var t={};var n=e.entityType;var a=n.dataProperties;var i=R(n);var o=[];e._entities.forEach(function(e){if(e){var t=l(e,a,i,r);o.push(t)}});t.entities=o;return t}function l(a,e,i,t){var o={};e.forEach(function(e){var t=e.name;var r=a.getProperty(t);if(r==null&&e.defaultValue==null)return;if(r&&e.isComplexProperty){var n=e.dataType.dataProperties;r=H(r,function(e){return l(e,n,i)})}else{r=i?i(e,r):r;if(e.isUnmapped){r=J(r)}}if(r===undefined)return;o[t]=r});var r,n;if(a.entityAspect){r=a.entityAspect;var s=r.entityState;n={tempNavPropNames:y(r,t),entityState:s.name};if(r.extraMetadata){n.extraMetadata=r.extraMetadata}if(s.isModified()||s.isDeleted()){n.originalValuesMap=r.originalValues}o.entityAspect=n}else{r=a.complexAspect;n={};if(r.originalValues&&!re(r.originalValues)){n.originalValuesMap=r.originalValues}o.complexAspect=n}return o}function y(e,t){var r=e.entity;if(e.hasTempKey){t.push(e.getKey().toJSON())}var n;r.entityType.navigationProperties.forEach(function(e){if(e.relatedDataProperties){var t=r.getProperty(e.name);if(t&&t.entityAspect.hasTempKey){n=n||[];n.push(e.name)}}});return n}function h(s,e,t){var u=t.tempKeyMap;var p=s.entityType;var c=t.mergeStrategy;var f=t.mergeAdds;var l=null;var y=s.entityManager;var h=y.entityChanged;var d=[];var v=ke.getRawValueFromClient;e.entities.forEach(function(e){var t=e.entityAspect;var r=p.getEntityKeyFromRawEntity(e,v);var n=ge.fromName(t.entityState);if(!n||n==ge.Detached){throw new Error("Only entities with a non detached entity state may be imported.")}var a=!f&&n.isAdded()&&w(u,r);l=a?null:s.findEntityByKey(r);if(l){if(c===Ye.SkipMerge){}else if(c===Ye.Disallowed){throw new Error("A MergeStrategy of 'Disallowed' prevents "+r.toString()+" from being merged")}else{var i=l.entityAspect.entityState;var o=i.isUnchanged();if(c===Ye.OverwriteChanges||o){p._updateTargetFromRaw(l,e,v);l.entityAspect.setEntityState(n);h.publish({entityAction:he.MergeOnImport,entity:l})}}}else{l=p._createInstanceCore();p._updateTargetFromRaw(l,e,v);if(a){l.entityAspect.hasTempKey=true;l.setProperty(p.keyProperties[0].name,a.values[0]);if(t.tempNavPropNames){t.tempNavPropNames.forEach(function(e){var t=p.getNavigationProperty(e);var r=t.relatedDataProperties[0].name;var n=l.getProperty(r);var a=new me(t.entityType,[n]);var i=w(u,a);l.setProperty(r,i.values[0])})}}l=s.attachEntity(l,n);h.publish({entityAction:he.AttachOnImport,entity:l});if(!n.isUnchanged()){y._notifyStateChange(l,true)}}d.push(l)});return d}function w(e,t){var r=e[t.toString()];if(r)return r;var n=t._subtypes;if(!n)return null;for(var a=0,i=n.length;a<i;a++){r=e[t.toString(n[a])];if(r)return r}return null}function d(e,t,r){e=e.then(function(e){if(t)t(e);return Ae.resolve(e)},function(e){if(r)r(e);return Ae.reject(e)});return e}function S(t,e){var r;if(e){r=e.filter(function(e){if(e.entityAspect.entityManager!==t){throw new Error("Only entities in this entityManager may be saved")}return!e.entityAspect.entityState.isDetached()})}else{r=t.getChanges()}return r}function E(r,e){r._inKeyFixup=true;e.forEach(function(e){var t=r._entityGroupMap[e.entityTypeName];if(!t){throw new Error("Unable to locate the following fully qualified EntityType name: "+e.entityTypeName)}t._fixupKey(e.tempValue,e.realValue)});r._inKeyFixup=false}function T(e,t){var r=e._entityGroupMap;if(t){return Q(t).map(function(e){if(e instanceof Fe){return r[e.name]}else{throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}})}else{return $(r)}}function P(e,t){var r=t.entityAspect.getKey();var n=Y(t.entityType.keyProperties,r.values,function(e,t){return e.defaultValue===t?e:null}).filter(function(e){return e!==null});if(n.length){if(t.entityType.autoGeneratedKeyType!==Ie.None){e.generateTempKeyValue(t)}else{if(n.length===r.values.length){throw new Error("Cannot attach an object of type  ("+t.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}}}}function b(e,t){if(!t)return null;t=Q(t);t.forEach(function(e){if(!ge.contains(e)){throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}});return t}e._attachEntityCore=function(e,t,r){var n=F(this,e.entityType);var a=n.attachEntity(e,t,r);this._linkRelatedEntities(a);return a};e._updateFkVal=function(e,t,r){var n=this._entityGroupMap[e.parentType.name];if(!n)return;n._updateFkVal(e,t,r)};function _(r,n,a,i){var e=n.entityType.navigationProperties;e.forEach(function(e){var t=n.getProperty(e.name);if(e.isScalar){if(!t)return;r.attachEntity(t,a,i)}else{t.forEach(function(e){r.attachEntity(e,a,i)})}})}function N(n,a,e,i){try{var o;var t=n.metadataStore;if(t.isEmpty()&&i.hasServerMetadata){throw new Error("cannot execute _executeQueryCore until metadataStore is populated.")}if(e.fetchStrategy===Xe.FromLocalCache){try{var r=p(n,a);return Ae.resolve({results:r.results,entityManager:n,inlineCount:r.inlineCount,query:a})}catch(e){return Ae.reject(e)}}var s=new nt({query:a,entityManager:n,dataService:i,mergeOptions:{mergeStrategy:e.mergeStrategy,noTracking:!!a.noTrackingEnabled,includeDeleted:e.includeDeleted}});var u=n.validationOptions.validateOnQuery;return i.adapterInstance.executeQuery(s).then(function(r){var e=te(function(){var e={isLoading:n.isLoading};n.isLoading=true;n._pendingPubs=[];return e},function(e){n.isLoading=e.isLoading;n._pendingPubs.forEach(function(e){e()});n._pendingPubs=null;n._hasChangesAction&&n._hasChangesAction();a=null;s=null;if(e.error){Ae.reject(e.error)}},function(){var e=i.jsonResultsAdapter.extractResults(r);e=Q(e);o=s.visitAndMerge(e,{nodeType:"root"});if(u){o.forEach(function(e){e.entityAspect&&e.entityAspect.validateEntity()})}s.processDeferred();O(o,a);var t=B(s.refMap);return{results:o,query:a,entityManager:n,httpResponse:r.httpResponse,inlineCount:r.inlineCount,retrievedEntities:t}});return Ae.resolve(e)},function(e){if(e){e.query=a;e.entityManager=n}return Ae.reject(e)})}catch(e){if(e){e.query=a}return Ae.reject(e)}}function O(r,e){if(e.noTrackingEnabled)return;var t=e.expandClause;if(t==null)return;t.propertyPaths.forEach(function(e){var t=e.split(".");A(r,t)})}function A(e,n){var a=n[0];e.forEach(function(e){var t=e.entityAspect;if(!t)return;t._markAsLoaded(a);if(n.length===1)return;var r=e.getProperty(a);if(!r)return;if(!r.arrayChanged)r=[r];A(r,n.slice(1))})}function C(e){var t=e.filter(function(e){e.entityAspect.isBeingSaved=true;return e.entityAspect.entityState.isModified()&&e.entityType.concurrencyProperties.length>0});if(t.length===0)return;t.forEach(function(t){t.entityType.concurrencyProperties.forEach(function(e){x(t,e)})})}function x(e,t){if(e.entityAspect.originalValues[t.name])return;var r=e.getProperty(t.name);if(!r)r=t.dataType.defaultValue;if(t.dataType.isNumeric){e.setProperty(t.name,r+1)}else if(t.dataType.getConcurrencyValue){var n=t.dataType.getConcurrencyValue(r);e.setProperty(t.name,n)}else if(t.dataType===_e.Binary){return}else{throw new Error("Unable to update the value of concurrency property before saving: "+t.name)}}function F(e,t){var r=e._entityGroupMap[t.name];if(!r){r=new tt(e,t);e._entityGroupMap[t.name]=r}return r}function M(t,e){var r=e.getSelfAndSubtypes();return r.map(function(e){return F(t,e)})}e.helper={unwrapInstance:k,unwrapOriginalValues:D,unwrapChangedValues:I};function k(r,n){var a={};var e=r.entityType||r.complexType;var i=R(e);var o={};e.dataProperties.forEach(function(e){if(e.isComplexProperty){a[e.nameOnServer]=H(r.getProperty(e.name),function(e){return k(e,n)})}else{var t=r.getProperty(e.name);t=n?n(e,t):t;if(t===undefined)return;t=i?i(e,t):t;if(t!==undefined){if(e.isUnmapped){o[e.nameOnServer]=J(t)}else{a[e.nameOnServer]=t}}}});if(!re(o)){a.__unmapped=o}return a}function D(a,i,o){var n=a.entityType||a.complexType;var e=a.entityAspect||a.complexAspect;var s=i.namingConvention.clientPropertyNameToServer;var u={};U(e.originalValues,function(e,t){var r=n.getProperty(e);t=o?o(r,t):t;if(t!==undefined){u[s(e,r)]=t}});n.complexProperties.forEach(function(e){var t=a.getProperty(e.name);if(e.isScalar){var r=D(t,i,o);if(!re(r)){u[s(e.name,e)]=r}}else{var n=t.map(function(e){return D(e,i,o)});u[s(e.name,e)]=n}});return u}function I(a,e,i){var o=a.entityType;var s=R(o);var u=e.namingConvention.clientPropertyNameToServer;var p={};U(a.entityAspect.originalValues,function(e,t){var r=o.getProperty(e);var n=a.getProperty(e);n=i?i(r,n):n;if(n===undefined)return;n=s?s(r,n):n;if(n!==undefined){p[u(e,r)]=n}});o.complexProperties.forEach(function(e){if(V(a,e)){var t=a.getProperty(e.name);p[u(e.name,e)]=H(t,function(e){return k(e,i)})}});return p}function V(e,t){var r=e.getProperty(t.name);if(t.isScalar){return j(r)}else{if(r._origValues)return true;return r.some(function(e){return j(e)})}}function j(t){if(!re(t.complexAspect.originalValues))return true;return t.complexType.complexProperties.some(function(e){return V(t,e)})}function R(e){return e.serializerFn||e.metadataStore&&e.metadataStore.serializerFn}function K(){this.map={}}K.prototype.addChild=function(e,t,r){var n=this.getTuple(e,t);if(!n){n={navigationProperty:t,children:[]};X(this.map,e.toString()).push(n)}n.children.push(r)};K.prototype.removeChildrenByString=function(e,t){var r=this.map[e];if(!r)return;W(r,function(e){return e.navigationProperty===t});if(!r.length){delete this.map[e]}};K.prototype.getTuple=function(e,t){var r=this.getTuples(e);if(!r)return null;var n=Z(r,function(e){return e.navigationProperty===t});return n};K.prototype.getTuples=function(e){var t=[];var r=this.map[e.toString()];if(r){t=t.concat(r)}var n=e.entityType;while(n.baseEntityType){n=n.baseEntityType;var a=e.toString(n);r=this.map[a];if(r){t=t.concat(r)}}return t.length?t:undefined};K.prototype.getTuplesByString=function(e){return this.map[e]};return t}();q.EntityManager=rt;var nt=function(){var e=function e(t){L(this,t,["query","entityManager","dataService","mergeOptions"]);this.refMap={};this.deferredFns=[];this.jsonResultsAdapter=this.dataService.jsonResultsAdapter;this.metadataStore=this.entityManager.metadataStore;this.rawValueFn=ke.getRawValueFromServer};var t=e.prototype;var i=_e.parseRawValue;t._$typeName="MappingContext";t.getUrl=function(){var e=this.query;if(!e){throw new Error("query cannot be empty")}var t;if(typeof e==="string"){t=e}else if(e instanceof Le){t=this.dataService.uriBuilder.buildUri(e,this.metadataStore)}else{throw new Error("unable to recognize query parameter as either a string or an EntityQuery")}return this.dataService.qualifyUrl(t)};t.visitAndMerge=function(e,r){var n=this.query;var a=this.jsonResultsAdapter;r=r||{};var i=this;return H(e,function(e){if(n==null&&e.entityAspect){if(e.entityAspect.entityState.isDeleted()){i.entityManager.detachEntity(e)}else{e.entityAspect.acceptChanges()}return e}var t=a.visitNode(e,i,r)||{};e=t.node||e;if(n&&r.nodeType==="root"&&!t.entityType){t.entityType=n._getToEntityType&&n._getToEntityType(i.metadataStore)}return u(i,e,t)},this.mergeOptions.includeDeleted)};t.processDeferred=function(){if(this.deferredFns.length>0){this.deferredFns.forEach(function(e){e()})}};function u(e,t,r,n){if(r.ignore||t==null){return null}else if(r.nodeRefId){var a=c(e,r.nodeRefId);if(typeof a==="function"&&n!=null){e.deferredFns.push(function(){n(a)});return undefined}return a}else if(r.entityType){var i=r.entityType;if(e.mergeOptions.noTracking){t=o(e,i,t);if(i.noTrackingFn){t=i.noTrackingFn(t,i)}if(r.nodeId){e.refMap[r.nodeId]=t}return t}else{if(i.isComplexType){return o(e,i,t)}else{return f(e,t,r)}}}else{if(!r.passThru&&typeof t==="object"&&!M(t)){t=s(e,t)}if(r.nodeId){e.refMap[r.nodeId]=t}return t}}function o(r,e,n){var a={};e.dataProperties.forEach(function(t){if(t.isComplexProperty){a[t.name]=H(n[t.nameOnServer],function(e){return o(r,t.dataType,e)})}else{a[t.name]=i(n[t.nameOnServer],t.dataType)}});e.navigationProperties&&e.navigationProperties.forEach(function(e){var t={nodeType:"navProp",navigationProperty:e};p(n[e.nameOnServer],r,t,a,e.name)});return a}function s(a,e){var i=a.metadataStore.namingConvention.serverPropertyNameToClient;var o={};U(e,function(e,t){var r=i(e);var n={nodeType:"anonProp",propertyName:r};p(t,a,n,o,r)});return o}function p(e,r,n,a,i){var o=r.jsonResultsAdapter;var s=o.visitNode(e,r,n)||{};e=s.node||e;if(s.ignore)return;if(s.passThru)return e;if(Array.isArray(e)){n.nodeType=n.nodeType+"Item";a[i]=e.map(function(e,t){s=o.visitNode(e,r,n)||{};e=s.node||e;return u(r,e,s,function(e){a[i][t]=e()})})}else{a[i]=u(r,e,s,function(e){a[i]=e()})}}function c(e,t){var r=e.refMap[t];if(r===undefined){return function(){return e.refMap[t]}}else{return r}}function a(e,t,r){var n=r._$meta.nodeId;if(!n&&r._$meta.extraMetadata){n=r._$meta.extraMetadata.uriKey}if(n!=null){e.refMap[n]=t}}function f(e,t,r){t._$meta=r;var n=e.entityManager;var a=r.entityType;if(typeof a==="string"){a=e.metadataStore._getEntityType(a,false)}t.entityType=a;var i=e.mergeOptions.mergeStrategy;var o=e.query==null;var s=a.getEntityKeyFromRawEntity(t,e.rawValueFn);var u=n.findEntityByKey(s);if(u){if(o&&u.entityAspect.entityState.isDeleted()){n.detachEntity(u);return u}var p=u.entityAspect.entityState;if(i===Ye.Disallowed){throw new Error("A MergeStrategy of 'Disallowed' prevents "+s.toString()+" from being merged")}else if(i===Ye.SkipMerge){y(e,u,t)}else{if(i===Ye.OverwriteChanges||p.isUnchanged()){h(e,u,t);u.entityAspect.wasLoaded=true;if(r.extraMetadata){u.entityAspect.extraMetadata=r.extraMetadata}u.entityAspect.entityState=ge.Unchanged;l(u);u.entityAspect.propertyChanged.publish({entity:u,propertyName:null});var c=o?he.MergeOnSave:he.MergeOnQuery;n.entityChanged.publish({entityAction:c,entity:u});if(!p.isUnchanged()){n._notifyStateChange(u,false)}}else{if(p==ge.Deleted&&!e.mergeOptions.includeDeleted){return null}y(e,u,t)}}}else{u=a._createInstanceCore();h(e,u,t);if(r.extraMetadata){u.entityAspect.extraMetadata=r.extraMetadata}n._attachEntityCore(u,ge.Unchanged,i);u.entityAspect.wasLoaded=true;n.entityChanged.publish({entityAction:he.AttachOnQuery,entity:u})}return u}function l(r){var e=r.entityAspect||r.complexAspect;e.originalValues={};var t=r.entityType||r.complexType;t.complexProperties.forEach(function(e){var t=r.getProperty(e.name);if(e.isScalar){l(t)}else{t._acceptChanges();t.forEach(l)}})}function y(t,e,r){a(t,e,r);r.entityType.navigationProperties.forEach(function(e){if(e.isScalar){m(t,r,e)}else{g(t,r,e)}})}function h(t,r,n){a(t,r,n);var e=r.entityType;e._updateTargetFromRaw(r,n,t.rawValueFn);e.navigationProperties.forEach(function(e){if(e.isScalar){d(t,e,r,n)}else{v(t,e,r,n)}})}function d(e,t,r,n){var a=m(e,n,t);if(a==null)return;if(typeof a==="function"){e.deferredFns.push(function(){a=a();w(a,r,t)})}else{w(a,r,t)}}function v(t,e,r,n){var a=g(t,n,e);if(a==null)return;var i=e.getInverse();if(!i)return;var o=r.getProperty(e.name);o.wasLoaded=true;a.forEach(function(e){if(typeof e==="function"){t.deferredFns.push(function(){e=e();S(t,e,o,r,i)})}else{S(t,e,o,r,i)}})}function m(e,t,r){var n=t[r.nameOnServer];if(!n)return null;var a=e.visitAndMerge(n,{nodeType:"navProp",navigationProperty:r});return a}function g(e,t,r){var n=t[r.nameOnServer];if(!n)return null;if(!Array.isArray(n)){n=n.results;if(!n){return null}}var a=e.visitAndMerge(n,{nodeType:"navPropItem",navigationProperty:r});return a}function w(e,t,r){if(!e)return;var n=r.name;var a=t.getProperty(n);if(a!==e){t.setProperty(n,e);var i=r.getInverse();if(!i)return;if(i.isScalar){e.setProperty(i.name,t)}else{var o=e.getProperty(i.name);o.push(t)}}}function S(e,t,r,n,a){if(!t)return;if(t.entityAspect.entityState===ge.Modified&&e.mergeOptions.mergeStrategy===Ye.PreserveChanges){var i=t.entityAspect.originalValues;var o=a.relatedDataProperties.some(function(e){return i[e.name]!=undefined});if(o)return}var s=t.getProperty(a.name);if(s!==n){r.push(t);t.setProperty(a.name,n)}}return e}(),at=function(){var e=function e(t){r(this,t)};var t=e.prototype;t._$typeName="SaveOptions";t.setAsDefault=function(){return o(this,e)};t.using=function(e){return r(this,e)};function r(e,t){if(t){ie(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Ne).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(e)}return e}e.defaultInstance=new e({allowConcurrentSaves:false});return e}(),it;if(q.SaveOptions=at,q.AbstractDataServiceAdapter=function(){function e(){}var p,a=e.prototype;function u(e,t){this.getRequest=function(e,t,r){return e},this.done=function(e){}}function c(e,t,r){var n=function(e){var t=new Error;t.httpResponse=e,t.status=e.status;var r=e.data;if(!r)return t.message=e.error&&e.error.toString(),t;if("string"==typeof r)try{r=JSON.parse(r)}catch(e){return t.message=r,t}var n,a,i=e.saveContext;if(o=r.Message||r.ExceptionMessage||r.EntityErrors||r.Errors){for(var o=r;n=o.ExceptionMessage||o.Message,o=o.InnerException;);a=(a=r.Errors||r.EntityErrors)&&a.map(function(e){return{errorName:e.ErrorName,entityTypeName:Ce.normalizeTypeName(e.EntityTypeName),keyValues:e.KeyValues,propertyName:e.PropertyName,errorMessage:e.ErrorMessage}})}else n=r.message,a=r.errors||r.entityErrors;if(i&&a){var s=i.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;a.forEach(function(e){e.propertyName=e.propertyName&&s(e.propertyName)}),t.entityErrors=a}return t.message=n||"Server side errors encountered - see the entityErrors collection on this object for more detail",t}(t);return a._catchNoConnectionError(n),r&&(n.message=r+"; "+n.message),e.reject(n)}return a.checkForRecomposition=function(e){"ajax"===e.interfaceName&&e.isDefault&&this.initialize()},a.initialize=function(){if(!(p=q.config.getAdapterInstance("ajax"))||!p.ajax)throw new Error("Unable to find ajax adapter for dataservice adapter '"+(this.name||"")+"'.")},a.fetchMetadata=function(a,i){var o=i.serviceName,s=i.qualifyUrl("Metadata"),u=Ae.defer();return p.ajax({type:"GET",url:s,dataType:"json",success:function(t){if(a.hasMetadataFor(o))return u.resolve("already fetched");var e=t.data;try{var r="string"==typeof e?JSON.parse(e):e;a.importMetadata(r)}catch(e){var n="Unable to either parse or import metadata: "+e.message;return c(u,t,"Metadata query failed for: "+s+". "+n)}return a.hasMetadataFor(o)||a.addDataService(i),u.resolve(r)},error:function(e){c(u,e,"Metadata query failed for: "+s)}}),u.promise},a.executeQuery=function(e){e.adapter=this;var a=Ae.defer(),t={type:"GET",url:e.getUrl(),params:e.query.parameters,dataType:"json",success:function(t){var e=t.data;try{var r,n=e&&(e.results||e.Results);r=n?{results:n,inlineCount:e.inlineCount||e.InlineCount,httpResponse:t}:{results:e,httpResponse:t},a.resolve(r)}catch(e){e instanceof Error?a.reject(e):c(a,t)}},error:function(e){c(a,e)}};return e.dataService.useJsonp&&(t.dataType="jsonp",t.crossDomain=!0),p.ajax(t),a.promise},a.saveChanges=function(n,e){var a=n.adapter=this,i=Ae.defer();e=a._prepareSaveBundle(n,e);var t=JSON.stringify(e),r=n.dataService.qualifyUrl(n.resourceName);return p.ajax({type:"POST",url:r,dataType:"json",contentType:"application/json",data:t,success:function(e){e.saveContext=n;var t=e.data;if(t.Errors||t.errors)c(i,e);else{var r=a._prepareSaveResult(n,t);r.httpResponse=e,i.resolve(r)}},error:function(e){e.saveContext=n,c(i,e)}}),i.promise},a._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},a.changeRequestInterceptor=u,a._createChangeRequestInterceptor=function(e,t){var r=e.adapter,n=r.changeRequestInterceptor,a=S;if(a(n)){var i=r.name+" DataServiceAdapter's ChangeRequestInterceptor",o=" is missing or not a function.",s=new n(e,t);if(!a(s.getRequest))throw new Error(i+".getRequest"+o);if(!a(s.done))throw new Error(i+".done"+o);return s}return new u(e,t)},a._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},a.jsonResultsAdapter=new Oe({name:"noop",visitNode:function(){return{}}}),a._catchNoConnectionError=function(e){0==e.status&&null==e.message&&(e.message="HTTP response status 0 and no message.  Likely did not or could not reach server. Is the server running?")},e}(),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(e){"use strict";function t(){this.name="angular",this.defaultSettings={},this.requestInterceptor=null}var p=e.core,r=t.prototype;r.initialize=function(){var r,n,e=p.requireLib("angular");e&&(e.injector(["ng"]).invoke(["$http","$rootScope",function(e,t){r=e,n=t}]),this.$http=r,this.$rootScope=n)},r.setHttp=function(e){this.$http=e,this.$rootScope=null},r.ajax=function(o){if(!this.$http)throw new Error("Unable to locate angular for ajax adapter");var e={method:o.type,url:o.url,dataType:o.dataType,contentType:o.contentType,crossDomain:o.crossDomain,headers:o.headers||{}};if(o.params){var t=0<=e.url.indexOf("?")?"&":"?";e.url=e.url+t+function e(t){var r="";var n,a;for(var i in t){var o=t[i];if(o instanceof Array)for(var s=0;s<o.length;++s)n=o[s],(a={})[i+"["+s+"]"]=n,r+=e(a)+"&";else if(o&&o.toISOString)r+=encodeURIComponent(i)+"="+encodeURIComponent(o.toISOString())+"&";else if(o instanceof Object)for(var u in o)n=o[u],(a={})[i+"["+u+"]"]=n,r+=e(a)+"&";else null===o?r+=encodeURIComponent(i)+"=&":void 0!==o&&(r+=encodeURIComponent(i)+"="+encodeURIComponent(o)+"&")}return r.length?r.substr(0,r.length-1):r}(o.params)}if(o.data&&(e.data=o.data),!p.isEmpty(this.defaultSettings)){var r=p.extend({},this.defaultSettings);e=p.extend(r,e);var n=p.extend({},this.defaultSettings.headers);e.headers=p.extend(n,e.headers)}var a={adapter:this,config:e,dsaConfig:o,success:s,error:u,responseSuccess:function(e){return s(e.data,e.status,e.headers,e.config,e.statusText)},responseError:function(e){return u(e.data,e.status,e.headers,e.config,e.statusText)}};if(p.isFunction(this.requestInterceptor))this.requestInterceptor(a,function(e){var t=e.adapter;if(e.config){var r=t.$http(e.config);r.success?r.success(e.success).error(e.error):r.then(e.responseSuccess).catch(e.responseError),t.$rootScope&&t.$rootScope.$digest()}}),this.requestInterceptor.oneTime&&(this.requestInterceptor=null);else if(a.config){var i=this.$http(a.config);i.success?i.success(a.success).error(a.error):i.then(a.responseSuccess).catch(a.responseError),this.$rootScope&&this.$rootScope.$digest()}function s(e,t,r,n,a){"null"===e&&(e=null);var i={config:o,data:e,getHeaders:r,ngConfig:n,status:t,statusText:a};o.success(i)}function u(e,t,r,n,a){0===t&&null==e&&(e="timeout");var i={config:o,data:e,getHeaders:r,ngConfig:n,status:t,statusText:a};o.error(i)}},e.config.registerAdapter("ajax",t)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(e){"use strict";function t(){this.name="jQuery",this.defaultSettings={},this.requestInterceptor=null}var i,o=e.core,r=t.prototype;function s(t){return 0===t.status?function(e){return e&&0<e.length?"":{}}:function(e){return e&&0<e.length?t.getResponseHeader(e):t.getAllResponseHeaders()}}r.initialize=function(){i=o.requireLib("jQuery;jquery")},r.ajax=function(a){if(!i)throw new Error("Unable to locate jQuery");var e={type:a.type,url:a.url,data:a.params||a.data,dataType:a.dataType,contentType:a.contentType,crossDomain:a.crossDomain,headers:a.headers||{}};if(!o.isEmpty(this.defaultSettings)){var t=o.extend({},this.defaultSettings);e=o.extend(t,e);var r=o.extend({},this.defaultSettings.headers);e.headers=o.extend(r,e.headers)}var n={adapter:this,config:e,dsaConfig:a,success:function(e,t,r){var n={config:a,data:e,getHeaders:s(r),status:r.status,statusText:t};a.success(n),r.onreadystatechange=null,r.abort=null},error:function(e,t,r){var n={config:a,data:e.responseText,error:r,getHeaders:s(e),status:e.status,statusText:t};a.error(n),e.onreadystatechange=null,e.abort=null}};o.isFunction(this.requestInterceptor)&&(this.requestInterceptor(n),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),n.config&&(n.jqXHR=i.ajax(n.config).done(n.success).fail(n.error))},e.config.registerAdapter("ajax",t)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(u){"use strict";function e(){this.name="OData"}var p,c=u.core,f=u.MetadataStore,t=u.JsonResultsAdapter,v=u.DataProperty,r=u.DataType,m=u.AutoGeneratedKeyType,l=e.prototype;l.initialize=function(){(p=c.requireLib("OData","Needed to support remote OData services")).jsonHandler.recognizeDates=!0};var n=u.AbstractDataServiceAdapter.prototype;function g(e,t){if(!e.isUnmapped)return e.dataType===r.DateTimeOffset?t=t&&new Date(t.getTime()-6e4*t.getTimezoneOffset()):e.dataType.quoteJsonOData&&(t=null!=t?t.toString():t),t}function w(e,t,r){var n,a=t.extraMetadata;null==a?(n=function(t){var e=t.entity.entityType,r=e.defaultResourceName,n=e.keyProperties,a=r+"(";if(1===n.length)a=a+o(n[0],t)+")";else{var i="";n.forEach(function(e){a=a+i+e.nameOnServer+"="+o(e,t),i=","}),a+=")"}return a}(t),t.extraMetadata={uriKey:n}):(n=a.uriKey,a.etag&&(e.headers["If-Match"]=a.etag)),e.requestUri=0<n.indexOf("//")?n:r+n}function o(e,t){return e.dataType.fmtOData(t.getPropertyValue(e.name))}function S(e,t){var r,n,a=new Error,i=e&&e.response;if(!i)return a.message=e,a.statusText=e,a;if(a.message=i.statusText,a.statusText=i.statusText,a.status=i.statusCode,t&&(a.url=t),a.body=i.body,i.body)try{var o=JSON.parse(i.body);(a.body=o)["odata.error"]&&(o=o["odata.error"]);for(var s="";(r=o.error||o.innererror)||(s+=(void 0,("string"==typeof(n=o.message||"")?n:n.value)+"; ")),o=(r=r||o.internalexception)||o,r;);0<s.length&&(a.message=s)}catch(e){}return l._catchNoConnectionError(a),a}l._catchNoConnectionError=n._catchNoConnectionError,l.changeRequestInterceptor=n.changeRequestInterceptor,l._createChangeRequestInterceptor=n._createChangeRequestInterceptor,l.headers={DataServiceVersion:"2.0"},l.getAbsoluteUrl=function(e,t){var r=e.qualifyUrl(""),n=c.stringStartsWith(t,r)?"":r;return window&&r.indexOf("//")<0&&(n=window.location.protocol+"//"+window.location.host+(c.stringStartsWith(r,"/")?"":"/")+n),n+t},l.getRoutePrefix=function(e){var t;"object"==typeof document?(t=document.createElement("a")).href=e.serviceName:t=url.parse(e.serviceName);var r=t.pathname;return"/"===r[0]&&(r=r.substr(1)),"/"!==r.substr(-1)&&(r+="/"),r},l.executeQuery=function(e){var t,a=u.Q.defer();if(t=!0===this.relativeUrl?e.getUrl():c.isFunction(this.relativeUrl)?this.relativeUrl(e.dataService,e.getUrl()):this.getAbsoluteUrl(e.dataService,e.getUrl()),!c.isEmpty(e.query.parameters)){var r=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}(e.query.parameters),n=t.indexOf("?")<0?"?":"&";t=t+n+r}return p.read({requestUri:t,headers:c.extend({},this.headers)},function(e,t){var r,n;return e.__count&&(r=parseInt(e.__count,10)),n=e.results?e.results:e,a.resolve({results:n,inlineCount:r,httpResponse:t})},function(e){return a.reject(S(e,t))}),a.promise},l.fetchMetadata=function(n,a){var i,o=u.Q.defer(),s=a.serviceName;i=!0===this.relativeUrl?a.qualifyUrl("$metadata"):c.isFunction(this.relativeUrl)?this.relativeUrl(a,"$metadata"):this.getAbsoluteUrl(a,"$metadata");var e=c.extend({},this.headers);return e.Accept="application/*; odata.metadata=full",p.read({requestUri:i,headers:e},function(e){if(!e||!e.dataServices){var t=new Error("Metadata query failed for: "+i);return o.reject(t)}var r=e.dataServices;if(!n.hasMetadataFor(s)){try{n.importMetadata(r)}catch(e){return o.reject(new Error("Metadata query failed for "+i+"; Unable to process returned metadata: "+e.message))}n.addDataService(a)}return o.resolve(r)},function(e){var t=S(e,i);return t.message="Metadata query failed for: "+i+"; "+(t.message||""),o.reject(t)},p.metadataHandler),o.promise},l.saveChanges=function(e,t){var l,r=e.adapter=this,y=u.Q.defer();l=!0===this.relativeUrl?(e.routePrefix=r.getRoutePrefix(e.dataService),e.dataService.qualifyUrl("$batch")):(c.isFunction(r.relativeUrl)?e.routePrefix=r.relativeUrl(e.dataService,""):e.routePrefix=r.getAbsoluteUrl(e.dataService,""),e.routePrefix+"$batch");var n=function(e,t){var a=e.adapter._createChangeRequestInterceptor(e,t),i=[],o=[],s=[],u=e.entityManager,p=u.helper,c=0,f=e.routePrefix;return t.entities.forEach(function(e,t){var r=e.entityAspect,n={headers:{"Content-ID":c+=1,DataServiceVersion:"2.0"}};if(s[c]=e,r.entityState.isAdded())n.requestUri=f+e.entityType.defaultResourceName,n.method="POST",n.data=p.unwrapInstance(e,g),o[c]=r.getKey();else if(r.entityState.isModified())w(n,r,f),n.method="MERGE",n.data=p.unwrapChangedValues(e,u.metadataStore,g);else{if(!r.entityState.isDeleted())return;w(n,r,f),n.method="DELETE"}n=a.getRequest(n,e,t),i.push(n)}),e.contentKeys=s,e.tempKeys=o,a.done(i),{__batchRequests:[{__changeRequests:i}]}}(e,t),h=e.tempKeys,d=e.contentKeys;return p.request({headers:c.extend({},this.headers),requestUri:l,method:"POST",data:n},function(e,t){var c=[],f=[],r={entities:c,keyMappings:f};return e.__batchResponses.forEach(function(e){e.__changeResponses.forEach(function(e){var t=(e.response||e).statusCode;if(!t||400<=t)y.reject(S(e,l));else{var r=e.headers["Content-ID"];r=r||e.headers["Content-Id"];var n=e.data;if(n){var a=h[r];if(a){var i=a.entityType;if(i.autoGeneratedKeyType!==m.None){var o=a.values[0],s=i.getEntityKeyFromRawEntity(n,v.getRawValueFromServer),u={entityTypeName:i.name,tempValue:o,realValue:s.values[0]};f.push(u)}}c.push(n)}else{var p=d[r];c.push(p)}}})}),y.resolve(r)},function(e){return y.reject(S(e,l))},p.batchHandler),y.promise},l.jsonResultsAdapter=new t({name:"OData_default",visitNode:function(e,t,r){var n={};if(null==e)return n;var a=e.__metadata;if(null!=a){var i=f.normalizeTypeName(a.type),o=i&&t.entityManager.metadataStore.getEntityType(i,!0);if(o&&o._mappedPropertiesCount<=Object.keys(e).length-1){n.entityType=o;var s=a.uri||a.id;if(s){var u=new RegExp("^"+t.dataService.serviceName,"i");s=s.replace(u,"")}n.extraMetadata={uriKey:s,etag:a.etag}}}e.results&&(n.node=e.results);var p=r.propertyName;return n.ignore=null!=e.__deferred||"__metadata"===p||"EntityKey"===p&&e.$type&&c.stringStartsWith(e.$type,"System.Data"),n}}),u.config.registerAdapter("dataService",e);function a(){this.name="webApiOData"}u.core.extend(a.prototype,l),u.config.registerAdapter("dataService",a);function i(){this.name="webApiOData4"}u.core.extend(i.prototype,a.prototype),i.prototype.initialize=function(){var e=c.requireLib("datajs","Needed to support remote OData v4 services");(p=e.V4.oData).json.jsonHandler.recognizeDates=!0},i.prototype.headers={"OData-Version":"4.0"},u.config.registerAdapter("dataService",i)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(u){"use strict";function e(){this.name="webApi"}var s=u.MetadataStore,t=u.JsonResultsAdapter,r=u.AbstractDataServiceAdapter,n=e.prototype=new r;n._prepareSaveBundle=function(e,t){var i=this._createChangeRequestInterceptor(e,t),r=e.entityManager,o=r.metadataStore,s=r.helper;return t.entities=t.entities.map(function(e,t){var r=s.unwrapInstance(e),n=null;e.entityType.autoGeneratedKeyType!==u.AutoGeneratedKeyType.None&&(n={propertyName:e.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:e.entityType.autoGeneratedKeyType.name});var a=s.unwrapOriginalValues(e,o);return r.entityAspect={entityTypeName:e.entityType.name,defaultResourceName:e.entityType.defaultResourceName,entityState:e.entityAspect.entityState.name,originalValuesMap:a,autoGeneratedKey:n},r=i.getRequest(r,e,t)}),t.saveOptions={tag:t.saveOptions.tag},i.done(t.entities),t},n._prepareSaveResult=function(e,t){var r=e.dataService.jsonResultsAdapter||this.jsonResultsAdapter,n=r.extractSaveResults(t)||[],a=r.extractKeyMappings(t)||[],i=r.extractDeletedKeys&&r.extractDeletedKeys(t)||[];return a.length&&(a=a.map(function(e){return e.entityTypeName?e:{entityTypeName:s.normalizeTypeName(e.EntityTypeName),tempValue:e.TempValue,realValue:e.RealValue}})),i.length&&(i=i.map(function(e){return e.entityTypeName?e:{entityTypeName:s.normalizeTypeName(e.EntityTypeName),keyValues:e.KeyValue}})),{entities:n,keyMappings:a,deletedKeys:i}},n.jsonResultsAdapter=new t({name:"webApi_default",visitNode:function(e,t,r){if(null==e)return{};var n=s.normalizeTypeName(e.$type),a=n&&t.entityManager.metadataStore._getEntityType(n,!0),i=r.propertyName,o=i&&"$"===i.substr(0,1);return{entityType:a,nodeId:e.$id,nodeRefId:e.$ref,ignore:o}}}),u.config.registerAdapter("dataService",e)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(i){"use strict";function e(){this.name="backingStore"}var o=i.core,t=e.prototype;function s(e,r){var n=r.name,t=e._pendingBackingStores;t||(t=[],e._pendingBackingStores=t);var a={get:function(){return(this._backingStore||p(this))[n]},set:function(e){var t=u(this._backingStore||c(this),n);this._$interceptor(r,e,t)},enumerable:!0,configurable:!0};return a.set.rawSet=function(e){u(this._backingStore||c(this),n)(e)},a}function u(e,t){return function(){return 0===arguments.length?e[t]:void(e[t]=arguments[0])}}function p(e){!function(e){var t=e._pendingBackingStores;t&&(t.forEach(function(e){e.entity._backingStore=e.backingStore}),t.length=0)}(Object.getPrototypeOf(e));var t=e._backingStore;return t||(t={},e._backingStore=t),t}function c(t){var e=Object.getPrototypeOf(t)._pendingBackingStores,r=o.arrayFirst(e,function(e){return e.entity===t});if(r)return r.backingStore;var n={};return e.push({entity:t,backingStore:n}),n}t.initialize=function(){},t.getTrackablePropertyNames=function(e){var t=[];for(var r in e)if("entityType"!==r&&"_$typeName"!==r&&"_pendingSets"!==r&&"_backingStore"!==r){var n=e[r];o.isFunction(n)||t.push(r)}return t},t.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]},e.setProperty=function(e,t){return this[e]=t,this},function(n){var e=n.entityType||n.complexType,t=e._extra,a=t.alreadyWrappedProps||{};e.getProperties().forEach(function(e){var t,r=e.name;a[r]||(null!=(t=r in n?function e(t,r){if(!t.hasOwnProperty(r.name)){var n=Object.getPrototypeOf(t);return e(n,r)}var a=Object.getOwnPropertyDescriptor(t,r.name);if(!a.configurable)return;if(a.value)return;if(!a.set)return;var i={get:function(){return a.get.bind(this)()},set:function(e){var t;this._$interceptor(r,e,(t=this,function(){if(0===arguments.length)return a.get.bind(t)();for(var e=a.set;e.rawSet;)e=e.rawSet;e.bind(t)(arguments[0])}))},enumerable:a.enumerable,configurable:!0};i.set.rawSet=a.set;return i}(n,e):s(n,e))&&Object.defineProperty(n,r,t),a[r]=!0)}),t.alreadyWrappedProps=a}(e)},t.startTracking=function(n,e){var a=function(a){var e=p(a),i=Object.getPrototypeOf(a);return(i.entityType||i.complexType).getProperties().forEach(function(e){var t=e.name;if(e.isUnmapped&&!o.getPropertyDescriptor(i,t)){var r=s(i,e);Object.defineProperty(i,t,r)}if(a.hasOwnProperty(t)){var n=a[t];delete a[t],a[t]=n}}),e}(n);(n.entityType||n.complexType).getProperties().forEach(function(e){var t=e.name,r=n[t];if(e.isDataProperty)e.isComplexProperty?r=e.isScalar?e.dataType._createInstanceCore(n,e):i.makeComplexArray([],n,e):e.isScalar?void 0===r&&(r=e.defaultValue):r=i.makePrimitiveArray([],n,e);else{if(!e.isNavigationProperty)throw new Error("unknown property: "+t);if(void 0!==r)throw new Error("Cannot assign a navigation property in an entity ctor.: "+t);r=e.isScalar?null:i.makeRelationArray([],n,e)}(e.isSettable||e.isNavigationProperty)&&(a[t]=r)})},i.config.registerAdapter("modelLibrary",e)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(l){"use strict";function e(){this.name="ko"}var y,i=l.core,n=i.__isES5Supported,t=e.prototype;function o(e,t){if(!n)return null;if(e.hasOwnProperty(t))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e,t);var r=Object.getPrototypeOf(e);return r?o(r,t):null}function h(e){e._koObj._suppressBreeze=!0}function d(e){var t=e.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}t.initialize=function(){(y=i.requireLib("ko;knockout","The Knockout library")).extenders.intercept=function(t,e){var r=e.instance,n=e.property;return t.splice?y.computed({read:t}):y.computed({read:t,write:function(e){return r._$interceptor(n,e,t),r}})}},t.getTrackablePropertyNames=function(e){var t=[];for(var r in e)if("entityType"!==r&&"_$typeName"!==r){var n=o(e,r);if(n&&n.get)t.push(r);else{var a=e[r];y.isObservable(a)?t.push(r):i.isFunction(a)||t.push(r)}}return t},t.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]()},e.setProperty=function(e,t){return this[e](t),this},n&&function(r){var e=r.entityType||r.complexType,n={};if(e.getProperties().forEach(function(e){var t=o(r,e.name);t&&(n[e.name]=t)}),!i.isEmpty(n)){e._extra.es5Descriptors=n,e._koDummy=y.observable(null)}}(e)},t.startTracking=function(p,e){var c=p.entityType||p.complexType,f=c._extra.es5Descriptors||{};c.getProperties().sort(function(e,t){return(e.isUnmapped?1:0)-(t.isUnmapped?1:0)}).forEach(function(t){var e,r=t.name,n=p[r],a=f[r];if(a){var i=a.get.bind(p);if(a.set){var o=a.set.bind(p),s=function(e){0!==arguments.length?o(e):i()};e=y.computed({read:function(){return c._koDummy(),i()},write:function(e){return p._$interceptor(t,e,s),c._koDummy.valueHasMutated(),p}})}else e=y.computed({read:i,write:function(){}})}else if(y.isObservable(n)){if(t.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+r);e=n}else n=function(e,t,r){if(t.isDataProperty)t.isComplexProperty?r=t.isScalar?t.dataType._createInstanceCore(e,t):l.makeComplexArray([],e,t):t.isScalar?void 0===r&&(r=t.defaultValue):r=l.makePrimitiveArray([],e,t);else{if(!t.isNavigationProperty)throw new Error("unknown property: "+t.name);if(void 0!==r)throw new Error("Cannot assign a navigation property in an entity ctor.: "+t.name);r=t.isScalar?null:l.makeRelationArray([],e,t)}return r}(p,t,n),e=t.isScalar?y.observable(n):y.observableArray(n);if(t.isScalar)if(a)Object.defineProperty(p,r,{enumerable:!0,configurable:!0,writable:!0,value:e});else{var u=e.extend({intercept:{instance:p,property:t}});p[r]=u}else(n._koObj=e).subscribe(h,null,"beforeChange"),n.arrayChanged.subscribe(d),e.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},p[r]=e})},l.config.registerAdapter("modelLibrary",e)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(e){"use strict";function t(){this.name="json"}var o=e.EntityType,r=t.prototype;r.initialize=function(){},r.buildUri=function(e,t){var r=e._getFromEntityType(t,!1);r=r||new o(t);var n=e.toJSONExt({entityType:r,toNameOnServer:!0});n.from=void 0,n.queryOptions=void 0;var a=JSON.stringify(n),i=encodeURIComponent(a);return e.resourceName+"?"+i},e.config.registerAdapter("uriBuilder",t)}),function(e){"object"==typeof q?e(q):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],e)}(function(i){"use strict";function e(){this.name="odata"}var p,r,c=i.EntityType,t=e.prototype;function o(e){var t=e.op.key;return r[t]||t}t.initialize=function(){},t.buildUri=function(e,t){var r=e._getFromEntityType(t,!1);r=r||new c(t);var n,a,i,o,s={};s.$filter=(n=e.wherePredicate)?n.visit({entityType:r},p):void 0,s.$orderby=(a=e.orderByClause)?(a.validate(r),a.items.map(function(e){return r.clientPropertyPathToServer(e.propertyPath,"/")+(e.isDesc?" desc":"")}).join(",")):void 0,e.skipCount&&(s.$skip=e.skipCount),null!=e.takeCount&&(s.$top=e.takeCount),s.$expand=(i=e.expandClause)?i.propertyPaths.map(function(e){return r.clientPropertyPathToServer(e,"/")}).join(","):void 0,s.$select=(o=e.selectClause)?(o.validate(r),o.propertyPaths.map(function(e){return r.clientPropertyPathToServer(e,"/")}).join(",")):void 0,e.inlineCountEnabled&&(s.$inlinecount="allpages");var u=function(e){var t=[];for(var r in e){var n=e[r];void 0!==n&&(n instanceof Array?n.forEach(function(e){t.push(r+"="+encodeURIComponent(e))}):t.push(r+"="+encodeURIComponent(n)))}return 0<t.length?"?"+t.join("&"):""}(s);return e.resourceName+u},i.Predicate.prototype.toODataFragment=function(e){return this.visit(e,p)},r={contains:"substringof"},p={passthruPredicate:function(){return this.value},unaryPredicate:function(e){var t=this.pred.visit(e);return o(this)+" ("+t+")"},binaryPredicate:function(e){var t=this.expr1.visit(e),r=this.expr2.visit(e),n=e.prefix;n&&(t=n+"/"+t);var a=o(this);return"in"!==this.op.key?this.op.isFunction?"substringof"===a?a+"("+r+","+t+") eq true":a+"("+t+","+r+") eq true":t+" "+a+" "+r:r.map(function(e){return"("+t+" eq "+e+")"}).join(" or ")},andOrPredicate:function(t){return this.preds.map(function(e){return"("+e.visit(t)+")"}).join(" "+o(this)+" ")},anyAllPredicate:function(e){var t=this.expr.visit(e);if(!this.pred.op)return t+"/"+o(this)+"()";var r=e.prefix;r=r?(t=r+"/"+t,"x"+(parseInt(r.substring(1))+1)):"x1";var n=i.core.extend({},e);n.entityType=this.expr.dataType,n.prefix=r;var a=this.pred.visit(n);return t+"/"+o(this)+"("+r+": "+a+")"},litExpr:function(){return Array.isArray(this.value)?this.value.map(function(e){return this.dataType.fmtOData(e)},this):this.dataType.fmtOData(this.value)},propExpr:function(e){var t=e.entityType;return t?t.clientPropertyPathToServer(this.propertyPath,"/"):this.propertyPath},fnExpr:function(t){var e=this.exprs.map(function(e){return e.visit(t)});return this.fnName+"("+e.join(",")+")"}},i.config.registerAdapter("uriBuilder",e)}),q.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery",uriBuilder:"odata"}),c("ko")){q.config.initializeAdapterInstance("modelLibrary","ko")}else{q.config.initializeAdapterInstance("modelLibrary","backingStore")}return q}(e)}"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):breeze=t()}(this);